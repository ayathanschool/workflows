import{r as x,a as od,g as it,R as E,b as ar,c as at}from"./react-vendor-tAaa2TlE.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var Jo={exports:{}},Ya={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ld=x,cd=Symbol.for("react.element"),dd=Symbol.for("react.fragment"),ud=Object.prototype.hasOwnProperty,md=ld.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,hd={key:!0,ref:!0,__self:!0,__source:!0};function Qo(e,t,r){var s,n={},i=null,o=null;r!==void 0&&(i=""+r),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(o=t.ref);for(s in t)ud.call(t,s)&&!hd.hasOwnProperty(s)&&(n[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)n[s]===void 0&&(n[s]=t[s]);return{$$typeof:cd,type:e,key:i,ref:o,props:n,_owner:md.current}}Ya.Fragment=dd;Ya.jsx=Qo;Ya.jsxs=Qo;Jo.exports=Ya;var a=Jo.exports,Ls={},Qn=od;Ls.createRoot=Qn.createRoot,Ls.hydrateRoot=Qn.hydrateRoot;const fd="https://script.google.com/macros/s/AKfycbw7aadLu7rcwWEQk-slXjFrPWmEM3mlr9OQTXVfGEKCS93rMVBbepaAx9L5YmrOgnMykQ/exec",ie=fd;function pd(){return ie}const Ta=(...e)=>{},nr=new Map,$r=new Map,Zo=5*60*1e3,el=30*1e3;function gd(e){return e&&Date.now()-e.timestamp<e.duration}function xd(e,t,r=Zo){nr.set(e,{data:t,timestamp:Date.now(),duration:r})}async function pe(e,t=Zo){const r=e,s=nr.get(r);if(gd(s))return s.data;if($r.has(r))return $r.get(r);try{Ta("GET",e);const n=fetch(e,{method:"GET"}).then(async o=>{if(!o.ok){const l=await o.text().catch(()=>"");throw new Error(`HTTP ${o.status} ${l}`)}return o.json()});$r.set(r,n);const i=await n;return xd(r,i,t),$r.delete(r),i}catch(n){throw $r.delete(r),console.error("API GET failed",e,n),typeof window<"u"&&window.dispatchEvent(new CustomEvent("api-error",{detail:{message:String(n.message||n),url:e}})),new Error(`Failed to fetch ${e}: ${String(n&&n.message?n.message:n)}`)}}async function Ze(e,t){if(e.includes("assignSubstitution"))for(const[s]of nr)(s.includes("getVacantSlotsForAbsent")||s.includes("getTeacherDailyTimetable")||s.includes("getDailyTimetableWithSubstitutions")||s.includes("getAssignedSubstitutions"))&&nr.delete(s);const r=JSON.stringify(t);try{Ta("POST",e,t);const s=await fetch(e,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:r});if(!s.ok){const n=await s.text().catch(()=>""),i=new Error(`HTTP ${s.status} ${n}`);throw typeof window<"u"&&window.dispatchEvent(new CustomEvent("api-error",{detail:{message:i.message,url:e,status:s.status}})),i}return await s.json()}catch(s){throw console.error("API POST failed",e,s),typeof window<"u"&&window.dispatchEvent(new CustomEvent("api-error",{detail:{message:String(s.message||s),url:e}})),new Error(`Failed to post ${e}: ${String(s&&s.message?s.message:s)}`)}}async function vd(e,t=""){const r=`${ie}?action=login&email=${encodeURIComponent(e)}`,s=t?`${r}&password=${encodeURIComponent(t)}`:r;return pe(s)}async function yd(e){try{return Ta("Sending Google auth info to backend (POST)"),await Ze(`${ie}?action=googleLogin`,e)}catch(t){try{if(!(e!=null&&e.email))throw t;return Ta("Sending Google auth info via GET fallback"),await pe(`${ie}?action=googleLogin&email=${encodeURIComponent(e.email)}`)}catch(s){throw console.error("Both POST and GET Google login attempts failed:",{postError:t==null?void 0:t.message,getError:s==null?void 0:s.message}),String((t==null?void 0:t.message)||"").includes("Invalid Google token")?new Error("Authentication failed. Your Google token could not be verified. Please sign in again."):new Error("Google login failed. Please ensure your Apps Script Web App is deployed (doPost handler active) and that your browser allows third-party cookies/popups.")}let r=String(t.message||"");throw r.includes("Invalid Google token")?(console.error("Invalid Google token error. Token might be expired or malformed."),new Error("Authentication failed. Your Google authentication token could not be verified. Please try signing in again or check if cookies are enabled.")):r.includes("Email not verified")||r.includes("Token missing email")?new Error("Your Google account email is either not verified or not available. Please ensure you have a verified email in your Google account."):r.includes("User not registered")?new Error("Your Google account is not registered in the system. Please contact your administrator to register your email."):t}}async function Is(e){return pe(`${ie}?action=getTeacherWeeklyTimetable&email=${encodeURIComponent(e)}`)}async function Zn(e,t){console.log("📞 API call: getTeacherDailyTimetable",{email:e,date:t});const r=await pe(`${ie}?action=getTeacherDailyTimetable&email=${encodeURIComponent(e)}&date=${encodeURIComponent(t)}`,el);return console.log("📞 API response: getTeacherDailyTimetable",r),r}async function ys(e,t="",r="",s="",n=""){const i=new URLSearchParams({action:"getTeacherLessonPlans",email:e,subject:t,class:r,status:s,search:n});return pe(`${ie}?${i.toString()}`)}async function bd(e,t){return Ze(`${ie}?action=submitPlan`,{email:e,...t})}async function wd(e=1,t=10,r="",s="",n="",i=""){const o=new URLSearchParams({action:"getPendingPlans",page:e,pageSize:t,teacher:r,class:s,subject:n,month:i});return pe(`${ie}?${o.toString()}`)}async function ei(e,t){return Ze(`${ie}?action=updatePlanStatus`,{schemeId:e,status:t})}async function jd(e="",t="",r="",s="Pending Review"){const n=new URLSearchParams({action:"getPendingLessonReviews",teacher:e,class:t,subject:r,status:s});return pe(`${ie}?${n.toString()}`)}async function Nd(e,t){return Ze(`${ie}?action=submitLessonPlanDetails`,{lpId:e,...t})}async function Sd(e,t,r=""){return Ze(`${ie}?action=updateLessonPlanDetailsStatus`,{lpId:e,status:t,remarks:r})}async function Ed(e,t,r){const s=new URLSearchParams({action:"getApprovedLessonPlansForReport",email:e,class:t,subject:r});return pe(`${ie}?${s.toString()}`)}async function kd(){return pe(`${ie}?action=debugExamMarks`)}async function Cd(e){return Ze(`${ie}?action=submitDailyReport`,e)}async function tl(e,t){const r=new URLSearchParams({action:"getTeacherDailyReportsForDate",email:e,date:t});return pe(`${ie}?${r.toString()}`,el)}async function Va(){return pe(`${ie}?action=getAllClasses`)}async function rl(){return pe(`${ie}?action=getAllSubjects`)}async function bs(e){const t=new URLSearchParams({action:"getTeacherSchemes",email:e});return pe(`${ie}?${t.toString()}`)}async function al(e,t={}){const{noCache:r=!1}=t||{},s=new URLSearchParams({action:"getDailyTimetableWithSubstitutions",date:e});return r&&s.append("_",String(Date.now())),pe(`${ie}?${s.toString()}`)}async function $d(e,t={}){const{noCache:r=!1}=t||{},s=new URLSearchParams({action:"getAssignedSubstitutions",date:e});return r&&s.append("_",String(Date.now())),pe(`${ie}?${s.toString()}`)}async function sl(e,t={}){const{noCache:r=!1}=t||{},s=new URLSearchParams({action:"getDailyTimetableForDate",date:e});return r&&s.append("_",String(Date.now())),pe(`${ie}?${s.toString()}`)}async function Dd(e,t={}){const{noCache:r=!1}=t||{};if(r)for(const[i]of nr)i.includes("getSubstitutionsForDate")&&nr.delete(i);const s=typeof e=="string"?e.trim():String(e||""),n=new URLSearchParams({action:"getSubstitutionsForDate",date:s});n.append("_",String(Date.now())),console.log(`[API] Fetching substitutions for date: ${s}`);try{const i=await pe(`${ie}?${n.toString()}`);return Array.isArray(i)?(console.log(`[API] Got ${i.length} substitutions directly`),i):i&&i.data&&Array.isArray(i.data)?(console.log(`[API] Got ${i.data.length} substitutions from result.data`),i.data):i&&i.substitutions&&Array.isArray(i.substitutions)?(console.log(`[API] Got ${i.substitutions.length} substitutions from result.substitutions`),i.substitutions):(console.warn("[API] Unexpected substitution data format:",i),Array.isArray(i)?i:[])}catch(i){throw console.error("[API] Error fetching substitutions:",i),new Error(`Failed to fetch substitutions for ${s}: ${i.message||String(i)}`)}}async function Td(e,t,r={}){const{noCache:s=!1}=r||{},n=new URLSearchParams({action:"getAvailableTeachers",date:e,period:t});return s&&n.append("_",String(Date.now())),pe(`${ie}?${n.toString()}`)}async function Ad(e){return Ze(`${ie}?action=addSubstitution`,e)}async function Md(){return pe(`${ie}?action=getHmInsights`)}async function Pd(){return pe(`${ie}?action=getFullTimetable`)}async function Od(e="",t="",r="",s=""){const n=new URLSearchParams({action:"getFullTimetableFiltered",class:e,subject:t,teacher:r,date:s});return pe(`${ie}?${n.toString()}`)}async function Rd(){const e=await pe(`${ie}?action=getAppSettings`);return e&&e.settings&&typeof e.settings=="object"?e.settings:e||{}}async function Sa(e={}){let t="",r="",s="",n="",i="",o;typeof e=="object"?{class:t="",subject:r="",examType:s="",teacherEmail:n="",role:i="",_ts:o}=e:t=e||"";const l=new URLSearchParams({action:"getExams",class:t,subject:r,examType:s,...n?{teacherEmail:n}:{},...i?{role:i}:{},...o?{_ts:o}:{}});return pe(`${ie}?${l.toString()}`)}async function _d(e,t){return Ze(`${ie}?action=createExam`,{email:e,...t})}async function Ld(e){return Ze(`${ie}?action=updateExam`,e)}async function Id(e){return Ze(`${ie}?action=submitExamMarks`,e)}async function ti(e){const t=new URLSearchParams({action:"getExamMarks",examId:e});return pe(`${ie}?${t.toString()}`)}async function Fd(){try{console.log("Getting all exams using getExams...");const e=await Sa("","","");console.log("getExams call successful:",e);const t=Array.isArray(e)?e.map(r=>({examId:r.examId,examName:r.examName||`${r.examType||"Exam"} - ${r.class||""} - ${r.subject||""}`,class:r.class,subject:r.subject,examType:r.examType,examDate:r.date,creatorEmail:r.creatorEmail,creatorName:r.creatorName,internalMax:r.internalMax,externalMax:r.externalMax,totalMax:r.totalMax,createdAt:r.date})):[];return console.log("Transformed exam data for getAllExams:",t),t}catch(e){throw console.error("getAllExams using getExams failed:",e),e}}async function Dr(e,t="",r=""){const s=new URLSearchParams({action:"getStudentReportCard",examId:e});return t&&s.append("admNo",t),r&&s.append("class",r),pe(`${ie}?${s.toString()}`)}async function Wd(e="",t="",r="",s=""){const n=new URLSearchParams({action:"getAllPlans",teacher:e,class:t,subject:r,status:s});return pe(`${ie}?${n.toString()}`)}async function Hd(){try{const e=await pe(`${ie}?action=getAllPlans&status=Approved`);return(Array.isArray(e)?e:Array.isArray(e==null?void 0:e.plans)?e.plans:[]).filter(s=>{const n=String((s==null?void 0:s.status)||"").toLowerCase()==="approved",i=!!(s!=null&&s.schemeId)||(s==null?void 0:s.noOfSessions)!=null;return n&&i})}catch(e){throw console.warn("getAllApprovedSchemes failed:",(e==null?void 0:e.message)||e),e}}async function Ud({teacher:e="",cls:t="",subject:r="",date:s="",fromDate:n="",toDate:i="",status:o=""}={}){const l=new URLSearchParams({action:"getDailyReports",teacher:e,class:t,subject:r,date:s,fromDate:n,toDate:i,status:o});return pe(`${ie}?${l.toString()}`)}async function zd(){return pe(`${ie}?action=getSubjects`).then(e=>e.subjects||[])}async function Fs(e=""){const t=new URLSearchParams({action:"getStudents",class:e});return pe(`${ie}?${t.toString()}`)}async function Bd(){return pe(`${ie}?action=getGradeTypes`)}async function Gd(e){return Ze(`${ie}?action=submitAttendance`,e)}async function qd(e){const t=new URLSearchParams({action:"getStudentPerformance",class:e});return pe(`${ie}?${t.toString()}`)}async function Yd(e,t,r){const s=new URLSearchParams({action:"getCalendarEvents",email:e,startDate:"",endDate:""});return pe(`${ie}?${s.toString()}`)}async function Vd(e){return Ze(`${ie}?action=saveCalendarEvent`,e)}async function Kd(e){return Ze(`${ie}?action=deleteCalendarEvent`,{eventId:e})}async function ri(e,t="",r=""){const s=new URLSearchParams({action:"getLessonProgressSummary",teacherEmail:e,class:t,subject:r});return pe(`${ie}?${s.toString()}`)}async function Ws(e,t="",r=""){const s=new URLSearchParams({action:"getTeacherLessonDelays",teacherEmail:e,class:t,subject:r});return pe(`${ie}?${s.toString()}`)}async function Xd(e="",t="",r=""){const s=new URLSearchParams({action:"getAllLessonProgressSummary",teacherEmail:e,class:t,subject:r});return pe(`${ie}?${s.toString()}`)}async function Jd(e="",t="",r=""){const s=new URLSearchParams({action:"getAllTeacherLessonDelays",teacherEmail:e,class:t,subject:r});return pe(`${ie}?${s.toString()}`)}async function Qd(){try{return await pe(`${ie}?action=getAllTeachers`)}catch(e){return console.warn("getAllTeachers endpoint not available - backend update required:",e),[]}}/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zd=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),nl=(...e)=>e.filter((t,r,s)=>!!t&&s.indexOf(t)===r).join(" ");/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var eu={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tu=x.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:s,className:n="",children:i,iconNode:o,...l},c)=>x.createElement("svg",{ref:c,...eu,width:t,height:t,stroke:e,strokeWidth:s?Number(r)*24/Number(t):r,className:nl("lucide",n),...l},[...o.map(([d,u])=>x.createElement(d,u)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=(e,t)=>{const r=x.forwardRef(({className:s,...n},i)=>x.createElement(tu,{ref:i,iconNode:t,className:nl(`lucide-${Zd(e)}`,s),...n}));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ai=fe("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ru=fe("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const au=fe("BookCheck",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["path",{d:"m9 9.5 2 2 4-4",key:"1dth82"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const si=fe("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=fe("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ni=fe("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=fe("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ii=fe("ChartNoAxesColumn",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oi=fe("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const su=fe("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const li=fe("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nu=fe("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iu=fe("Clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ci=fe("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=fe("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const il=fe("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=fe("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ou=fe("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lu=fe("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=fe("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=fe("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cu=fe("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const du=fe("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uu=fe("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mu=fe("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wr=fe("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=fe("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hu=fe("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fu=fe("School",[["path",{d:"M14 22v-4a2 2 0 1 0-4 0v4",key:"hhkicm"}],["path",{d:"m18 10 4 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-8l4-2",key:"1vwozw"}],["path",{d:"M18 5v17",key:"1sw6gf"}],["path",{d:"m4 6 8-4 8 4",key:"1q0ilc"}],["path",{d:"M6 5v17",key:"1xfsm0"}],["circle",{cx:"12",cy:"9",r:"2",key:"1092wv"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const di=fe("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ol=fe("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pu=fe("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ll=fe("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=fe("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ui=fe("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gu=fe("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cl=fe("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xu=fe("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mi=fe("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nn=fe("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),dl=x.createContext({user:null,roles:[],idToken:null,loading:!1,loginWithGoogle:async()=>{},logout:()=>{}});function Ka(){return x.useContext(dl)}function vu({onSuccess:e}){const[t,r]=x.useState(""),[s,n]=x.useState(""),[i,o]=x.useState(""),[l,c]=x.useState(!1),[d,u]=x.useState(!1),[m,f]=x.useState(!1),p=Ka(),v=!!p&&typeof p.loginWithGoogle=="function"&&!p.error;x.useEffect(()=>{const y=console.error;return console.error=function(...w){w.some(j=>typeof j=="string"&&(j.includes("Cross-Origin-Opener-Policy")||j.includes("COOP")||j.includes("window.closed")))&&f(!0),y.apply(console,w)},()=>{console.error=y}},[]);async function g(y){if(y.preventDefault(),o(""),!t){o("Please enter your email");return}try{u(!0);const w=await vd(t,s);if(w&&w.error)throw new Error(w.error);e&&e(w)}catch(w){o(w.message||"Login failed")}finally{u(!1)}}return a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 transition-colors duration-500",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 w-full max-w-md transition-colors duration-300",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"mx-auto bg-blue-100 rounded-full p-3 w-16 h-16 flex items-center justify-center mb-4",children:a.jsx(xu,{className:"w-8 h-8 text-blue-600"})}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white transition-colors duration-300",children:"School Workflow System"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2 transition-colors duration-300",children:"Sign in to your account"})]}),i&&a.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-700 rounded-lg text-sm",children:i}),m&&a.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 text-yellow-800 rounded-lg text-sm flex items-start",children:[a.jsx(su,{className:"h-5 w-5 mr-2 flex-shrink-0 mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium",children:"Browser Security Notice"}),a.jsx("p",{className:"mt-1",children:"We've detected a Cross-Origin-Opener-Policy issue with Google login. Please try:"}),a.jsxs("ol",{className:"list-decimal ml-5 mt-2 space-y-1",children:[a.jsx("li",{children:"Disabling popup blockers"}),a.jsx("li",{children:"Using email login instead"}),a.jsx("li",{children:"Trying a different browser"})]})]})]}),v&&!l&&a.jsxs("div",{className:"space-y-4",children:[a.jsx("button",{type:"button",onClick:()=>p.loginWithGoogle(),disabled:p.loading,className:"w-full flex items-center justify-center gap-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 py-3 px-4 rounded-lg font-medium shadow-sm disabled:opacity-50",children:p.loading?"Connecting...":"Sign in with Google"}),a.jsx("div",{className:"text-center",children:a.jsx("button",{type:"button",onClick:()=>c(!0),className:"text-xs text-blue-600 hover:underline",children:"Use email/password instead"})})]}),(!v||l)&&a.jsxs(a.Fragment,{children:[a.jsxs("form",{onSubmit:g,className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),a.jsx("input",{type:"email",value:t,onChange:y=>r(y.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your email",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),a.jsx("input",{type:"password",value:s,onChange:y=>n(y.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your password (optional)"})]}),a.jsx("button",{type:"submit",disabled:d,className:"w-full bg-blue-600 dark:bg-blue-700 text-white py-3 px-4 rounded-lg hover:bg-blue-700 dark:hover:bg-blue-800 transition-colors font-medium btn-animate disabled:opacity-60",children:d?"Signing in...":"Sign In"})]}),v&&a.jsx("div",{className:"mt-4 text-center",children:a.jsx("button",{type:"button",onClick:()=>c(!1),className:"text-xs text-blue-600 hover:underline",children:"Use Google instead"})})]}),a.jsxs("div",{className:"mt-6 text-center text-sm text-gray-600 dark:text-gray-400",children:[a.jsx("p",{children:"Contact your administrator for login credentials"}),a.jsx("p",{className:"mt-1 text-xs",children:"Google sign-in is preferred if available."})]})]})})}function yu({message:e="Loading..."}){return a.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-white dark:bg-gray-900 z-50 transition-colors",children:a.jsxs("div",{className:"flex flex-col items-center gap-4",children:[a.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),a.jsx("p",{className:"text-gray-700 dark:text-gray-200 font-medium",children:e})]})})}const ul=x.createContext(),aa=()=>x.useContext(ul),bu=({children:e})=>{const t=()=>{const i=localStorage.getItem("theme");return i||(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")},[r,s]=x.useState(t);x.useEffect(()=>{const i=window.document.documentElement;i.classList.remove("light-theme","dark-theme"),i.classList.add(`${r}-theme`),localStorage.setItem("theme",r)},[r]);const n=()=>{s(i=>i==="light"?"dark":"light")};return a.jsx(ul.Provider,{value:{theme:r,toggleTheme:n},children:e})},wu=()=>{const{theme:e,toggleTheme:t}=aa();return a.jsxs("button",{onClick:t,className:`p-2 rounded-lg btn-animate ${e==="dark"?"bg-gray-700":"bg-gray-100"}`,"aria-label":`Switch to ${e==="light"?"dark":"light"} mode`,title:`Switch to ${e==="light"?"dark":"light"} mode`,children:[e==="light"?a.jsx(mu,{className:"h-5 w-5 text-gray-600"}):a.jsx(pu,{className:"h-5 w-5 text-yellow-200"}),a.jsx("span",{className:"sr-only",children:"Toggle theme"})]})};function Te(){return Te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Te.apply(null,arguments)}function fr(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;r[s]=e[s]}return r}function Pa(e,t){return Pa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},Pa(e,t)}function Xa(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Pa(e,t)}var ml={exports:{}},ju="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Nu=ju,Su=Nu;function hl(){}function fl(){}fl.resetWarningCache=hl;var Eu=function(){function e(s,n,i,o,l,c){if(c!==Su){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:fl,resetWarningCache:hl};return r.PropTypes=r,r};ml.exports=Eu();var ku=ml.exports;const K=it(ku);function Cu(e,t){return e.classList?!!t&&e.classList.contains(t):(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")!==-1}function pl(e,t){e.classList?e.classList.add(t):Cu(e,t)||(typeof e.className=="string"?e.className=e.className+" "+t:e.setAttribute("class",(e.className&&e.className.baseVal||"")+" "+t))}function hi(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function gl(e,t){e.classList?e.classList.remove(t):typeof e.className=="string"?e.className=hi(e.className,t):e.setAttribute("class",hi(e.className&&e.className.baseVal||"",t))}const fi={disabled:!1},on=E.createContext(null);var xl=function(t){return t.scrollTop},_r="unmounted",_t="exited",rt="entering",mt="entered",Hr="exiting",jt=function(e){Xa(t,e);function t(s,n){var i;i=e.call(this,s,n)||this;var o=n,l=o&&!o.isMounting?s.enter:s.appear,c;return i.appearStatus=null,s.in?l?(c=_t,i.appearStatus=rt):c=mt:s.unmountOnExit||s.mountOnEnter?c=_r:c=_t,i.state={status:c},i.nextCallback=null,i}t.getDerivedStateFromProps=function(n,i){var o=n.in;return o&&i.status===_r?{status:_t}:null};var r=t.prototype;return r.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},r.componentDidUpdate=function(n){var i=null;if(n!==this.props){var o=this.state.status;this.props.in?o!==rt&&o!==mt&&(i=rt):(o===rt||o===mt)&&(i=Hr)}this.updateStatus(!1,i)},r.componentWillUnmount=function(){this.cancelNextCallback()},r.getTimeouts=function(){var n=this.props.timeout,i,o,l;return i=o=l=n,n!=null&&typeof n!="number"&&(i=n.exit,o=n.enter,l=n.appear!==void 0?n.appear:o),{exit:i,enter:o,appear:l}},r.updateStatus=function(n,i){if(n===void 0&&(n=!1),i!==null)if(this.cancelNextCallback(),i===rt){if(this.props.unmountOnExit||this.props.mountOnEnter){var o=this.props.nodeRef?this.props.nodeRef.current:ar.findDOMNode(this);o&&xl(o)}this.performEnter(n)}else this.performExit();else this.props.unmountOnExit&&this.state.status===_t&&this.setState({status:_r})},r.performEnter=function(n){var i=this,o=this.props.enter,l=this.context?this.context.isMounting:n,c=this.props.nodeRef?[l]:[ar.findDOMNode(this),l],d=c[0],u=c[1],m=this.getTimeouts(),f=l?m.appear:m.enter;if(!n&&!o||fi.disabled){this.safeSetState({status:mt},function(){i.props.onEntered(d)});return}this.props.onEnter(d,u),this.safeSetState({status:rt},function(){i.props.onEntering(d,u),i.onTransitionEnd(f,function(){i.safeSetState({status:mt},function(){i.props.onEntered(d,u)})})})},r.performExit=function(){var n=this,i=this.props.exit,o=this.getTimeouts(),l=this.props.nodeRef?void 0:ar.findDOMNode(this);if(!i||fi.disabled){this.safeSetState({status:_t},function(){n.props.onExited(l)});return}this.props.onExit(l),this.safeSetState({status:Hr},function(){n.props.onExiting(l),n.onTransitionEnd(o.exit,function(){n.safeSetState({status:_t},function(){n.props.onExited(l)})})})},r.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},r.safeSetState=function(n,i){i=this.setNextCallback(i),this.setState(n,i)},r.setNextCallback=function(n){var i=this,o=!0;return this.nextCallback=function(l){o&&(o=!1,i.nextCallback=null,n(l))},this.nextCallback.cancel=function(){o=!1},this.nextCallback},r.onTransitionEnd=function(n,i){this.setNextCallback(i);var o=this.props.nodeRef?this.props.nodeRef.current:ar.findDOMNode(this),l=n==null&&!this.props.addEndListener;if(!o||l){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var c=this.props.nodeRef?[this.nextCallback]:[o,this.nextCallback],d=c[0],u=c[1];this.props.addEndListener(d,u)}n!=null&&setTimeout(this.nextCallback,n)},r.render=function(){var n=this.state.status;if(n===_r)return null;var i=this.props,o=i.children;i.in,i.mountOnEnter,i.unmountOnExit,i.appear,i.enter,i.exit,i.timeout,i.addEndListener,i.onEnter,i.onEntering,i.onEntered,i.onExit,i.onExiting,i.onExited,i.nodeRef;var l=fr(i,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return E.createElement(on.Provider,{value:null},typeof o=="function"?o(n,l):E.cloneElement(E.Children.only(o),l))},t}(E.Component);jt.contextType=on;jt.propTypes={};function er(){}jt.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:er,onEntering:er,onEntered:er,onExit:er,onExiting:er,onExited:er};jt.UNMOUNTED=_r;jt.EXITED=_t;jt.ENTERING=rt;jt.ENTERED=mt;jt.EXITING=Hr;var $u=function(t,r){return t&&r&&r.split(" ").forEach(function(s){return pl(t,s)})},js=function(t,r){return t&&r&&r.split(" ").forEach(function(s){return gl(t,s)})},ln=function(e){Xa(t,e);function t(){for(var s,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return s=e.call.apply(e,[this].concat(i))||this,s.appliedClasses={appear:{},enter:{},exit:{}},s.onEnter=function(l,c){var d=s.resolveArguments(l,c),u=d[0],m=d[1];s.removeClasses(u,"exit"),s.addClass(u,m?"appear":"enter","base"),s.props.onEnter&&s.props.onEnter(l,c)},s.onEntering=function(l,c){var d=s.resolveArguments(l,c),u=d[0],m=d[1],f=m?"appear":"enter";s.addClass(u,f,"active"),s.props.onEntering&&s.props.onEntering(l,c)},s.onEntered=function(l,c){var d=s.resolveArguments(l,c),u=d[0],m=d[1],f=m?"appear":"enter";s.removeClasses(u,f),s.addClass(u,f,"done"),s.props.onEntered&&s.props.onEntered(l,c)},s.onExit=function(l){var c=s.resolveArguments(l),d=c[0];s.removeClasses(d,"appear"),s.removeClasses(d,"enter"),s.addClass(d,"exit","base"),s.props.onExit&&s.props.onExit(l)},s.onExiting=function(l){var c=s.resolveArguments(l),d=c[0];s.addClass(d,"exit","active"),s.props.onExiting&&s.props.onExiting(l)},s.onExited=function(l){var c=s.resolveArguments(l),d=c[0];s.removeClasses(d,"exit"),s.addClass(d,"exit","done"),s.props.onExited&&s.props.onExited(l)},s.resolveArguments=function(l,c){return s.props.nodeRef?[s.props.nodeRef.current,l]:[l,c]},s.getClassNames=function(l){var c=s.props.classNames,d=typeof c=="string",u=d&&c?c+"-":"",m=d?""+u+l:c[l],f=d?m+"-active":c[l+"Active"],p=d?m+"-done":c[l+"Done"];return{baseClassName:m,activeClassName:f,doneClassName:p}},s}var r=t.prototype;return r.addClass=function(n,i,o){var l=this.getClassNames(i)[o+"ClassName"],c=this.getClassNames("enter"),d=c.doneClassName;i==="appear"&&o==="done"&&d&&(l+=" "+d),o==="active"&&n&&xl(n),l&&(this.appliedClasses[i][o]=l,$u(n,l))},r.removeClasses=function(n,i){var o=this.appliedClasses[i],l=o.base,c=o.active,d=o.done;this.appliedClasses[i]={},l&&js(n,l),c&&js(n,c),d&&js(n,d)},r.render=function(){var n=this.props;n.classNames;var i=fr(n,["classNames"]);return E.createElement(jt,Te({},i,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},t}(E.Component);ln.defaultProps={classNames:""};ln.propTypes={};function Du(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var ga,xa;function Tu(e,t){return!(e===t||E.isValidElement(e)&&E.isValidElement(t)&&e.key!=null&&e.key===t.key)}var ir={out:"out-in",in:"in-out"},Oa=function(t,r,s){return function(){var n;t.props[r]&&(n=t.props)[r].apply(n,arguments),s()}},Au=(ga={},ga[ir.out]=function(e){var t=e.current,r=e.changeState;return E.cloneElement(t,{in:!1,onExited:Oa(t,"onExited",function(){r(rt,null)})})},ga[ir.in]=function(e){var t=e.current,r=e.changeState,s=e.children;return[t,E.cloneElement(s,{in:!0,onEntered:Oa(s,"onEntered",function(){r(rt)})})]},ga),Mu=(xa={},xa[ir.out]=function(e){var t=e.children,r=e.changeState;return E.cloneElement(t,{in:!0,onEntered:Oa(t,"onEntered",function(){r(mt,E.cloneElement(t,{in:!0}))})})},xa[ir.in]=function(e){var t=e.current,r=e.children,s=e.changeState;return[E.cloneElement(t,{in:!1,onExited:Oa(t,"onExited",function(){s(mt,E.cloneElement(r,{in:!0}))})}),E.cloneElement(r,{in:!0})]},xa),cn=function(e){Xa(t,e);function t(){for(var s,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return s=e.call.apply(e,[this].concat(i))||this,s.state={status:mt,current:null},s.appeared=!1,s.changeState=function(l,c){c===void 0&&(c=s.state.current),s.setState({status:l,current:c})},s}var r=t.prototype;return r.componentDidMount=function(){this.appeared=!0},t.getDerivedStateFromProps=function(n,i){return n.children==null?{current:null}:i.status===rt&&n.mode===ir.in?{status:rt}:i.current&&Tu(i.current,n.children)?{status:Hr}:{current:E.cloneElement(n.children,{in:!0})}},r.render=function(){var n=this.props,i=n.children,o=n.mode,l=this.state,c=l.status,d=l.current,u={children:i,current:d,changeState:this.changeState,status:c},m;switch(c){case rt:m=Mu[o](u);break;case Hr:m=Au[o](u);break;case mt:m=d}return E.createElement(on.Provider,{value:{isMounting:!this.appeared}},m)},t}(E.Component);cn.propTypes={};cn.defaultProps={mode:ir.out};const Pu=({children:e,transitionKey:t})=>{const{theme:r}=aa(),s=x.useRef(null);return a.jsx(cn,{mode:"out-in",children:a.jsx(ln,{nodeRef:s,timeout:300,classNames:"fade",unmountOnExit:!0,children:a.jsx("div",{ref:s,className:"animated-page",children:e})},t)})};function Ve(){const e=new Date;return new Date(e.getTime()+5.5*60*60*1e3).toISOString().slice(0,10)}function Ra(e=null){const t=e?new Date(e):new Date;return isNaN(t.getTime())?Ve():new Date(t.getTime()+5.5*60*60*1e3).toISOString().slice(0,10)}function dn(e=null){if(!e)return Ve();if(typeof e=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;const t=new Date(e);return isNaN(t.getTime())?Ve():Ra(t)}return e instanceof Date?Ra(e):Ve()}function sr(e,t={year:"numeric",month:"long",day:"numeric",weekday:"long"}){return typeof e=="string"&&(e=new Date(e+"T00:00:00")),e.toLocaleDateString("en-IN",t)}function vl(e){if(!e)return"";if(typeof e=="string"){const t=/^(\d{1,2})\s+([a-zA-Z]{3})\s+(\d{4})$/,r=e.match(t);if(r){const n=r[1].padStart(2,"0"),i=r[2],o=r[3],l={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"};l[i]&&(e=`${o==="1900"?new Date().getFullYear().toString():o}-${l[i]}-${n}`)}let s=new Date(e);if(isNaN(s.getTime())&&(s=new Date(e+"T00:00:00")),isNaN(s.getTime()))return e;e=s}return e.toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}function Ur(e,t=null){if(e=parseInt(e,10),t&&Array.isArray(t)){const s=t.find(n=>n.period===e);if(s&&s.start&&s.end)return`${s.start} - ${s.end}`}return{1:"09:00 - 09:45",2:"09:45 - 10:30",3:"10:45 - 11:30",4:"11:30 - 12:15",5:"13:00 - 13:45",6:"13:45 - 14:30",7:"14:45 - 15:30",8:"15:30 - 16:15"}[e]||`Period ${e}`}function pi(e){if(!e)return Ve();if(typeof e=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;const t=/^(\d{1,2})\s+([a-zA-Z]{3})\s+(\d{4})$/,r=e.match(t);if(r){const n=r[1].padStart(2,"0"),i=r[2],o=r[3],l={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"};if(l[i])return`${o==="1900"?new Date().getFullYear().toString():o}-${l[i]}-${n}`}const s=new Date(e);if(!isNaN(s.getTime()))return Ra(s)}return e instanceof Date&&!isNaN(e.getTime())?Ra(e):Ve()}const Ou=({user:e,periodTimes:t})=>{const[r,s]=x.useState(dn(new Date)),[n,i]=x.useState([]),[o,l]=x.useState([]),[c,d]=x.useState(!1),[u,m]=x.useState(""),[f,p]=x.useState(""),[v,g]=x.useState(0),[y,w]=x.useState(t||null),[j,k]=x.useState(""),[S,T]=x.useState(""),[b,$]=x.useState(!0),[A,R]=x.useState(!1),[I,z]=x.useState(null),[Y,B]=x.useState([]),[N,G]=x.useState({substituteTeacher:"",substituteSubject:"",note:""}),[te,X]=x.useState(!0),[W,oe]=x.useState(null),[ce,se]=x.useState([]),ge=(P,h,C)=>{oe({endpoint:P,params:h,timestamp:new Date().toISOString(),success:!!C&&!C.error,error:(C==null?void 0:C.error)||null}),se(O=>[{endpoint:P,params:h,timestamp:new Date().toISOString(),success:!!C&&!C.error,error:(C==null?void 0:C.error)||null},...O.slice(0,9)])},ve=async()=>{d(!0),m("");try{console.log("Fetching timetable for date:",r);const P=await sl(r);console.log("Timetable data response:",P),ge("getDailyTimetableForDate",{date:r},P),P&&Array.isArray(P)?(i(P),m("")):P&&P.success&&P.data?(i(P.data),m("")):(m((P==null?void 0:P.error)||"Failed to fetch timetable"),i([]))}catch(P){console.error("Error fetching timetable:",P),m("Network error while fetching timetable: "+(P.message||P)),i([])}finally{d(!1)}},re=async()=>{try{console.log("Fetching substitutions for date:",r);const P=await Dd(r,{noCache:!0});console.log("Substitution data response:",P),console.log("Response type:",typeof P),ge("getSubstitutionsForDate",{date:r},P);let h=[];if(Array.isArray(P))h=P,console.log("Set substitution data (direct array):",P);else if(P&&P.success&&Array.isArray(P.data))h=P.data,console.log("Set substitution data (response.data array):",P.data);else if(P&&Array.isArray(P.substitutions))h=P.substitutions,console.log("Set substitution data (response.substitutions array):",P.substitutions);else if(P&&P.data&&Array.isArray(P.data.substitutions))h=P.data.substitutions,console.log("Set substitution data (response.data.substitutions array):",P.data.substitutions);else{console.warn("No substitution data found or invalid format. Response:",P),console.log("Attempting direct fetch as fallback...");try{const C=`${pd()}?action=getSubstitutionsForDate&date=${encodeURIComponent(r)}&_=${Date.now()}`;console.log("Direct URL:",C);const O=new XMLHttpRequest;if(O.open("GET",C,!1),O.send(null),O.status===200){const _=JSON.parse(O.responseText);console.log("Fallback response:",_),Array.isArray(_)&&(h=_,console.log("Set substitution data from fallback (direct array):",_))}}catch(C){console.error("Fallback fetch failed:",C)}h.length===0&&(h=[])}console.log("Setting substitution data:",h),l(h),h.length>0?(console.log("FOUND SUBSTITUTIONS:",h.length),h.forEach((C,O)=>{console.log(`Substitution ${O+1}:`,C)})):console.warn("No substitutions found for date",r)}catch(P){console.error("Error fetching substitution data:",P),l([]),ge("getSubstitutionsForDate",{date:r},{error:P.message||String(P)})}},D=[...new Set(n.map(P=>P.teacherName).filter(Boolean))].sort(),U=[...new Set(n.map(P=>P.class).filter(Boolean))].sort(),Z=async()=>{g(P=>P+1),await ve(),await re()};x.useEffect(()=>{r&&(ve(),re())},[r,v]);const ae=n.filter(P=>{var O,_;const h=!j||((O=P.teacherName)==null?void 0:O.toLowerCase().includes(j.toLowerCase())),C=!S||((_=P.class)==null?void 0:_.toLowerCase().includes(S.toLowerCase()));return h&&C}),V=P=>Ur(P,y),Q=(P,h)=>{if(console.log(`Looking for substitution - Period: ${P}, Class: ${h}`),console.log("Available substitution data:",o),!o||o.length===0)return console.log("No substitution data available"),null;const C=o.find(O=>{const _=parseInt(O.period)===parseInt(P),M=String(O.class||"").toLowerCase()===String(h||"").toLowerCase();return console.log(`Checking sub: Period ${O.period} (${_?"✓":"✗"}), Class ${O.class} (${M?"✓":"✗"})`),_&&M});return console.log("Found substitution:",C||"undefined"),C||null},de=async P=>{z(P),G({substituteTeacher:"",substituteSubject:P.subject,note:""});try{console.log("Fetching available teachers for period:",P.period);const h=await Td(r,P.period);console.log("Available teachers response:",h),ge("getAvailableTeachers",{date:r,period:P.period},h),h&&Array.isArray(h)?B(h):h&&h.success&&h.data?B(h.data):B([])}catch(h){console.error("Error fetching available teachers:",h),B([])}R(!0)},Se=async()=>{var P;if(!I||!N.substituteTeacher){m("Please select a substitute teacher");return}try{d(!0),m(""),p("");const h={date:r,period:I.period,class:I.class,absentTeacher:I.teacherEmail||I.teacherName,regularSubject:I.subject,substituteTeacher:N.substituteTeacher,substituteSubject:N.substituteSubject||I.subject,note:N.note||""};console.log("Assigning substitution:",h);const C=await Ad(h);console.log("Assignment response:",C),ge("addSubstitution",h,C);const O=(C==null?void 0:C.success)===!0||(C==null?void 0:C.status)==="success"||((P=C==null?void 0:C.message)==null?void 0:P.toLowerCase().includes("success"));if(console.log("Success check result:",O),O){R(!1);const _=`Successfully assigned ${N.substituteTeacher} to Period ${I.period} - ${I.class}`;p(_),console.log("Setting success message:",_),G({substituteTeacher:"",substituteSubject:"",note:""}),setTimeout(async()=>{try{console.log("Refreshing data after assignment..."),await re(),await ve(),console.log("Data refresh completed")}catch(M){console.error("Error refreshing data:",M)}},500),setTimeout(()=>{p("")},5e3)}else m((C==null?void 0:C.error)||(C==null?void 0:C.message)||"Failed to assign substitute")}catch(h){console.error("Error assigning substitute:",h),m("Network error while assigning substitute: "+(h.message||h)),ge("addSubstitution",{},{error:h.message||String(h)})}finally{d(!1)}},Ae=()=>{try{const P=Object.keys(xe).sort((M,L)=>parseInt(M)-parseInt(L)).flatMap(M=>xe[M].map(L=>{const F=b?Q(parseInt(M),L.class):null,H=!!F;return{period:M,time:V(parseInt(M)),class:L.class,subject:H&&b?`${L.subject} → ${F.substituteSubject}`:L.subject,teacher:H&&b?`${L.teacherName} → ${F.substituteTeacher}`:L.teacherName,status:H?"Substituted":"Regular",note:H?F.note:""}})),h=`
        <html>
          <head>
            <title>Timetable - ${sr(r)}</title>
            <style>
              body { font-family: Arial, sans-serif; margin: 20px; }
              h1 { color: #333; text-align: center; }
              table { width: 100%; border-collapse: collapse; margin-top: 20px; }
              th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
              th { background-color: #f5f5f5; font-weight: bold; }
              .substituted { background-color: #fff3cd; }
              .regular { background-color: #d4edda; }
            </style>
          </head>
          <body>
            <h1>School Timetable ${b?"(With Substitutions)":"(Regular View)"}</h1>
            <h2>${sr(r)}</h2>
            <table>
              <thead>
                <tr>
                  <th>Period</th>
                  <th>Time</th>
                  <th>Class</th>
                  <th>Subject</th>
                  <th>Teacher</th>
                  <th>Status</th>
                  <th>Note</th>
                </tr>
              </thead>
              <tbody>
                ${P.map(M=>`
                  <tr class="${M.status.toLowerCase()}">
                    <td>${M.period}</td>
                    <td>${M.time}</td>
                    <td>${M.class}</td>
                    <td>${M.subject}</td>
                    <td>${M.teacher}</td>
                    <td>${M.status}</td>
                    <td>${M.note}</td>
                  </tr>
                `).join("")}
              </tbody>
            </table>
          </body>
        </html>
      `,C=new Blob([h],{type:"text/html"}),O=URL.createObjectURL(C),_=document.createElement("a");_.href=O,_.download=`timetable-${r}${b?"-with-substitutions":""}.html`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(O)}catch(P){m("Failed to export PDF: "+P.message)}},Ie=()=>{try{const P=["Period","Time","Class","Subject","Teacher","Status","Note"],h=Object.keys(xe).sort((L,F)=>parseInt(L)-parseInt(F)).flatMap(L=>xe[L].map(F=>{const H=b?Q(parseInt(L),F.class):null,q=!!H;return[L,V(parseInt(L)),F.class,q&&b?`${F.subject} → ${H.substituteSubject}`:F.subject,q&&b?`${F.teacherName} → ${H.substituteTeacher}`:F.teacherName,q?"Substituted":"Regular",q?H.note:""]})),C=[P.join(","),...h.map(L=>L.map(F=>`"${String(F).replace(/"/g,'""')}"`).join(","))].join(`
`),O=new Blob([C],{type:"text/csv;charset=utf-8;"}),_=URL.createObjectURL(O),M=document.createElement("a");M.href=_,M.download=`timetable-${r}${b?"-with-substitutions":""}.csv`,document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(_)}catch(P){m("Failed to export Excel: "+P.message)}},xe=ae.reduce((P,h)=>{const C=h.period;return P[C]||(P[C]=[]),P[C].push(h),P},{}),we={},Fe=[...new Set(ae.map(P=>P.period))].sort((P,h)=>parseInt(P)-parseInt(h)),qe=[...new Set(ae.map(P=>P.class))].sort();return Fe.forEach(P=>{we[P]={},qe.forEach(h=>{we[P][h]=null})}),ae.forEach(P=>{P.period&&P.class&&(we[P.period][P.class]=P)}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Substitution Management"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:Z,disabled:c,className:"flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-blue-400 transition-colors",children:[a.jsx(Ma,{className:`w-4 h-4 ${c?"animate-spin":""}`}),"Refresh"]}),a.jsxs("button",{onClick:Ae,className:"flex items-center gap-2 px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[a.jsx(Et,{className:"w-4 h-4"}),"PDF"]}),a.jsxs("button",{onClick:Ie,className:"flex items-center gap-2 px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[a.jsx(lu,{className:"w-4 h-4"}),"Excel"]})]})]}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Date"}),a.jsxs("div",{className:"relative",children:[a.jsx(kt,{className:"absolute left-3 top-3 w-4 h-4 text-gray-400"}),a.jsx("input",{type:"date",value:r,onChange:P=>s(P.target.value),className:"pl-10 w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]}),a.jsx("div",{className:"flex items-end",children:a.jsxs("button",{onClick:Z,disabled:c,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-blue-400 transition-colors",children:[a.jsx(Ma,{className:`w-4 h-4 ${c?"animate-spin":""}`}),c?"Fetching...":"Fetch Timetable"]})}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Filter by Teacher"}),a.jsxs("select",{value:j,onChange:P=>k(P.target.value),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[a.jsx("option",{value:"",children:"All Teachers"}),D.map(P=>a.jsx("option",{value:P,children:P},P))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Filter by Class"}),a.jsxs("select",{value:S,onChange:P=>T(P.target.value),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[a.jsx("option",{value:"",children:"All Classes"}),U.map(P=>a.jsx("option",{value:P,children:P},P))]})]})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("button",{onClick:()=>{const P=!b;console.log("Toggle substitution view:",b,"=>",P),$(P)},className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${b?"bg-green-600 text-white hover:bg-green-700":"bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-500"}`,children:[b?a.jsx(Ft,{className:"w-4 h-4"}):a.jsx(il,{className:"w-4 h-4"}),b?"With Substitutions":"Regular View"]}),a.jsx("button",{onClick:()=>X(!te),className:`flex items-center gap-2 px-3 py-1 text-xs rounded-lg transition-colors ${te?"bg-amber-600 text-white hover:bg-amber-700":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:te?"Hide Debug Info":"Show Debug Info"})]})]}),u&&a.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:a.jsx("p",{className:"text-red-600 dark:text-red-400",children:u})}),f&&a.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:a.jsx("p",{className:"text-green-600 dark:text-green-400",children:f})}),te&&a.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg p-4 text-xs overflow-auto max-h-64",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("h3",{className:"font-bold text-gray-700 dark:text-gray-300",children:"Debug Information"}),a.jsx("button",{onClick:re,className:"text-xs bg-blue-600 text-white px-2 py-1 rounded",children:"Fetch Substitution Data"})]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-3",children:[a.jsxs("div",{children:[a.jsx("strong",{children:"Timetable Data:"})," ",n.length," items"]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Substitution Data:"})," ",o.length," items"]}),a.jsxs("div",{children:[a.jsx("strong",{children:"View Mode:"})," ",b?"With Substitutions":"Regular"]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Selected Date:"})," ",r]})]}),W&&a.jsxs("div",{className:"mb-3 p-2 bg-gray-100 dark:bg-gray-800 rounded",children:[a.jsxs("div",{className:"font-bold mb-1",children:["Last API Call: ",W.endpoint]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("div",{children:[a.jsx("strong",{children:"Params:"})," ",JSON.stringify(W.params)]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Result:"})," ",W.success?"✅ Success":`❌ Error: ${W.error||"Unknown"}`]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("strong",{children:"Timestamp:"})," ",new Date(W.timestamp).toLocaleTimeString()]})]})]}),o.length>0?a.jsxs("div",{className:"mb-3",children:[a.jsxs("div",{className:"font-bold mb-1",children:["Substitution Data (",o.length," records):"]}),a.jsxs("table",{className:"w-full text-xs border-collapse",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"bg-gray-200 dark:bg-gray-700",children:[a.jsx("th",{className:"p-1 border",children:"Period"}),a.jsx("th",{className:"p-1 border",children:"Class"}),a.jsx("th",{className:"p-1 border",children:"Absent"}),a.jsx("th",{className:"p-1 border",children:"Substitute"}),a.jsx("th",{className:"p-1 border",children:"Subject"})]})}),a.jsx("tbody",{children:o.map((P,h)=>a.jsxs("tr",{className:"hover:bg-gray-100 dark:hover:bg-gray-800",children:[a.jsx("td",{className:"p-1 border",children:P.period}),a.jsx("td",{className:"p-1 border",children:P.class}),a.jsx("td",{className:"p-1 border",children:P.absentTeacher}),a.jsx("td",{className:"p-1 border",children:P.substituteTeacher}),a.jsx("td",{className:"p-1 border",children:P.substituteSubject||P.regularSubject})]},h))})]})]}):a.jsx("div",{className:"mb-3 text-amber-600",children:"No substitution data available."}),a.jsxs("div",{className:"mb-3",children:[a.jsx("button",{onClick:()=>console.log("Substitution data:",o),className:"text-xs bg-gray-600 text-white px-2 py-1 rounded mr-2",children:"Log Substitution Data"}),a.jsx("button",{onClick:()=>console.log("Timetable data:",n),className:"text-xs bg-gray-600 text-white px-2 py-1 rounded",children:"Log Timetable Data"})]})]}),n.length>0&&a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden",children:[a.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Timetable for ",sr(r)]}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Classes (rows) × Periods (columns)"})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full border-collapse",children:[a.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300 border",children:"Class / Period"}),Fe.map(P=>a.jsxs("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-700 dark:text-gray-300 border",children:[a.jsxs("div",{children:["Period ",P]}),a.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:V(parseInt(P))})]},P))]})}),a.jsx("tbody",{children:qe.map(P=>a.jsxs("tr",{className:qe.indexOf(P)%2===0?"bg-gray-50 dark:bg-gray-800/50":"",children:[a.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-white font-medium border",children:P}),Fe.map(h=>{const C=ae.find(M=>M.class===P&&M.period===h);if(!C)return a.jsx("td",{className:"px-4 py-3 text-sm text-gray-400 dark:text-gray-500 text-center border",children:"-"},`${P}-${h}`);const O=b?Q(parseInt(h),P):null,_=!!O;return a.jsx("td",{className:`px-4 py-3 text-sm border ${_?"bg-orange-50 dark:bg-orange-900/20":""}`,children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:_&&b?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"line-through text-gray-500",children:C.subject}),a.jsx("div",{className:"text-orange-600 dark:text-orange-400",children:O.substituteSubject||O.regularSubject})]}):C.subject}),a.jsx("div",{className:"text-xs mt-1",children:_&&b?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"line-through text-gray-500",children:C.teacherName}),a.jsx("div",{className:"text-orange-600 dark:text-orange-400",children:O.substituteTeacher})]}):C.teacherName}),a.jsx("div",{className:"mt-2",children:_?a.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400",children:"Substituted"}):a.jsxs("button",{onClick:()=>de(C),className:"flex items-center justify-center gap-1 px-2 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700 transition-colors w-full",children:[a.jsx(cl,{className:"w-3 h-3"}),"Assign"]})})]})},`${P}-${h}`)})]},`class-${P}`))})]})})]}),A&&I&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Assign Substitute Teacher"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Period: ",I.period," | Class: ",I.class]}),a.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Absent Teacher: ",I.teacherName]}),a.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Regular Subject: ",I.subject]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Substitute Teacher *"}),a.jsxs("select",{value:N.substituteTeacher,onChange:P=>G(h=>({...h,substituteTeacher:P.target.value})),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",required:!0,children:[a.jsx("option",{value:"",children:"Select a teacher..."}),Y.map(P=>{var h;return a.jsxs("option",{value:P.name,children:[P.name," (",(h=P.subjects)==null?void 0:h.join(", "),")"]},P.email||P.name)})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Substitute Subject"}),a.jsx("input",{type:"text",value:N.substituteSubject,onChange:P=>G(h=>({...h,substituteSubject:P.target.value})),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Note (Optional)"}),a.jsx("textarea",{value:N.note,onChange:P=>G(h=>({...h,note:P.target.value})),rows:3,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Any additional notes..."})]})]}),a.jsxs("div",{className:"flex gap-3 mt-6",children:[a.jsx("button",{onClick:()=>R(!1),disabled:c,className:`flex-1 px-4 py-2 rounded-lg transition-colors ${c?"bg-gray-300 cursor-not-allowed text-gray-500":"text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500"}`,children:"Cancel"}),a.jsx("button",{onClick:Se,disabled:c||!N.substituteTeacher,className:`flex-1 px-4 py-2 rounded-lg transition-colors flex items-center justify-center ${c||!N.substituteTeacher?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"} text-white`,children:c?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Assigning..."]}):"Assign Substitute"})]})]})}),!c&&n.length===0&&a.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[a.jsx(kt,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"No timetable data found for the selected date."}),a.jsx("p",{className:"text-sm",children:'Click "Fetch Timetable" to load data.'})]})]})},Ru=["Not Started","Partially Completed","Fully Completed"],_u=["in plan","not planned"];function Lu({user:e}){const[t,r]=x.useState(Ve()),[s,n]=x.useState([]),[i,o]=x.useState({}),[l,c]=x.useState({}),[d,u]=x.useState(!1),[m,f]=x.useState({}),[p,v]=x.useState(""),[g,y]=x.useState([]),[w,j]=x.useState([]),[k,S]=x.useState(null),[T,b]=x.useState({}),[$,A]=x.useState({}),[R,I]=x.useState(""),[z,Y]=x.useState(!1),[B,N]=x.useState([]),G=(e==null?void 0:e.email)||"",te=(e==null?void 0:e.name)||"";function X(D){return`${D.period}|${D.class}|${D.subject}`}async function W(D,U){if(!D||!U||!G)return[];try{const Z=await Ed(G,D,U);return Array.isArray(Z)?Z:[]}catch(Z){return console.error("Failed to fetch lesson plans:",Z),[]}}async function oe(){if(!G){console.log("❌ No email provided for timetable load");return}u(!0),v("");try{console.log("🔍 Loading timetable for:",{email:G,date:t,user:e});const[D,U,Z]=await Promise.all([Zn(G,t),tl(G,t),Ws(te).catch(xe=>(console.warn("Could not load lesson delays:",xe),[]))]);console.log("📅 Timetable response:",D),console.log("📝 Reports response:",U),console.log("⏰ Delays response:",Z),console.log("🐛 Debug info from API:",D==null?void 0:D.debug),N(Z||[]);let ae=[];Array.isArray(D)?ae=D:D&&Array.isArray(D.periods)?ae=D.periods:D&&D.data&&Array.isArray(D.data)?ae=D.data:console.log("⚠️ Unexpected timetable response format:",D),console.log("📚 Normalized timetable list:",ae),n(ae);const V={};(Array.isArray(U)?U:[]).forEach(xe=>{V[`${xe.period}|${xe.class}|${xe.subject}`]=xe.status||"Not Submitted"}),o(V);const Q={},de=new Set;ae.forEach(xe=>{const we=`${xe.class}|${xe.subject}`;de.has(we)||de.add(we)}),console.log("📋 Fetching lesson plans for",de.size,"class/subject combinations...");const Se=Array.from(de).map(async xe=>{const[we,Fe]=xe.split("|");try{const qe=await W(we,Fe);return[xe,qe]}catch(qe){return console.warn(`Failed to fetch lesson plans for ${we}/${Fe}:`,qe),[xe,[]]}});(await Promise.all(Se)).forEach(([xe,we])=>{Q[xe]=we}),A(Q),console.log("✅ Lesson plans loaded for",Object.keys(Q).length,"combinations");const Ie={};if(ae.forEach(xe=>{const we=X(xe);(!V[we]||V[we]==="Not Submitted")&&(Ie[we]={planType:"not planned",lessonPlanId:"",chapter:xe.chapter||"",objectives:"",activities:"",completed:"Not Started",notes:""})}),c(Ie),!ae.length){const xe=(D==null?void 0:D.debug)||{};v(`No periods on this day. Debug: Found ${xe.regularPeriodsFound||0} regular periods and ${xe.substitutionPeriodsFound||0} substitution periods for ${xe.dayName||"unknown day"}.`)}}catch(D){console.error("❌ Error loading timetable:",D),v(`Unable to load timetable or reports. Error: ${D.message||D}`)}finally{u(!1)}}x.useEffect(()=>{oe()},[t,G]);function ce(D,U,Z){c(ae=>({...ae,[D]:{...ae[D]||{},[U]:Z}}))}function se(D,U){var Q;const Z=s.find(de=>X(de)===D);if(!Z)return;const ae=`${Z.class}|${Z.subject}`,V=(Q=$[ae])==null?void 0:Q.find(de=>de.lpId===U);c(V?de=>({...de,[D]:{...de[D]||{},lessonPlanId:U,chapter:V.chapter||"",objectives:V.objectives||"",activities:V.activities||""}}):de=>{var Se,Ae,Ie;return{...de,[D]:{...de[D]||{},lessonPlanId:"",chapter:((Se=de[D])==null?void 0:Se.chapter)||"",objectives:((Ae=de[D])==null?void 0:Ae.objectives)||"",activities:((Ie=de[D])==null?void 0:Ie.activities)||""}}})}async function ge(D){const U=X(D),Z=l[U]||{};if(i[U]==="Submitted")return;if(!(Z.objectives&&Z.objectives.trim()||Z.activities&&Z.activities.trim()||Z.completed!=="Not Started"||Z.notes&&Z.notes.trim())){v("Please fill something (objectives/activities/completion/notes) before submitting.");return}f(V=>({...V,[U]:!0})),v("");try{const V={date:t,teacherEmail:G,teacherName:te,class:D.class,subject:D.subject,period:Number(D.period),planType:Z.planType||"not planned",lessonPlanId:Z.lessonPlanId||"",chapter:Z.chapter||D.chapter||"",objectives:Z.objectives||"",activities:Z.activities||"",completed:Z.completed||"Not Started",notes:Z.notes||""},Q=await Cd(V);Q&&(Q.ok||Q.submitted)?(o(de=>({...de,[U]:"Submitted"})),c(de=>{const Se={...de};return delete Se[U],Se}),v("Report submitted successfully!")):v("Failed to submit report.")}catch(V){console.error(V),v("Error submitting report: "+(V.message||V))}finally{f(V=>({...V,[U]:!1}))}}async function ve(){const D=s.filter(U=>i[X(U)]!=="Submitted");if(!D.length){v("All reports already submitted.");return}for(const U of D)await ge(U)}const re=t?sr(t):"";return a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Daily Reporting"}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("label",{htmlFor:"daily-report-date",className:"text-sm font-medium text-gray-700",children:"Date:"}),a.jsx("input",{id:"daily-report-date",name:"daily-report-date",type:"date",value:t,onChange:D=>r(D.target.value),className:"border border-gray-300 rounded-md px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),a.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 text-sm font-medium transition-colors",onClick:oe,disabled:d,children:d?"Loading...":"Refresh"}),a.jsx("button",{className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 text-sm font-medium transition-colors",onClick:async()=>{try{const D=await Zn(G,t);alert(`API Response: ${JSON.stringify(D,null,2)}`)}catch(D){alert(`API Error: ${D.message}`)}},children:"Test API"}),s.length>0&&a.jsx("button",{className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 text-sm font-medium transition-colors",onClick:ve,children:"Submit All"})]})]}),B.length>0&&a.jsx("div",{className:"mb-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"h-5 w-5 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),a.jsxs("div",{className:"ml-3",children:[a.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Lesson Progress Delays"}),a.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:a.jsxs("p",{children:["You have ",B.length," lesson(s) with completion delays. Consider reviewing your lesson progress."]})})]})]})}),re&&a.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:a.jsx("p",{className:"text-blue-800 font-medium",children:re})}),p&&a.jsx("div",{className:`mb-4 p-3 rounded-lg ${p.includes("success")?"bg-green-50 border border-green-200 text-green-800":p.includes("Error")||p.includes("Failed")?"bg-red-50 border border-red-200 text-red-800":"bg-yellow-50 border border-yellow-200 text-yellow-800"}`,children:p}),d?a.jsxs("div",{className:"flex items-center justify-center py-12",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),a.jsx("div",{className:"ml-3 text-gray-600",children:"Loading timetable..."})]}):a.jsx("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"Period"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[120px]",children:"Class"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[140px]",children:"Subject"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[120px]",children:"Plan Type"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[120px]",children:"Chapter"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[200px]",children:"Objectives"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[200px]",children:"Activities"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[140px]",children:"Completed"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[150px]",children:"Notes"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32",children:"Action"})]})}),a.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[s.map(D=>{const U=X(D),Z=i[U]==="Submitted",ae=l[U]||{},V=m[U];return a.jsxs("tr",{className:Z?"bg-green-50":"",children:[a.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:["#",D.period,a.jsx("div",{className:"text-xs text-gray-500 mt-1",children:Ur(D.period)})]}),a.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:D.class}),a.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:D.subject}),a.jsx("td",{className:"px-4 py-3",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("select",{id:`planType-${U}`,name:`planType-${U}`,value:ae.planType||"not planned",disabled:Z,onChange:Q=>ce(U,"planType",Q.target.value),className:"w-full text-sm border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",children:_u.map(Q=>a.jsx("option",{value:Q,children:Q},Q))}),ae.planType==="in plan"&&a.jsxs("select",{id:`lessonPlan-${U}`,name:`lessonPlan-${U}`,value:ae.lessonPlanId||"",disabled:Z,onChange:Q=>se(U,Q.target.value),className:"w-full text-sm border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",children:[a.jsx("option",{value:"",children:"Select Lesson Plan"}),($[`${D.class}|${D.subject}`]||[]).map(Q=>a.jsxs("option",{value:Q.lpId,children:[Q.chapter," (Session ",Q.session,")"]},Q.lpId))]})]})}),a.jsx("td",{className:"px-4 py-3",children:a.jsx("input",{id:`chapter-${U}`,name:`chapter-${U}`,type:"text",placeholder:"Chapter name",disabled:Z,value:ae.chapter||D.chapter||"",onChange:Q=>ce(U,"chapter",Q.target.value),className:"w-full text-sm border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100"})}),a.jsx("td",{className:"px-4 py-3",children:a.jsx("textarea",{id:`objectives-${U}`,name:`objectives-${U}`,placeholder:"Brief objectives",disabled:Z,value:ae.objectives||"",onChange:Q=>ce(U,"objectives",Q.target.value),className:"w-full text-sm border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",rows:"2"})}),a.jsx("td",{className:"px-4 py-3",children:a.jsx("textarea",{id:`activities-${U}`,name:`activities-${U}`,placeholder:"What was done",disabled:Z,value:ae.activities||"",onChange:Q=>ce(U,"activities",Q.target.value),className:"w-full text-sm border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",rows:"2"})}),a.jsx("td",{className:"px-4 py-3",children:a.jsx("select",{id:`completed-${U}`,name:`completed-${U}`,value:ae.completed||"Not Started",disabled:Z,onChange:Q=>ce(U,"completed",Q.target.value),className:"w-full text-sm border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",children:Ru.map(Q=>a.jsx("option",{value:Q,children:Q},Q))})}),a.jsx("td",{className:"px-4 py-3",children:a.jsx("textarea",{id:`notes-${U}`,name:`notes-${U}`,placeholder:"Extra notes",disabled:Z,value:ae.notes||"",onChange:Q=>ce(U,"notes",Q.target.value),className:"w-full text-sm border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",rows:"2"})}),a.jsx("td",{className:"px-4 py-3",children:Z?a.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800",children:"Submitted"}):a.jsx("button",{className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 disabled:opacity-50 transition-colors",onClick:()=>ge(D),disabled:V,children:V?"...":"Submit"})})]},U)}),s.length===0&&!d&&a.jsx("tr",{children:a.jsx("td",{colSpan:10,className:"px-4 py-8 text-center text-gray-500",children:"No periods scheduled for this date."})})]})]})})})]})}function Iu({user:e,periodTimes:t}){const{theme:r}=aa(),[s,n]=x.useState(dn(new Date)),[i,o]=x.useState([]),[l,c]=x.useState([]),[d,u]=x.useState(!1),[m,f]=x.useState(!1),[p,v]=x.useState(null),[g,y]=x.useState(""),[w,j]=x.useState(t||null),[k,S]=x.useState(""),[T,b]=x.useState(!1),$=W=>{if(!Array.isArray(W)||W.length===0)return{classes:[],periods:[],classMap:{}};const oe=new Set,ce=new Set;W.forEach(re=>{re.period&&oe.add(Number(re.period)),re.class&&ce.add(re.class)});const se=Array.from(oe).sort((re,D)=>re-D),ge=Array.from(ce).sort((re,D)=>{const U=parseInt(re.match(/^\d+/)||"0"),Z=parseInt(D.match(/^\d+/)||"0");return U!==Z?U-Z:re.localeCompare(D)}),ve={};return ge.forEach(re=>{ve[re]={},se.forEach(D=>{const U=W.find(Z=>Z.class===re&&Number(Z.period)===Number(D));ve[re][D]=U||null})}),{classes:ge,periods:se,classMap:ve}},A=(W,oe)=>l.find(ce=>ce.class===W&&Number(ce.period)===Number(oe)),R=async()=>{if(s){u(!0),v(null);try{const W=await sl(s);Array.isArray(W)?o(W):W&&Array.isArray(W.data)?o(W.data):(v((W==null?void 0:W.error)||"Invalid timetable data format"),o([]))}catch(W){console.error("Error fetching timetable:",W),v("Network error while fetching timetable: "+(W.message||W)),o([])}finally{u(!1)}}},I=async()=>{if(s){f(!0);try{const W=await $d(s);if(W&&Array.isArray(W.assignedSubstitutions))c(W.assignedSubstitutions);else try{const oe=await al(s);if(oe&&Array.isArray(oe.timetable)){const ce=oe.timetable.filter(se=>se&&se.isSubstitution).map(se=>({date:s,period:Number(se.period||0),class:String(se.class||""),absentTeacher:se.absentTeacher||"",regularSubject:String(se.subject||""),substituteTeacher:String(se.teacher||""),substituteSubject:String(se.subject||""),note:se.note||""}));c(ce)}else c([])}catch{c([])}}catch(W){console.error("Error fetching substitutions:",W)}finally{f(!1)}}},z=()=>{R(),I()};x.useEffect(()=>{R(),I()},[s]);const Y=[...new Set(i.map(W=>W.class).filter(Boolean))],B=k?i.filter(W=>W.class===k):i,{classes:N,periods:G,classMap:te}=$(B),X={};return G.forEach(W=>{X[W]=Ur(W,w)}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:`text-2xl font-bold ${r==="dark"?"text-white":"text-gray-900"}`,children:"Class-Period View"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>b(!T),className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 rounded-lg p-2",children:T?a.jsx(il,{className:"h-5 w-5"}):a.jsx(Ft,{className:"h-5 w-5"})}),a.jsxs("button",{onClick:z,className:"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg px-3 py-2 flex items-center hover:bg-gray-200 dark:hover:bg-gray-600",disabled:d||m,children:[m?a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"}):a.jsx(Ma,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),a.jsx("div",{className:`${r==="dark"?"bg-gray-800":"bg-white"} p-4 md:p-6 rounded-lg shadow-sm`,children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:`block text-sm font-medium ${r==="dark"?"text-gray-300":"text-gray-700"} mb-1`,children:[a.jsx(kt,{className:"inline h-4 w-4 mr-1 -mt-1"})," Date"]}),a.jsx("input",{type:"date",value:s,onChange:W=>n(W.target.value),className:`w-full px-3 py-2 border ${r==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} rounded focus:ring-2 focus:ring-blue-500`})]}),a.jsxs("div",{children:[a.jsxs("label",{className:`block text-sm font-medium ${r==="dark"?"text-gray-300":"text-gray-700"} mb-1`,children:[a.jsx(Aa,{className:"inline h-4 w-4 mr-1 -mt-1"})," Class Filter"]}),a.jsxs("select",{value:k,onChange:W=>S(W.target.value),className:`w-full px-3 py-2 border ${r==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} rounded focus:ring-2 focus:ring-blue-500`,children:[a.jsx("option",{value:"",children:"All Classes"}),Y.map(W=>a.jsx("option",{value:W,children:W},W))]})]})]})}),p&&a.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(nn,{className:"h-5 w-5 text-red-600 mr-2"}),p]})}),g&&a.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(oi,{className:"h-5 w-5 text-green-600 mr-2"}),g]})}),a.jsxs("div",{className:`${r==="dark"?"bg-gray-800":"bg-white"} p-4 rounded-lg shadow-sm overflow-x-auto`,children:[a.jsxs("h2",{className:`text-xl font-semibold mb-4 ${r==="dark"?"text-gray-200":"text-gray-900"}`,children:["Timetable for ",sr(s)]}),d?a.jsx("div",{className:"flex justify-center p-6",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):N.length>0&&G.length>0?a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full border-collapse",children:[a.jsx("thead",{children:a.jsxs("tr",{className:`${r==="dark"?"bg-gray-700":"bg-gray-100"}`,children:[a.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${r==="dark"?"text-gray-300":"text-gray-700"} uppercase tracking-wider border`,children:"Class / Period"}),G.map(W=>a.jsxs("th",{className:`px-6 py-3 text-left text-xs font-medium ${r==="dark"?"text-gray-300":"text-gray-700"} uppercase tracking-wider border text-center`,children:[a.jsxs("div",{children:["Period ",W]}),a.jsx("div",{className:"text-xs font-normal normal-case",children:X[W]||""})]},W))]})}),a.jsx("tbody",{className:"divide-y",children:N.map(W=>a.jsxs("tr",{className:`${r==="dark"?"bg-gray-800 hover:bg-gray-750":"bg-white hover:bg-gray-50"}`,children:[a.jsx("td",{className:`px-6 py-4 whitespace-nowrap text-sm font-medium ${r==="dark"?"text-white":"text-gray-900"} border`,children:W}),G.map(oe=>{const ce=te[W][oe],se=A(W,oe),ge=!!se;return a.jsx("td",{className:`px-4 py-3 text-sm border ${ge?r==="dark"?"bg-green-900/20":"bg-green-50":""}`,children:ce?a.jsxs("div",{children:[a.jsx("div",{className:`${r==="dark"?"text-gray-200":"text-gray-900"} font-medium`,children:ce.subject}),a.jsx("div",{className:"text-xs mt-1 flex items-center justify-between",children:a.jsx("span",{className:`${r==="dark"?"text-gray-400":"text-gray-600"}`,children:ge?a.jsxs("span",{className:"flex items-center text-green-600",children:[a.jsx(oi,{className:"h-3 w-3 mr-1"}),se.substituteTeacher||ce.teacherName]}):ce.teacherName})})]}):null},`${W}-${oe}`)})]},W))})]})}):a.jsx("div",{className:"text-center py-10",children:a.jsx("p",{className:`${r==="dark"?"text-gray-400":"text-gray-500"} text-lg`,children:"No timetable data available for this date."})})]}),l.length>0&&a.jsxs("div",{className:`${r==="dark"?"bg-gray-800":"bg-white"} p-4 rounded-lg shadow-sm`,children:[a.jsxs("h2",{className:`text-xl font-semibold mb-4 ${r==="dark"?"text-gray-200":"text-gray-900"}`,children:["Substitutions for ",sr(s)]}),a.jsxs("table",{className:"min-w-full",children:[a.jsx("thead",{className:`${r==="dark"?"bg-gray-700":"bg-gray-50"}`,children:a.jsxs("tr",{children:[a.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${r==="dark"?"text-gray-300":"text-gray-500"} uppercase tracking-wider`,children:"Period"}),a.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${r==="dark"?"text-gray-300":"text-gray-500"} uppercase tracking-wider`,children:"Class"}),a.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${r==="dark"?"text-gray-300":"text-gray-500"} uppercase tracking-wider`,children:"Regular Teacher"}),a.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${r==="dark"?"text-gray-300":"text-gray-500"} uppercase tracking-wider`,children:"Subject"}),a.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${r==="dark"?"text-gray-300":"text-gray-500"} uppercase tracking-wider`,children:"Substitute Teacher"})]})}),a.jsx("tbody",{className:`${r==="dark"?"bg-gray-800":"bg-white"} divide-y ${r==="dark"?"divide-gray-700":"divide-gray-200"}`,children:l.map((W,oe)=>a.jsxs("tr",{children:[a.jsx("td",{className:`px-6 py-4 whitespace-nowrap text-sm ${r==="dark"?"text-gray-300":"text-gray-900"}`,children:W.period}),a.jsx("td",{className:`px-6 py-4 whitespace-nowrap text-sm ${r==="dark"?"text-gray-300":"text-gray-900"}`,children:W.class}),a.jsx("td",{className:`px-6 py-4 whitespace-nowrap text-sm ${r==="dark"?"text-gray-300":"text-gray-900"}`,children:W.absentTeacher||"N/A"}),a.jsx("td",{className:`px-6 py-4 whitespace-nowrap text-sm ${r==="dark"?"text-gray-300":"text-gray-900"}`,children:W.regularSubject||W.subject}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600",children:W.substituteTeacher||W.teacher})]},`${W.period}-${W.class}-${oe}`))})]})]}),T&&a.jsxs("div",{className:`${r==="dark"?"bg-gray-800":"bg-white"} p-4 rounded-lg shadow-sm border border-yellow-500`,children:[a.jsx("h2",{className:`text-xl font-semibold mb-4 ${r==="dark"?"text-gray-200":"text-gray-900"}`,children:"Debug Information"}),a.jsxs("div",{className:"overflow-auto max-h-96",children:[a.jsx("pre",{className:`text-xs ${r==="dark"?"text-gray-300":"text-gray-700"}`,children:JSON.stringify({date:s,substitutionsCount:l.length,timetableCount:i.length,uniqueClasses:Y.length,periods:G.length,classes:N.length},null,2)}),a.jsxs("details",{children:[a.jsx("summary",{className:`cursor-pointer mt-2 text-sm font-medium ${r==="dark"?"text-blue-400":"text-blue-600"}`,children:"Show Substitutions Data"}),a.jsx("pre",{className:`text-xs mt-2 ${r==="dark"?"text-gray-300":"text-gray-700"}`,children:JSON.stringify(l,null,2)})]})]})]})]})}function Fu({user:e}){const{theme:t}=aa(),r=Ka();if(!e)return a.jsx("p",{children:"Not logged in"});const s=()=>{r!=null&&r.user&&r.logout(),localStorage.removeItem("user"),localStorage.removeItem("sf_google_session"),window.location.reload()};return a.jsx("div",{className:`${t==="dark"?"bg-gray-800 text-white":"bg-white"} py-2 px-4 shadow-sm mb-6 transition-colors duration-300`,children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("p",{className:`${t==="dark"?"text-gray-100":"text-gray-700"} transition-colors duration-300`,children:["Logged in as: ",a.jsx("span",{className:"font-medium",children:e.name})," (",a.jsx("span",{className:`${t==="dark"?"text-gray-300":"text-gray-600"} transition-colors duration-300`,children:e.email}),") - Role:"," ",a.jsx("span",{className:`${t==="dark"?"bg-blue-900 text-blue-100":"bg-blue-100 text-blue-800"} px-2 py-0.5 rounded-full text-xs font-medium transition-colors duration-300`,children:Array.isArray(e.role)?e.role.join(", "):e.role})]}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx(wu,{}),a.jsxs("button",{onClick:s,className:`flex items-center px-3 py-1 rounded ${t==="dark"?"bg-red-800 hover:bg-red-700 text-white":"bg-red-600 hover:bg-red-700 text-white"} transition-colors duration-300`,children:[a.jsx(uu,{className:"h-4 w-4 mr-1"}),a.jsx("span",{children:"Logout"})]})]})]})})}function Wu({user:e,children:t,activeView:r,navigationItems:s}){const{theme:n}=aa();Ka();const i=o=>!e||!o.roles?!0:o.roles.some(l=>Array.isArray(e.role)?e.role.includes(l):e.role===l);return a.jsxs("div",{className:`min-h-screen ${n==="dark"?"bg-gray-900":"bg-gray-100"} transition-colors duration-300`,children:[a.jsx(Fu,{user:e}),a.jsx("div",{className:"container mx-auto px-4 py-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[a.jsx("div",{className:"md:col-span-1",children:a.jsxs("div",{className:`${n==="dark"?"bg-gray-800":"bg-white"} rounded-lg shadow-sm p-4 transition-colors duration-300`,children:[a.jsx("h3",{className:`text-lg font-medium ${n==="dark"?"text-white":"text-gray-900"} mb-4 transition-colors duration-300`,children:"Navigation"}),a.jsx("nav",{className:"space-y-1",children:s&&s.filter(i).map(o=>a.jsx("a",{href:"#",onClick:l=>{l.preventDefault(),o.onClick&&o.onClick(o.id)},className:`block px-3 py-2 rounded-md text-sm font-medium ${r===o.id?n==="dark"?"bg-blue-900 text-blue-200":"bg-blue-50 text-blue-700":n==="dark"?"text-gray-300 hover:bg-gray-700":"text-gray-700 hover:bg-gray-50"} transition-colors duration-300`,children:a.jsxs("div",{className:"flex items-center",children:[o.icon&&a.jsx("span",{className:"mr-3",children:a.jsx(o.icon,{className:"h-5 w-5"})}),o.label]})},o.id))})]})}),a.jsx("div",{className:"md:col-span-3",children:t})]})}),a.jsx("footer",{className:`${n==="dark"?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} mt-12 py-6 border-t transition-colors duration-300`,children:a.jsxs("div",{className:`container mx-auto px-4 text-center ${n==="dark"?"text-gray-400":"text-gray-500"} text-sm transition-colors duration-300`,children:["© ",new Date().getFullYear()," SchoolFlow - School Management System"]})})]})}function bt(e){"@babel/helpers - typeof";return bt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bt(e)}function Hu(e,t){if(bt(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t);if(bt(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function yl(e){var t=Hu(e,"string");return bt(t)=="symbol"?t:t+""}function Wt(e,t,r){return(t=yl(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gi(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,s)}return r}function Ne(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gi(Object(r),!0).forEach(function(s){Wt(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gi(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function pt(e,t){if(e==null)return{};var r,s,n=fr(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)r=i[s],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function _e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xi(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,yl(s.key),s)}}function Le(e,t,r){return t&&xi(e.prototype,t),r&&xi(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _a(e){return _a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_a(e)}function bl(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(bl=function(){return!!e})()}function Uu(e,t){if(t&&(bt(t)=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Du(e)}function Be(e,t,r){return t=_a(t),Uu(e,bl()?Reflect.construct(t,r||[],_a(e).constructor):t.apply(e,r))}function Ge(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Pa(e,t)}function wl(e){if(Array.isArray(e))return e}function zu(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var s,n,i,o,l=[],c=!0,d=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(c=(s=i.call(r)).done)&&(l.push(s.value),l.length!==t);c=!0);}catch(u){d=!0,n=u}finally{try{if(!c&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(d)throw n}}return l}}function Us(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,s=Array(t);r<t;r++)s[r]=e[r];return s}function un(e,t){if(e){if(typeof e=="string")return Us(e,t);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Us(e,t):void 0}}function jl(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zt(e,t){return wl(e)||zu(e,t)||un(e,t)||jl()}function Nl(e){var t,r,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(r=Nl(e[t]))&&(s&&(s+=" "),s+=r);else for(t in e)e[t]&&(s&&(s+=" "),s+=t);return s}function Me(){for(var e,t,r=0,s="";r<arguments.length;)(e=arguments[r++])&&(t=Nl(e))&&(s&&(s+=" "),s+=t);return s}var Bu=function(e,t,r,s,n,i,o,l){if(!e){var c;if(t===void 0)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var d=[r,s,n,i,o,l],u=0;c=new Error(t.replace(/%s/g,function(){return d[u++]})),c.name="Invariant Violation"}throw c.framesToPop=1,c}},Gu=Bu;const zr=it(Gu);var qu=function(){};function Yu(e,t){var r={};return Object.keys(e).forEach(function(s){r[Ea(s)]=qu}),r}function vi(e,t){return e[t]!==void 0}function Ea(e){return"default"+e.charAt(0).toUpperCase()+e.substr(1)}function Vu(e){return!!e&&(typeof e!="function"||e.prototype&&e.prototype.isReactComponent)}function Sl(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);e!=null&&this.setState(e)}function El(e){function t(r){var s=this.constructor.getDerivedStateFromProps(e,r);return s??null}this.setState(t.bind(this))}function kl(e,t){try{var r=this.props,s=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(r,s)}finally{this.props=r,this.state=s}}Sl.__suppressDeprecationWarning=!0;El.__suppressDeprecationWarning=!0;kl.__suppressDeprecationWarning=!0;function Ku(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if(typeof e.getDerivedStateFromProps!="function"&&typeof t.getSnapshotBeforeUpdate!="function")return e;var r=null,s=null,n=null;if(typeof t.componentWillMount=="function"?r="componentWillMount":typeof t.UNSAFE_componentWillMount=="function"&&(r="UNSAFE_componentWillMount"),typeof t.componentWillReceiveProps=="function"?s="componentWillReceiveProps":typeof t.UNSAFE_componentWillReceiveProps=="function"&&(s="UNSAFE_componentWillReceiveProps"),typeof t.componentWillUpdate=="function"?n="componentWillUpdate":typeof t.UNSAFE_componentWillUpdate=="function"&&(n="UNSAFE_componentWillUpdate"),r!==null||s!==null||n!==null){var i=e.displayName||e.name,o=typeof e.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error(`Unsafe legacy lifecycles will not be called for components using new component APIs.

`+i+" uses "+o+" but also contains the following legacy lifecycles:"+(r!==null?`
  `+r:"")+(s!==null?`
  `+s:"")+(n!==null?`
  `+n:"")+`

The above lifecycles should be removed. Learn more about this warning here:
https://fb.me/react-async-component-lifecycle-hooks`)}if(typeof e.getDerivedStateFromProps=="function"&&(t.componentWillMount=Sl,t.componentWillReceiveProps=El),typeof t.getSnapshotBeforeUpdate=="function"){if(typeof t.componentDidUpdate!="function")throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=kl;var l=t.componentDidUpdate;t.componentDidUpdate=function(d,u,m){var f=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:m;l.call(this,d,u,f)}}return e}var Xu="/Users/jquense/src/uncontrollable/src/uncontrollable.js";function Cl(e,t,r){r===void 0&&(r=[]);var s=e.displayName||e.name||"Component",n=Vu(e),i=Object.keys(t),o=i.map(Ea);n||!r.length||zr(!1);var l=function(d){Xa(u,d);function u(){for(var f,p=arguments.length,v=new Array(p),g=0;g<p;g++)v[g]=arguments[g];f=d.call.apply(d,[this].concat(v))||this,f.handlers=Object.create(null),i.forEach(function(w){var j=t[w],k=function(T){if(f.props[j]){var b;f._notifying=!0;for(var $=arguments.length,A=new Array($>1?$-1:0),R=1;R<$;R++)A[R-1]=arguments[R];(b=f.props)[j].apply(b,[T].concat(A)),f._notifying=!1}f.unmounted||f.setState(function(I){var z,Y=I.values;return{values:Te(Object.create(null),Y,(z={},z[w]=T,z))}})};f.handlers[j]=k}),r.length&&(f.attachRef=function(w){f.inner=w});var y=Object.create(null);return i.forEach(function(w){y[w]=f.props[Ea(w)]}),f.state={values:y,prevProps:{}},f}var m=u.prototype;return m.shouldComponentUpdate=function(){return!this._notifying},u.getDerivedStateFromProps=function(p,v){var g=v.values,y=v.prevProps,w={values:Te(Object.create(null),g),prevProps:{}};return i.forEach(function(j){w.prevProps[j]=p[j],!vi(p,j)&&vi(y,j)&&(w.values[j]=p[Ea(j)])}),w},m.componentWillUnmount=function(){this.unmounted=!0},m.render=function(){var p=this,v=this.props,g=v.innerRef,y=fr(v,["innerRef"]);o.forEach(function(j){delete y[j]});var w={};return i.forEach(function(j){var k=p.props[j];w[j]=k!==void 0?k:p.state.values[j]}),E.createElement(e,Te({},y,w,this.handlers,{ref:g||this.attachRef}))},u}(E.Component);Ku(l),l.displayName="Uncontrolled("+s+")",l.propTypes=Te({innerRef:function(){}},Yu(t)),r.forEach(function(d){l.prototype[d]=function(){var m;return(m=this.inner)[d].apply(m,arguments)}});var c=l;return E.forwardRef&&(c=E.forwardRef(function(d,u){return E.createElement(l,Te({},d,{innerRef:u,__source:{fileName:Xu,lineNumber:128},__self:this}))}),c.propTypes=l.propTypes),c.ControlledComponent=e,c.deferControlTo=function(d,u,m){return u===void 0&&(u={}),Cl(d,Te({},t,u),m)},c}var La="milliseconds",Br="seconds",Gr="minutes",qr="hours",Bt="day",or="week",Yr="month",Gt="year",qt="decade",Yt="century",$l={milliseconds:1,seconds:1e3,minutes:60*1e3,hours:60*60*1e3,day:24*60*60*1e3,week:7*24*60*60*1e3},Ju={month:1,year:12,decade:10*12,century:100*12};function Qu(e){return[31,Zu(e),31,30,31,30,31,31,30,31,30,31]}function Zu(e){return e%4===0&&e%100!==0||e%400===0?29:28}function dt(e,t,r){switch(e=new Date(e),r){case La:case Br:case Gr:case qr:case Bt:case or:return em(e,t*$l[r]);case Yr:case Gt:case qt:case Yt:return tm(e,t*Ju[r])}throw new TypeError('Invalid units: "'+r+'"')}function em(e,t){var r=new Date(+e+t);return rm(e,r)}function tm(e,t){var r=e.getFullYear(),s=e.getMonth(),n=e.getDate(),i=r*12+s+t,o=Math.trunc(i/12),l=i%12,c=Math.min(n,Qu(o)[l]),d=new Date(e);return d.setFullYear(o),d.setDate(1),d.setMonth(l),d.setDate(c),d}function rm(e,t){var r=e.getTimezoneOffset(),s=t.getTimezoneOffset(),n=s-r;return new Date(+t+n*$l.minutes)}function Vr(e,t,r){return dt(e,-t,r)}function We(e,t,r){switch(e=new Date(e),t){case Yt:case qt:case Gt:e=Fa(e,0);case Yr:e=Pl(e,1);case or:case Bt:e=Jr(e,0);case qr:e=lr(e,0);case Gr:e=Xr(e,0);case Br:e=Kr(e,0)}return t===qt&&(e=Vr(e,Vt(e)%10,"year")),t===Yt&&(e=Vr(e,Vt(e)%100,"year")),t===or&&(e=Ol(e,0,r)),e}function Ia(e,t,r){switch(e=new Date(e),e=We(e,t,r),t){case Yt:case qt:case Gt:case Yr:case or:e=dt(e,1,t),e=Vr(e,1,Bt),e.setHours(23,59,59,999);break;case Bt:e.setHours(23,59,59,999);break;case qr:case Gr:case Br:e=dt(e,1,t),e=Vr(e,1,La)}return e}var pr=xr(function(e,t){return e===t}),mn=xr(function(e,t){return e!==t}),Ja=xr(function(e,t){return e>t}),sa=xr(function(e,t){return e>=t}),hn=xr(function(e,t){return e<t}),gr=xr(function(e,t){return e<=t});function Dl(){return new Date(Math.min.apply(Math,arguments))}function Tl(){return new Date(Math.max.apply(Math,arguments))}function Al(e,t,r,s){return s=s||"day",(!t||sa(e,t,s))&&(!r||gr(e,r,s))}var Kr=Dt("Milliseconds"),Xr=Dt("Seconds"),lr=Dt("Minutes"),Jr=Dt("Hours"),Ml=Dt("Day"),Pl=Dt("Date"),Fa=Dt("Month"),Vt=Dt("FullYear");function am(e,t){return t===void 0?Vt(We(e,qt)):dt(e,t+10,Gt)}function sm(e,t){return t===void 0?Vt(We(e,Yt)):dt(e,t+100,Gt)}function Ol(e,t,r){var s=(Ml(e)+7-(r||0))%7;return t===void 0?s:dt(e,t-s,Bt)}function nm(e,t,r,s){var n,i,o;switch(r){case La:case Br:case Gr:case qr:case Bt:case or:n=t.getTime()-e.getTime();break;case Yr:case Gt:case qt:case Yt:n=(Vt(t)-Vt(e))*12+Fa(t)-Fa(e);break;default:throw new TypeError('Invalid units: "'+r+'"')}switch(r){case La:i=1;break;case Br:i=1e3;break;case Gr:i=1e3*60;break;case qr:i=1e3*60*60;break;case Bt:i=1e3*60*60*24;break;case or:i=1e3*60*60*24*7;break;case Yr:i=1;break;case Gt:i=12;break;case qt:i=120;break;case Yt:i=1200;break;default:throw new TypeError('Invalid units: "'+r+'"')}return o=n/i,s?o:Math.round(o)}function Dt(e){var t=function(r){switch(r){case"Milliseconds":return 36e5;case"Seconds":return 3600;case"Minutes":return 60;case"Hours":return 1;default:return null}}(e);return function(r,s){if(s===void 0)return r["get"+e]();var n=new Date(r);return n["set"+e](s),t&&n["get"+e]()!=s&&(e==="Hours"||s>=t&&n.getHours()-r.getHours()<Math.floor(s/t))&&n["set"+e](s+t),n}}function xr(e){return function(t,r,s){return e(+We(t,s),+We(r,s))}}const yi=Object.freeze(Object.defineProperty({__proto__:null,add:dt,century:sm,date:Pl,day:Ml,decade:am,diff:nm,endOf:Ia,eq:pr,gt:Ja,gte:sa,hours:Jr,inRange:Al,lt:hn,lte:gr,max:Tl,milliseconds:Kr,min:Dl,minutes:lr,month:Fa,neq:mn,seconds:Xr,startOf:We,subtract:Vr,weekday:Ol,year:Vt},Symbol.toStringTag,{value:"Module"}));function im(e){if(Array.isArray(e))return Us(e)}function Rl(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function om(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ka(e){return im(e)||Rl(e)||un(e)||om()}function lm(e,t,r){var s=-1,n=e.length;t<0&&(t=-t>n?0:n+t),r=r>n?n:r,r<0&&(r+=n),n=t>r?0:r-t>>>0,t>>>=0;for(var i=Array(n);++s<n;)i[s]=e[s+t];return i}var _l=lm;function cm(e,t){return e===t||e!==e&&t!==t}var na=cm,dm=typeof at=="object"&&at&&at.Object===Object&&at,Ll=dm,um=Ll,mm=typeof self=="object"&&self&&self.Object===Object&&self,hm=um||mm||Function("return this")(),xt=hm,fm=xt,pm=fm.Symbol,vr=pm,bi=vr,Il=Object.prototype,gm=Il.hasOwnProperty,xm=Il.toString,Tr=bi?bi.toStringTag:void 0;function vm(e){var t=gm.call(e,Tr),r=e[Tr];try{e[Tr]=void 0;var s=!0}catch{}var n=xm.call(e);return s&&(t?e[Tr]=r:delete e[Tr]),n}var ym=vm,bm=Object.prototype,wm=bm.toString;function jm(e){return wm.call(e)}var Nm=jm,wi=vr,Sm=ym,Em=Nm,km="[object Null]",Cm="[object Undefined]",ji=wi?wi.toStringTag:void 0;function $m(e){return e==null?e===void 0?Cm:km:ji&&ji in Object(e)?Sm(e):Em(e)}var yr=$m;function Dm(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Nt=Dm,Tm=yr,Am=Nt,Mm="[object AsyncFunction]",Pm="[object Function]",Om="[object GeneratorFunction]",Rm="[object Proxy]";function _m(e){if(!Am(e))return!1;var t=Tm(e);return t==Pm||t==Om||t==Mm||t==Rm}var fn=_m,Lm=9007199254740991;function Im(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Lm}var pn=Im,Fm=fn,Wm=pn;function Hm(e){return e!=null&&Wm(e.length)&&!Fm(e)}var ia=Hm,Um=9007199254740991,zm=/^(?:0|[1-9]\d*)$/;function Bm(e,t){var r=typeof e;return t=t??Um,!!t&&(r=="number"||r!="symbol"&&zm.test(e))&&e>-1&&e%1==0&&e<t}var gn=Bm,Gm=na,qm=ia,Ym=gn,Vm=Nt;function Km(e,t,r){if(!Vm(r))return!1;var s=typeof t;return(s=="number"?qm(r)&&Ym(t,r.length):s=="string"&&t in r)?Gm(r[t],e):!1}var Qa=Km,Xm=/\s/;function Jm(e){for(var t=e.length;t--&&Xm.test(e.charAt(t)););return t}var Qm=Jm,Zm=Qm,eh=/^\s+/;function th(e){return e&&e.slice(0,Zm(e)+1).replace(eh,"")}var rh=th;function ah(e){return e!=null&&typeof e=="object"}var Tt=ah,sh=yr,nh=Tt,ih="[object Symbol]";function oh(e){return typeof e=="symbol"||nh(e)&&sh(e)==ih}var oa=oh,lh=rh,Ni=Nt,ch=oa,Si=NaN,dh=/^[-+]0x[0-9a-f]+$/i,uh=/^0b[01]+$/i,mh=/^0o[0-7]+$/i,hh=parseInt;function fh(e){if(typeof e=="number")return e;if(ch(e))return Si;if(Ni(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Ni(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=lh(e);var r=uh.test(e);return r||mh.test(e)?hh(e.slice(2),r?2:8):dh.test(e)?Si:+e}var ph=fh,gh=ph,Ei=1/0,xh=17976931348623157e292;function vh(e){if(!e)return e===0?e:0;if(e=gh(e),e===Ei||e===-Ei){var t=e<0?-1:1;return t*xh}return e===e?e:0}var Fl=vh,yh=Fl;function bh(e){var t=yh(e),r=t%1;return t===t?r?t-r:t:0}var Wl=bh,wh=_l,jh=Qa,Nh=Wl,Sh=Math.ceil,Eh=Math.max;function kh(e,t,r){(r?jh(e,t,r):t===void 0)?t=1:t=Eh(Nh(t),0);var s=e==null?0:e.length;if(!s||t<1)return[];for(var n=0,i=0,o=Array(Sh(s/t));n<s;)o[i++]=wh(e,n,n+=t);return o}var Ch=kh;const $h=it(Ch);function la(e){return e&&e.ownerDocument||document}function Dh(e){var t=la(e);return t&&t.defaultView||window}function Th(e,t){return Dh(e).getComputedStyle(e,t)}var Ah=/([A-Z])/g;function Mh(e){return e.replace(Ah,"-$1").toLowerCase()}var Ph=/^ms-/;function va(e){return Mh(e).replace(Ph,"-ms-")}var Oh=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;function Rh(e){return!!(e&&Oh.test(e))}function rr(e,t){var r="",s="";if(typeof t=="string")return e.style.getPropertyValue(va(t))||Th(e).getPropertyValue(va(t));Object.keys(t).forEach(function(n){var i=t[n];!i&&i!==0?e.style.removeProperty(va(n)):Rh(n)?s+=n+"("+i+") ":r+=va(n)+": "+i+";"}),s&&(r+="transform: "+s+";"),e.style.cssText+=";"+r}function Qr(e,t){if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return e===t||!!(e.compareDocumentPosition(t)&16)}function _h(e){return"nodeType"in e&&e.nodeType===document.DOCUMENT_NODE}function xn(e){return"window"in e&&e.window===e?e:_h(e)&&e.defaultView||!1}function Hl(e){var t=e==="pageXOffset"?"scrollLeft":"scrollTop";function r(s,n){var i=xn(s);if(n===void 0)return i?i[e]:s[t];i?i.scrollTo(i[e],n):s[t]=n}return r}const Ul=Hl("pageXOffset"),zl=Hl("pageYOffset");function Ht(e){var t=la(e),r={top:0,left:0,height:0,width:0},s=t&&t.documentElement;return!s||!Qr(s,e)||(e.getBoundingClientRect!==void 0&&(r=e.getBoundingClientRect()),r={top:r.top+zl(s)-(s.clientTop||0),left:r.left+Ul(s)-(s.clientLeft||0),width:r.width,height:r.height}),r}var Lh=function(t){return!!t&&"offsetParent"in t};function Ih(e){for(var t=la(e),r=e&&e.offsetParent;Lh(r)&&r.nodeName!=="HTML"&&rr(r,"position")==="static";)r=r.offsetParent;return r||t.documentElement}var Fh=function(t){return t.nodeName&&t.nodeName.toLowerCase()};function Bl(e,t){var r={top:0,left:0},s;if(rr(e,"position")==="fixed")s=e.getBoundingClientRect();else{var n=t||Ih(e);s=Ht(e),Fh(n)!=="html"&&(r=Ht(n));var i=String(rr(n,"borderTopWidth")||0);r.top+=parseInt(i,10)-zl(n)||0;var o=String(rr(n,"borderLeftWidth")||0);r.left+=parseInt(o,10)-Ul(n)||0}var l=String(rr(e,"marginTop")||0),c=String(rr(e,"marginLeft")||0);return Te({},s,{top:s.top-r.top-(parseInt(l,10)||0),left:s.left-r.left-(parseInt(c,10)||0)})}const vn=!!(typeof window<"u"&&window.document&&window.document.createElement);var ki=new Date().getTime();function Wh(e){var t=new Date().getTime(),r=Math.max(0,16-(t-ki)),s=setTimeout(e,r);return ki=t,s}var Hh=["","webkit","moz","o","ms"],zs="clearTimeout",Bs=Wh,Ci=function(t,r){return t+(t?r[0].toUpperCase()+r.substr(1):r)+"AnimationFrame"};vn&&Hh.some(function(e){var t=Ci(e,"request");return t in window&&(zs=Ci(e,"cancel"),Bs=function(s){return window[t](s)}),!!Bs});var $i=function(t){typeof window[zs]=="function"&&window[zs](t)},Gl=Bs,Ns;function Uh(e,t){if(!Ns){var r=document.body,s=r.matches||r.matchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector;Ns=function(i,o){return s.call(i,o)}}return Ns(e,t)}var zh=Function.prototype.bind.call(Function.prototype.call,[].slice);function Bh(e,t){return zh(e.querySelectorAll(t))}var Gs=!1,qs=!1;try{var Ss={get passive(){return Gs=!0},get once(){return qs=Gs=!0}};vn&&(window.addEventListener("test",Ss,Ss),window.removeEventListener("test",Ss,!0))}catch{}function Gh(e,t,r,s){if(s&&typeof s!="boolean"&&!qs){var n=s.once,i=s.capture,o=r;!qs&&n&&(o=r.__once||function l(c){this.removeEventListener(t,l,i),r.call(this,c)},r.__once=o),e.addEventListener(t,o,Gs?s:i)}e.addEventListener(t,r,s)}function qh(e){const t=x.useRef(e);return x.useEffect(()=>{t.current=e},[e]),t}function Di(e){const t=qh(e);return x.useCallback(function(...r){return t.current&&t.current(...r)},[t])}function Ti(){return x.useState(null)}function Yh(){const e=x.useRef(!0),t=x.useRef(()=>e.current);return x.useEffect(()=>(e.current=!0,()=>{e.current=!1}),[]),t.current}function Vh(e){const t=Yh();return[e[0],x.useCallback(r=>{if(t())return e[1](r)},[t,e[1]])]}var Ke="top",st="bottom",nt="right",Xe="left",yn="auto",ca=[Ke,st,nt,Xe],cr="start",Zr="end",Kh="clippingParents",ql="viewport",Ar="popper",Xh="reference",Ai=ca.reduce(function(e,t){return e.concat([t+"-"+cr,t+"-"+Zr])},[]),bn=[].concat(ca,[yn]).reduce(function(e,t){return e.concat([t,t+"-"+cr,t+"-"+Zr])},[]),Jh="beforeRead",Qh="read",Zh="afterRead",ef="beforeMain",tf="main",rf="afterMain",af="beforeWrite",sf="write",nf="afterWrite",of=[Jh,Qh,Zh,ef,tf,rf,af,sf,nf];function ht(e){return e.split("-")[0]}function Qe(e){if(e==null)return window;if(e.toString()!=="[object Window]"){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Kt(e){var t=Qe(e).Element;return e instanceof t||e instanceof Element}function ft(e){var t=Qe(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function wn(e){if(typeof ShadowRoot>"u")return!1;var t=Qe(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}var Ut=Math.max,Wa=Math.min,dr=Math.round;function Ys(){var e=navigator.userAgentData;return e!=null&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function Yl(){return!/^((?!chrome|android).)*safari/i.test(Ys())}function ur(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var s=e.getBoundingClientRect(),n=1,i=1;t&&ft(e)&&(n=e.offsetWidth>0&&dr(s.width)/e.offsetWidth||1,i=e.offsetHeight>0&&dr(s.height)/e.offsetHeight||1);var o=Kt(e)?Qe(e):window,l=o.visualViewport,c=!Yl()&&r,d=(s.left+(c&&l?l.offsetLeft:0))/n,u=(s.top+(c&&l?l.offsetTop:0))/i,m=s.width/n,f=s.height/i;return{width:m,height:f,top:u,right:d+m,bottom:u+f,left:d,x:d,y:u}}function jn(e){var t=ur(e),r=e.offsetWidth,s=e.offsetHeight;return Math.abs(t.width-r)<=1&&(r=t.width),Math.abs(t.height-s)<=1&&(s=t.height),{x:e.offsetLeft,y:e.offsetTop,width:r,height:s}}function Vl(e,t){var r=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(r&&wn(r)){var s=t;do{if(s&&e.isSameNode(s))return!0;s=s.parentNode||s.host}while(s)}return!1}function Ct(e){return e?(e.nodeName||"").toLowerCase():null}function wt(e){return Qe(e).getComputedStyle(e)}function lf(e){return["table","td","th"].indexOf(Ct(e))>=0}function At(e){return((Kt(e)?e.ownerDocument:e.document)||window.document).documentElement}function Za(e){return Ct(e)==="html"?e:e.assignedSlot||e.parentNode||(wn(e)?e.host:null)||At(e)}function Mi(e){return!ft(e)||wt(e).position==="fixed"?null:e.offsetParent}function cf(e){var t=/firefox/i.test(Ys()),r=/Trident/i.test(Ys());if(r&&ft(e)){var s=wt(e);if(s.position==="fixed")return null}var n=Za(e);for(wn(n)&&(n=n.host);ft(n)&&["html","body"].indexOf(Ct(n))<0;){var i=wt(n);if(i.transform!=="none"||i.perspective!=="none"||i.contain==="paint"||["transform","perspective"].indexOf(i.willChange)!==-1||t&&i.willChange==="filter"||t&&i.filter&&i.filter!=="none")return n;n=n.parentNode}return null}function da(e){for(var t=Qe(e),r=Mi(e);r&&lf(r)&&wt(r).position==="static";)r=Mi(r);return r&&(Ct(r)==="html"||Ct(r)==="body"&&wt(r).position==="static")?t:r||cf(e)||t}function Nn(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function Ir(e,t,r){return Ut(e,Wa(t,r))}function df(e,t,r){var s=Ir(e,t,r);return s>r?r:s}function Kl(){return{top:0,right:0,bottom:0,left:0}}function Xl(e){return Object.assign({},Kl(),e)}function Jl(e,t){return t.reduce(function(r,s){return r[s]=e,r},{})}var uf=function(t,r){return t=typeof t=="function"?t(Object.assign({},r.rects,{placement:r.placement})):t,Xl(typeof t!="number"?t:Jl(t,ca))};function mf(e){var t,r=e.state,s=e.name,n=e.options,i=r.elements.arrow,o=r.modifiersData.popperOffsets,l=ht(r.placement),c=Nn(l),d=[Xe,nt].indexOf(l)>=0,u=d?"height":"width";if(!(!i||!o)){var m=uf(n.padding,r),f=jn(i),p=c==="y"?Ke:Xe,v=c==="y"?st:nt,g=r.rects.reference[u]+r.rects.reference[c]-o[c]-r.rects.popper[u],y=o[c]-r.rects.reference[c],w=da(i),j=w?c==="y"?w.clientHeight||0:w.clientWidth||0:0,k=g/2-y/2,S=m[p],T=j-f[u]-m[v],b=j/2-f[u]/2+k,$=Ir(S,b,T),A=c;r.modifiersData[s]=(t={},t[A]=$,t.centerOffset=$-b,t)}}function hf(e){var t=e.state,r=e.options,s=r.element,n=s===void 0?"[data-popper-arrow]":s;n!=null&&(typeof n=="string"&&(n=t.elements.popper.querySelector(n),!n)||Vl(t.elements.popper,n)&&(t.elements.arrow=n))}const ff={name:"arrow",enabled:!0,phase:"main",fn:mf,effect:hf,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function mr(e){return e.split("-")[1]}var pf={top:"auto",right:"auto",bottom:"auto",left:"auto"};function gf(e,t){var r=e.x,s=e.y,n=t.devicePixelRatio||1;return{x:dr(r*n)/n||0,y:dr(s*n)/n||0}}function Pi(e){var t,r=e.popper,s=e.popperRect,n=e.placement,i=e.variation,o=e.offsets,l=e.position,c=e.gpuAcceleration,d=e.adaptive,u=e.roundOffsets,m=e.isFixed,f=o.x,p=f===void 0?0:f,v=o.y,g=v===void 0?0:v,y=typeof u=="function"?u({x:p,y:g}):{x:p,y:g};p=y.x,g=y.y;var w=o.hasOwnProperty("x"),j=o.hasOwnProperty("y"),k=Xe,S=Ke,T=window;if(d){var b=da(r),$="clientHeight",A="clientWidth";if(b===Qe(r)&&(b=At(r),wt(b).position!=="static"&&l==="absolute"&&($="scrollHeight",A="scrollWidth")),b=b,n===Ke||(n===Xe||n===nt)&&i===Zr){S=st;var R=m&&b===T&&T.visualViewport?T.visualViewport.height:b[$];g-=R-s.height,g*=c?1:-1}if(n===Xe||(n===Ke||n===st)&&i===Zr){k=nt;var I=m&&b===T&&T.visualViewport?T.visualViewport.width:b[A];p-=I-s.width,p*=c?1:-1}}var z=Object.assign({position:l},d&&pf),Y=u===!0?gf({x:p,y:g},Qe(r)):{x:p,y:g};if(p=Y.x,g=Y.y,c){var B;return Object.assign({},z,(B={},B[S]=j?"0":"",B[k]=w?"0":"",B.transform=(T.devicePixelRatio||1)<=1?"translate("+p+"px, "+g+"px)":"translate3d("+p+"px, "+g+"px, 0)",B))}return Object.assign({},z,(t={},t[S]=j?g+"px":"",t[k]=w?p+"px":"",t.transform="",t))}function xf(e){var t=e.state,r=e.options,s=r.gpuAcceleration,n=s===void 0?!0:s,i=r.adaptive,o=i===void 0?!0:i,l=r.roundOffsets,c=l===void 0?!0:l,d={placement:ht(t.placement),variation:mr(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:n,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,Pi(Object.assign({},d,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:c})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,Pi(Object.assign({},d,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const vf={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:xf,data:{}};var ya={passive:!0};function yf(e){var t=e.state,r=e.instance,s=e.options,n=s.scroll,i=n===void 0?!0:n,o=s.resize,l=o===void 0?!0:o,c=Qe(t.elements.popper),d=[].concat(t.scrollParents.reference,t.scrollParents.popper);return i&&d.forEach(function(u){u.addEventListener("scroll",r.update,ya)}),l&&c.addEventListener("resize",r.update,ya),function(){i&&d.forEach(function(u){u.removeEventListener("scroll",r.update,ya)}),l&&c.removeEventListener("resize",r.update,ya)}}const bf={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:yf,data:{}};var wf={left:"right",right:"left",bottom:"top",top:"bottom"};function Ca(e){return e.replace(/left|right|bottom|top/g,function(t){return wf[t]})}var jf={start:"end",end:"start"};function Oi(e){return e.replace(/start|end/g,function(t){return jf[t]})}function Sn(e){var t=Qe(e),r=t.pageXOffset,s=t.pageYOffset;return{scrollLeft:r,scrollTop:s}}function En(e){return ur(At(e)).left+Sn(e).scrollLeft}function Nf(e,t){var r=Qe(e),s=At(e),n=r.visualViewport,i=s.clientWidth,o=s.clientHeight,l=0,c=0;if(n){i=n.width,o=n.height;var d=Yl();(d||!d&&t==="fixed")&&(l=n.offsetLeft,c=n.offsetTop)}return{width:i,height:o,x:l+En(e),y:c}}function Sf(e){var t,r=At(e),s=Sn(e),n=(t=e.ownerDocument)==null?void 0:t.body,i=Ut(r.scrollWidth,r.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),o=Ut(r.scrollHeight,r.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),l=-s.scrollLeft+En(e),c=-s.scrollTop;return wt(n||r).direction==="rtl"&&(l+=Ut(r.clientWidth,n?n.clientWidth:0)-i),{width:i,height:o,x:l,y:c}}function kn(e){var t=wt(e),r=t.overflow,s=t.overflowX,n=t.overflowY;return/auto|scroll|overlay|hidden/.test(r+n+s)}function Ql(e){return["html","body","#document"].indexOf(Ct(e))>=0?e.ownerDocument.body:ft(e)&&kn(e)?e:Ql(Za(e))}function Fr(e,t){var r;t===void 0&&(t=[]);var s=Ql(e),n=s===((r=e.ownerDocument)==null?void 0:r.body),i=Qe(s),o=n?[i].concat(i.visualViewport||[],kn(s)?s:[]):s,l=t.concat(o);return n?l:l.concat(Fr(Za(o)))}function Vs(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function Ef(e,t){var r=ur(e,!1,t==="fixed");return r.top=r.top+e.clientTop,r.left=r.left+e.clientLeft,r.bottom=r.top+e.clientHeight,r.right=r.left+e.clientWidth,r.width=e.clientWidth,r.height=e.clientHeight,r.x=r.left,r.y=r.top,r}function Ri(e,t,r){return t===ql?Vs(Nf(e,r)):Kt(t)?Ef(t,r):Vs(Sf(At(e)))}function kf(e){var t=Fr(Za(e)),r=["absolute","fixed"].indexOf(wt(e).position)>=0,s=r&&ft(e)?da(e):e;return Kt(s)?t.filter(function(n){return Kt(n)&&Vl(n,s)&&Ct(n)!=="body"}):[]}function Cf(e,t,r,s){var n=t==="clippingParents"?kf(e):[].concat(t),i=[].concat(n,[r]),o=i[0],l=i.reduce(function(c,d){var u=Ri(e,d,s);return c.top=Ut(u.top,c.top),c.right=Wa(u.right,c.right),c.bottom=Wa(u.bottom,c.bottom),c.left=Ut(u.left,c.left),c},Ri(e,o,s));return l.width=l.right-l.left,l.height=l.bottom-l.top,l.x=l.left,l.y=l.top,l}function Zl(e){var t=e.reference,r=e.element,s=e.placement,n=s?ht(s):null,i=s?mr(s):null,o=t.x+t.width/2-r.width/2,l=t.y+t.height/2-r.height/2,c;switch(n){case Ke:c={x:o,y:t.y-r.height};break;case st:c={x:o,y:t.y+t.height};break;case nt:c={x:t.x+t.width,y:l};break;case Xe:c={x:t.x-r.width,y:l};break;default:c={x:t.x,y:t.y}}var d=n?Nn(n):null;if(d!=null){var u=d==="y"?"height":"width";switch(i){case cr:c[d]=c[d]-(t[u]/2-r[u]/2);break;case Zr:c[d]=c[d]+(t[u]/2-r[u]/2);break}}return c}function ea(e,t){t===void 0&&(t={});var r=t,s=r.placement,n=s===void 0?e.placement:s,i=r.strategy,o=i===void 0?e.strategy:i,l=r.boundary,c=l===void 0?Kh:l,d=r.rootBoundary,u=d===void 0?ql:d,m=r.elementContext,f=m===void 0?Ar:m,p=r.altBoundary,v=p===void 0?!1:p,g=r.padding,y=g===void 0?0:g,w=Xl(typeof y!="number"?y:Jl(y,ca)),j=f===Ar?Xh:Ar,k=e.rects.popper,S=e.elements[v?j:f],T=Cf(Kt(S)?S:S.contextElement||At(e.elements.popper),c,u,o),b=ur(e.elements.reference),$=Zl({reference:b,element:k,placement:n}),A=Vs(Object.assign({},k,$)),R=f===Ar?A:b,I={top:T.top-R.top+w.top,bottom:R.bottom-T.bottom+w.bottom,left:T.left-R.left+w.left,right:R.right-T.right+w.right},z=e.modifiersData.offset;if(f===Ar&&z){var Y=z[n];Object.keys(I).forEach(function(B){var N=[nt,st].indexOf(B)>=0?1:-1,G=[Ke,st].indexOf(B)>=0?"y":"x";I[B]+=Y[G]*N})}return I}function $f(e,t){t===void 0&&(t={});var r=t,s=r.placement,n=r.boundary,i=r.rootBoundary,o=r.padding,l=r.flipVariations,c=r.allowedAutoPlacements,d=c===void 0?bn:c,u=mr(s),m=u?l?Ai:Ai.filter(function(v){return mr(v)===u}):ca,f=m.filter(function(v){return d.indexOf(v)>=0});f.length===0&&(f=m);var p=f.reduce(function(v,g){return v[g]=ea(e,{placement:g,boundary:n,rootBoundary:i,padding:o})[ht(g)],v},{});return Object.keys(p).sort(function(v,g){return p[v]-p[g]})}function Df(e){if(ht(e)===yn)return[];var t=Ca(e);return[Oi(e),t,Oi(t)]}function Tf(e){var t=e.state,r=e.options,s=e.name;if(!t.modifiersData[s]._skip){for(var n=r.mainAxis,i=n===void 0?!0:n,o=r.altAxis,l=o===void 0?!0:o,c=r.fallbackPlacements,d=r.padding,u=r.boundary,m=r.rootBoundary,f=r.altBoundary,p=r.flipVariations,v=p===void 0?!0:p,g=r.allowedAutoPlacements,y=t.options.placement,w=ht(y),j=w===y,k=c||(j||!v?[Ca(y)]:Df(y)),S=[y].concat(k).reduce(function(re,D){return re.concat(ht(D)===yn?$f(t,{placement:D,boundary:u,rootBoundary:m,padding:d,flipVariations:v,allowedAutoPlacements:g}):D)},[]),T=t.rects.reference,b=t.rects.popper,$=new Map,A=!0,R=S[0],I=0;I<S.length;I++){var z=S[I],Y=ht(z),B=mr(z)===cr,N=[Ke,st].indexOf(Y)>=0,G=N?"width":"height",te=ea(t,{placement:z,boundary:u,rootBoundary:m,altBoundary:f,padding:d}),X=N?B?nt:Xe:B?st:Ke;T[G]>b[G]&&(X=Ca(X));var W=Ca(X),oe=[];if(i&&oe.push(te[Y]<=0),l&&oe.push(te[X]<=0,te[W]<=0),oe.every(function(re){return re})){R=z,A=!1;break}$.set(z,oe)}if(A)for(var ce=v?3:1,se=function(D){var U=S.find(function(Z){var ae=$.get(Z);if(ae)return ae.slice(0,D).every(function(V){return V})});if(U)return R=U,"break"},ge=ce;ge>0;ge--){var ve=se(ge);if(ve==="break")break}t.placement!==R&&(t.modifiersData[s]._skip=!0,t.placement=R,t.reset=!0)}}const Af={name:"flip",enabled:!0,phase:"main",fn:Tf,requiresIfExists:["offset"],data:{_skip:!1}};function _i(e,t,r){return r===void 0&&(r={x:0,y:0}),{top:e.top-t.height-r.y,right:e.right-t.width+r.x,bottom:e.bottom-t.height+r.y,left:e.left-t.width-r.x}}function Li(e){return[Ke,nt,st,Xe].some(function(t){return e[t]>=0})}function Mf(e){var t=e.state,r=e.name,s=t.rects.reference,n=t.rects.popper,i=t.modifiersData.preventOverflow,o=ea(t,{elementContext:"reference"}),l=ea(t,{altBoundary:!0}),c=_i(o,s),d=_i(l,n,i),u=Li(c),m=Li(d);t.modifiersData[r]={referenceClippingOffsets:c,popperEscapeOffsets:d,isReferenceHidden:u,hasPopperEscaped:m},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":m})}const Pf={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Mf};function Of(e,t,r){var s=ht(e),n=[Xe,Ke].indexOf(s)>=0?-1:1,i=typeof r=="function"?r(Object.assign({},t,{placement:e})):r,o=i[0],l=i[1];return o=o||0,l=(l||0)*n,[Xe,nt].indexOf(s)>=0?{x:l,y:o}:{x:o,y:l}}function Rf(e){var t=e.state,r=e.options,s=e.name,n=r.offset,i=n===void 0?[0,0]:n,o=bn.reduce(function(u,m){return u[m]=Of(m,t.rects,i),u},{}),l=o[t.placement],c=l.x,d=l.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=d),t.modifiersData[s]=o}const _f={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Rf};function Lf(e){var t=e.state,r=e.name;t.modifiersData[r]=Zl({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const If={name:"popperOffsets",enabled:!0,phase:"read",fn:Lf,data:{}};function Ff(e){return e==="x"?"y":"x"}function Wf(e){var t=e.state,r=e.options,s=e.name,n=r.mainAxis,i=n===void 0?!0:n,o=r.altAxis,l=o===void 0?!1:o,c=r.boundary,d=r.rootBoundary,u=r.altBoundary,m=r.padding,f=r.tether,p=f===void 0?!0:f,v=r.tetherOffset,g=v===void 0?0:v,y=ea(t,{boundary:c,rootBoundary:d,padding:m,altBoundary:u}),w=ht(t.placement),j=mr(t.placement),k=!j,S=Nn(w),T=Ff(S),b=t.modifiersData.popperOffsets,$=t.rects.reference,A=t.rects.popper,R=typeof g=="function"?g(Object.assign({},t.rects,{placement:t.placement})):g,I=typeof R=="number"?{mainAxis:R,altAxis:R}:Object.assign({mainAxis:0,altAxis:0},R),z=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,Y={x:0,y:0};if(b){if(i){var B,N=S==="y"?Ke:Xe,G=S==="y"?st:nt,te=S==="y"?"height":"width",X=b[S],W=X+y[N],oe=X-y[G],ce=p?-A[te]/2:0,se=j===cr?$[te]:A[te],ge=j===cr?-A[te]:-$[te],ve=t.elements.arrow,re=p&&ve?jn(ve):{width:0,height:0},D=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:Kl(),U=D[N],Z=D[G],ae=Ir(0,$[te],re[te]),V=k?$[te]/2-ce-ae-U-I.mainAxis:se-ae-U-I.mainAxis,Q=k?-$[te]/2+ce+ae+Z+I.mainAxis:ge+ae+Z+I.mainAxis,de=t.elements.arrow&&da(t.elements.arrow),Se=de?S==="y"?de.clientTop||0:de.clientLeft||0:0,Ae=(B=z==null?void 0:z[S])!=null?B:0,Ie=X+V-Ae-Se,xe=X+Q-Ae,we=Ir(p?Wa(W,Ie):W,X,p?Ut(oe,xe):oe);b[S]=we,Y[S]=we-X}if(l){var Fe,qe=S==="x"?Ke:Xe,P=S==="x"?st:nt,h=b[T],C=T==="y"?"height":"width",O=h+y[qe],_=h-y[P],M=[Ke,Xe].indexOf(w)!==-1,L=(Fe=z==null?void 0:z[T])!=null?Fe:0,F=M?O:h-$[C]-A[C]-L+I.altAxis,H=M?h+$[C]+A[C]-L-I.altAxis:_,q=p&&M?df(F,h,H):Ir(p?F:O,h,p?H:_);b[T]=q,Y[T]=q-h}t.modifiersData[s]=Y}}const Hf={name:"preventOverflow",enabled:!0,phase:"main",fn:Wf,requiresIfExists:["offset"]};function Uf(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function zf(e){return e===Qe(e)||!ft(e)?Sn(e):Uf(e)}function Bf(e){var t=e.getBoundingClientRect(),r=dr(t.width)/e.offsetWidth||1,s=dr(t.height)/e.offsetHeight||1;return r!==1||s!==1}function Gf(e,t,r){r===void 0&&(r=!1);var s=ft(t),n=ft(t)&&Bf(t),i=At(t),o=ur(e,n,r),l={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(s||!s&&!r)&&((Ct(t)!=="body"||kn(i))&&(l=zf(t)),ft(t)?(c=ur(t,!0),c.x+=t.clientLeft,c.y+=t.clientTop):i&&(c.x=En(i))),{x:o.left+l.scrollLeft-c.x,y:o.top+l.scrollTop-c.y,width:o.width,height:o.height}}function qf(e){var t=new Map,r=new Set,s=[];e.forEach(function(i){t.set(i.name,i)});function n(i){r.add(i.name);var o=[].concat(i.requires||[],i.requiresIfExists||[]);o.forEach(function(l){if(!r.has(l)){var c=t.get(l);c&&n(c)}}),s.push(i)}return e.forEach(function(i){r.has(i.name)||n(i)}),s}function Yf(e){var t=qf(e);return of.reduce(function(r,s){return r.concat(t.filter(function(n){return n.phase===s}))},[])}function Vf(e){var t;return function(){return t||(t=new Promise(function(r){Promise.resolve().then(function(){t=void 0,r(e())})})),t}}function Kf(e){var t=e.reduce(function(r,s){var n=r[s.name];return r[s.name]=n?Object.assign({},n,s,{options:Object.assign({},n.options,s.options),data:Object.assign({},n.data,s.data)}):s,r},{});return Object.keys(t).map(function(r){return t[r]})}var Ii={placement:"bottom",modifiers:[],strategy:"absolute"};function Fi(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return!t.some(function(s){return!(s&&typeof s.getBoundingClientRect=="function")})}function Xf(e){e===void 0&&(e={});var t=e,r=t.defaultModifiers,s=r===void 0?[]:r,n=t.defaultOptions,i=n===void 0?Ii:n;return function(l,c,d){d===void 0&&(d=i);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},Ii,i),modifiersData:{},elements:{reference:l,popper:c},attributes:{},styles:{}},m=[],f=!1,p={state:u,setOptions:function(w){var j=typeof w=="function"?w(u.options):w;g(),u.options=Object.assign({},i,u.options,j),u.scrollParents={reference:Kt(l)?Fr(l):l.contextElement?Fr(l.contextElement):[],popper:Fr(c)};var k=Yf(Kf([].concat(s,u.options.modifiers)));return u.orderedModifiers=k.filter(function(S){return S.enabled}),v(),p.update()},forceUpdate:function(){if(!f){var w=u.elements,j=w.reference,k=w.popper;if(Fi(j,k)){u.rects={reference:Gf(j,da(k),u.options.strategy==="fixed"),popper:jn(k)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(I){return u.modifiersData[I.name]=Object.assign({},I.data)});for(var S=0;S<u.orderedModifiers.length;S++){if(u.reset===!0){u.reset=!1,S=-1;continue}var T=u.orderedModifiers[S],b=T.fn,$=T.options,A=$===void 0?{}:$,R=T.name;typeof b=="function"&&(u=b({state:u,options:A,name:R,instance:p})||u)}}}},update:Vf(function(){return new Promise(function(y){p.forceUpdate(),y(u)})}),destroy:function(){g(),f=!0}};if(!Fi(l,c))return p;p.setOptions(d).then(function(y){!f&&d.onFirstUpdate&&d.onFirstUpdate(y)});function v(){u.orderedModifiers.forEach(function(y){var w=y.name,j=y.options,k=j===void 0?{}:j,S=y.effect;if(typeof S=="function"){var T=S({state:u,name:w,instance:p,options:k}),b=function(){};m.push(T||b)}})}function g(){m.forEach(function(y){return y()}),m=[]}return p}}var Jf=Xf({defaultModifiers:[Pf,If,vf,bf,_f,Af,Hf,ff]}),Wi=function(t){return{position:t,top:"0",left:"0",opacity:"0",pointerEvents:"none"}},Qf={name:"applyStyles",enabled:!1},Zf={name:"ariaDescribedBy",enabled:!0,phase:"afterWrite",effect:function(t){var r=t.state;return function(){var s=r.elements,n=s.reference,i=s.popper;if("removeAttribute"in n){var o=(n.getAttribute("aria-describedby")||"").split(",").filter(function(l){return l.trim()!==i.id});o.length?n.setAttribute("aria-describedby",o.join(",")):n.removeAttribute("aria-describedby")}}},fn:function(t){var r,s=t.state,n=s.elements,i=n.popper,o=n.reference,l=(r=i.getAttribute("role"))==null?void 0:r.toLowerCase();if(i.id&&l==="tooltip"&&"setAttribute"in o){var c=o.getAttribute("aria-describedby");if(c&&c.split(",").indexOf(i.id)!==-1)return;o.setAttribute("aria-describedby",c?c+","+i.id:i.id)}}},ep=[];function tp(e,t,r){var s=r===void 0?{}:r,n=s.enabled,i=n===void 0?!0:n,o=s.placement,l=o===void 0?"bottom":o,c=s.strategy,d=c===void 0?"absolute":c,u=s.modifiers,m=u===void 0?ep:u,f=fr(s,["enabled","placement","strategy","modifiers"]),p=x.useRef(),v=x.useCallback(function(){var S;(S=p.current)==null||S.update()},[]),g=x.useCallback(function(){var S;(S=p.current)==null||S.forceUpdate()},[]),y=Vh(x.useState({placement:l,update:v,forceUpdate:g,attributes:{},styles:{popper:Wi(d),arrow:{}}})),w=y[0],j=y[1],k=x.useMemo(function(){return{name:"updateStateModifier",enabled:!0,phase:"write",requires:["computeStyles"],fn:function(T){var b=T.state,$={},A={};Object.keys(b.elements).forEach(function(R){$[R]=b.styles[R],A[R]=b.attributes[R]}),j({state:b,styles:$,attributes:A,update:v,forceUpdate:g,placement:b.placement})}}},[v,g,j]);return x.useEffect(function(){!p.current||!i||p.current.setOptions({placement:l,strategy:d,modifiers:[].concat(m,[k,Qf])})},[d,l,k,i]),x.useEffect(function(){if(!(!i||e==null||t==null))return p.current=Jf(e,t,Te({},f,{placement:l,strategy:d,modifiers:[].concat(m,[Zf,k])})),function(){p.current!=null&&(p.current.destroy(),p.current=void 0,j(function(S){return Te({},S,{attributes:{},styles:{popper:Wi(d)}})}))}},[i,e,t]),w}function rp(e,t,r,s){var n=s&&typeof s!="boolean"?s.capture:s;e.removeEventListener(t,r,n),r.__once&&e.removeEventListener(t,r.__once,n)}function Lr(e,t,r,s){return Gh(e,t,r,s),function(){rp(e,t,r,s)}}var ap=function(){},sp=ap;const np=it(sp);function ip(e){return e&&"setState"in e?ar.findDOMNode(e):e??null}const op=function(e){return la(ip(e))};var lp=27,Hi=function(){};function cp(e){return e.button===0}function dp(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}var Ui=function(t){return t&&("current"in t?t.current:t)};function up(e,t,r){var s=r===void 0?{}:r,n=s.disabled,i=s.clickTrigger,o=i===void 0?"click":i,l=x.useRef(!1),c=t||Hi,d=x.useCallback(function(f){var p,v=Ui(e);np(!!v,"RootClose captured a close event but does not have a ref to compare it to. useRootClose(), should be passed a ref that resolves to a DOM node"),l.current=!v||dp(f)||!cp(f)||!!Qr(v,(p=f.composedPath==null?void 0:f.composedPath()[0])!=null?p:f.target)},[e]),u=Di(function(f){l.current||c(f)}),m=Di(function(f){f.keyCode===lp&&c(f)});x.useEffect(function(){if(!(n||e==null)){var f=window.event,p=op(Ui(e)),v=Lr(p,o,d,!0),g=Lr(p,o,function(j){if(j===f){f=void 0;return}u(j)}),y=Lr(p,"keyup",function(j){if(j===f){f=void 0;return}m(j)}),w=[];return"ontouchstart"in p.documentElement&&(w=[].slice.call(p.body.children).map(function(j){return Lr(j,"mousemove",Hi)})),function(){v(),g(),y(),w.forEach(function(j){return j()})}}},[e,n,o,d,u,m])}function mp(e){var t={};return Array.isArray(e)?(e==null||e.forEach(function(r){t[r.name]=r}),t):e||t}function hp(e){return e===void 0&&(e={}),Array.isArray(e)?e:Object.keys(e).map(function(t){return e[t].name=t,e[t]})}function fp(e){var t,r,s,n,i=e.enabled,o=e.enableEvents,l=e.placement,c=e.flip,d=e.offset,u=e.fixed,m=e.containerPadding,f=e.arrowElement,p=e.popperConfig,v=p===void 0?{}:p,g=mp(v.modifiers);return Te({},v,{placement:l,enabled:i,strategy:u?"fixed":v.strategy,modifiers:hp(Te({},g,{eventListeners:{enabled:o},preventOverflow:Te({},g.preventOverflow,{options:m?Te({padding:m},(t=g.preventOverflow)==null?void 0:t.options):(r=g.preventOverflow)==null?void 0:r.options}),offset:{options:Te({offset:d},(s=g.offset)==null?void 0:s.options)},arrow:Te({},g.arrow,{enabled:!!f,options:Te({},(n=g.arrow)==null?void 0:n.options,{element:f})}),flip:Te({enabled:!!c},g.flip)}))})}var ba;function Cn(e){if((!ba&&ba!==0||e)&&vn){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),ba=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return ba}var Es=function(t){var r;return typeof document>"u"?null:t==null?la().body:(typeof t=="function"&&(t=t()),t&&"current"in t&&(t=t.current),(r=t)!=null&&r.nodeType&&t||null)};function zi(e,t){var r=x.useState(function(){return Es(e)}),s=r[0],n=r[1];if(!s){var i=Es(e);i&&n(i)}return x.useEffect(function(){},[t,s]),x.useEffect(function(){var o=Es(e);o!==s&&n(o)},[e,s]),s}const Bi=e=>!e||typeof e=="function"?e:t=>{e.current=t};function pp(e,t){const r=Bi(e),s=Bi(t);return n=>{r&&r(n),s&&s(n)}}function gp(e,t){return x.useMemo(()=>pp(e,t),[e,t])}var $n=E.forwardRef(function(e,t){var r=e.flip,s=e.offset,n=e.placement,i=e.containerPadding,o=i===void 0?5:i,l=e.popperConfig,c=l===void 0?{}:l,d=e.transition,u=Ti(),m=u[0],f=u[1],p=Ti(),v=p[0],g=p[1],y=gp(f,t),w=zi(e.container),j=zi(e.target),k=x.useState(!e.show),S=k[0],T=k[1],b=tp(j,m,fp({placement:n,enableEvents:!!e.show,containerPadding:o||5,flip:r,offset:s,arrowElement:v,popperConfig:c})),$=b.styles,A=b.attributes,R=fr(b,["styles","attributes"]);e.show?S&&T(!1):!e.transition&&!S&&T(!0);var I=function(){T(!0),e.onExited&&e.onExited.apply(e,arguments)},z=e.show||d&&!S;if(up(m,e.onHide,{disabled:!e.rootClose||e.rootCloseDisabled,clickTrigger:e.rootCloseEvent}),!z)return null;var Y=e.children(Te({},R,{show:!!e.show,props:Te({},A.popper,{style:$.popper,ref:y}),arrowProps:Te({},A.arrow,{style:$.arrow,ref:g})}));if(d){var B=e.onExit,N=e.onExiting,G=e.onEnter,te=e.onEntering,X=e.onEntered;Y=E.createElement(d,{in:e.show,appear:!0,onExit:B,onExiting:N,onExited:I,onEnter:G,onEntering:te,onEntered:X},Y)}return w?ar.createPortal(Y,w):null});$n.displayName="Overlay";$n.propTypes={show:K.bool,placement:K.oneOf(bn),target:K.any,container:K.any,flip:K.bool,children:K.func.isRequired,containerPadding:K.number,popperConfig:K.object,rootClose:K.bool,rootCloseEvent:K.oneOf(["click","mousedown"]),rootCloseDisabled:K.bool,onHide:function(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),n=1;n<r;n++)s[n-1]=arguments[n];if(t.rootClose){var i;return(i=K.func).isRequired.apply(i,[t].concat(s))}return K.func.apply(K,[t].concat(s))},transition:K.elementType,onEnter:K.func,onEntering:K.func,onEntered:K.func,onExit:K.func,onExiting:K.func,onExited:K.func};function xp(){this.__data__=[],this.size=0}var vp=xp,yp=na;function bp(e,t){for(var r=e.length;r--;)if(yp(e[r][0],t))return r;return-1}var es=bp,wp=es,jp=Array.prototype,Np=jp.splice;function Sp(e){var t=this.__data__,r=wp(t,e);if(r<0)return!1;var s=t.length-1;return r==s?t.pop():Np.call(t,r,1),--this.size,!0}var Ep=Sp,kp=es;function Cp(e){var t=this.__data__,r=kp(t,e);return r<0?void 0:t[r][1]}var $p=Cp,Dp=es;function Tp(e){return Dp(this.__data__,e)>-1}var Ap=Tp,Mp=es;function Pp(e,t){var r=this.__data__,s=Mp(r,e);return s<0?(++this.size,r.push([e,t])):r[s][1]=t,this}var Op=Pp,Rp=vp,_p=Ep,Lp=$p,Ip=Ap,Fp=Op;function br(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}br.prototype.clear=Rp;br.prototype.delete=_p;br.prototype.get=Lp;br.prototype.has=Ip;br.prototype.set=Fp;var ts=br,Wp=ts;function Hp(){this.__data__=new Wp,this.size=0}var Up=Hp;function zp(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var Bp=zp;function Gp(e){return this.__data__.get(e)}var qp=Gp;function Yp(e){return this.__data__.has(e)}var Vp=Yp,Kp=xt,Xp=Kp["__core-js_shared__"],Jp=Xp,ks=Jp,Gi=function(){var e=/[^.]+$/.exec(ks&&ks.keys&&ks.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Qp(e){return!!Gi&&Gi in e}var Zp=Qp,eg=Function.prototype,tg=eg.toString;function rg(e){if(e!=null){try{return tg.call(e)}catch{}try{return e+""}catch{}}return""}var ec=rg,ag=fn,sg=Zp,ng=Nt,ig=ec,og=/[\\^$.*+?()[\]{}|]/g,lg=/^\[object .+?Constructor\]$/,cg=Function.prototype,dg=Object.prototype,ug=cg.toString,mg=dg.hasOwnProperty,hg=RegExp("^"+ug.call(mg).replace(og,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function fg(e){if(!ng(e)||sg(e))return!1;var t=ag(e)?hg:lg;return t.test(ig(e))}var pg=fg;function gg(e,t){return e==null?void 0:e[t]}var xg=gg,vg=pg,yg=xg;function bg(e,t){var r=yg(e,t);return vg(r)?r:void 0}var Jt=bg,wg=Jt,jg=xt,Ng=wg(jg,"Map"),Dn=Ng,Sg=Jt,Eg=Sg(Object,"create"),rs=Eg,qi=rs;function kg(){this.__data__=qi?qi(null):{},this.size=0}var Cg=kg;function $g(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Dg=$g,Tg=rs,Ag="__lodash_hash_undefined__",Mg=Object.prototype,Pg=Mg.hasOwnProperty;function Og(e){var t=this.__data__;if(Tg){var r=t[e];return r===Ag?void 0:r}return Pg.call(t,e)?t[e]:void 0}var Rg=Og,_g=rs,Lg=Object.prototype,Ig=Lg.hasOwnProperty;function Fg(e){var t=this.__data__;return _g?t[e]!==void 0:Ig.call(t,e)}var Wg=Fg,Hg=rs,Ug="__lodash_hash_undefined__";function zg(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Hg&&t===void 0?Ug:t,this}var Bg=zg,Gg=Cg,qg=Dg,Yg=Rg,Vg=Wg,Kg=Bg;function wr(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}wr.prototype.clear=Gg;wr.prototype.delete=qg;wr.prototype.get=Yg;wr.prototype.has=Vg;wr.prototype.set=Kg;var Xg=wr,Yi=Xg,Jg=ts,Qg=Dn;function Zg(){this.size=0,this.__data__={hash:new Yi,map:new(Qg||Jg),string:new Yi}}var ex=Zg;function tx(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var rx=tx,ax=rx;function sx(e,t){var r=e.__data__;return ax(t)?r[typeof t=="string"?"string":"hash"]:r.map}var as=sx,nx=as;function ix(e){var t=nx(this,e).delete(e);return this.size-=t?1:0,t}var ox=ix,lx=as;function cx(e){return lx(this,e).get(e)}var dx=cx,ux=as;function mx(e){return ux(this,e).has(e)}var hx=mx,fx=as;function px(e,t){var r=fx(this,e),s=r.size;return r.set(e,t),this.size+=r.size==s?0:1,this}var gx=px,xx=ex,vx=ox,yx=dx,bx=hx,wx=gx;function jr(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}jr.prototype.clear=xx;jr.prototype.delete=vx;jr.prototype.get=yx;jr.prototype.has=bx;jr.prototype.set=wx;var Tn=jr,jx=ts,Nx=Dn,Sx=Tn,Ex=200;function kx(e,t){var r=this.__data__;if(r instanceof jx){var s=r.__data__;if(!Nx||s.length<Ex-1)return s.push([e,t]),this.size=++r.size,this;r=this.__data__=new Sx(s)}return r.set(e,t),this.size=r.size,this}var Cx=kx,$x=ts,Dx=Up,Tx=Bp,Ax=qp,Mx=Vp,Px=Cx;function Nr(e){var t=this.__data__=new $x(e);this.size=t.size}Nr.prototype.clear=Dx;Nr.prototype.delete=Tx;Nr.prototype.get=Ax;Nr.prototype.has=Mx;Nr.prototype.set=Px;var An=Nr,Ox="__lodash_hash_undefined__";function Rx(e){return this.__data__.set(e,Ox),this}var _x=Rx;function Lx(e){return this.__data__.has(e)}var Ix=Lx,Fx=Tn,Wx=_x,Hx=Ix;function Ha(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Fx;++t<r;)this.add(e[t])}Ha.prototype.add=Ha.prototype.push=Wx;Ha.prototype.has=Hx;var Ux=Ha;function zx(e,t){for(var r=-1,s=e==null?0:e.length;++r<s;)if(t(e[r],r,e))return!0;return!1}var Bx=zx;function Gx(e,t){return e.has(t)}var qx=Gx,Yx=Ux,Vx=Bx,Kx=qx,Xx=1,Jx=2;function Qx(e,t,r,s,n,i){var o=r&Xx,l=e.length,c=t.length;if(l!=c&&!(o&&c>l))return!1;var d=i.get(e),u=i.get(t);if(d&&u)return d==t&&u==e;var m=-1,f=!0,p=r&Jx?new Yx:void 0;for(i.set(e,t),i.set(t,e);++m<l;){var v=e[m],g=t[m];if(s)var y=o?s(g,v,m,t,e,i):s(v,g,m,e,t,i);if(y!==void 0){if(y)continue;f=!1;break}if(p){if(!Vx(t,function(w,j){if(!Kx(p,j)&&(v===w||n(v,w,r,s,i)))return p.push(j)})){f=!1;break}}else if(!(v===g||n(v,g,r,s,i))){f=!1;break}}return i.delete(e),i.delete(t),f}var tc=Qx,Zx=xt,ev=Zx.Uint8Array,rc=ev;function tv(e){var t=-1,r=Array(e.size);return e.forEach(function(s,n){r[++t]=[n,s]}),r}var rv=tv;function av(e){var t=-1,r=Array(e.size);return e.forEach(function(s){r[++t]=s}),r}var sv=av,Vi=vr,Ki=rc,nv=na,iv=tc,ov=rv,lv=sv,cv=1,dv=2,uv="[object Boolean]",mv="[object Date]",hv="[object Error]",fv="[object Map]",pv="[object Number]",gv="[object RegExp]",xv="[object Set]",vv="[object String]",yv="[object Symbol]",bv="[object ArrayBuffer]",wv="[object DataView]",Xi=Vi?Vi.prototype:void 0,Cs=Xi?Xi.valueOf:void 0;function jv(e,t,r,s,n,i,o){switch(r){case wv:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case bv:return!(e.byteLength!=t.byteLength||!i(new Ki(e),new Ki(t)));case uv:case mv:case pv:return nv(+e,+t);case hv:return e.name==t.name&&e.message==t.message;case gv:case vv:return e==t+"";case fv:var l=ov;case xv:var c=s&cv;if(l||(l=lv),e.size!=t.size&&!c)return!1;var d=o.get(e);if(d)return d==t;s|=dv,o.set(e,t);var u=iv(l(e),l(t),s,n,i,o);return o.delete(e),u;case yv:if(Cs)return Cs.call(e)==Cs.call(t)}return!1}var Nv=jv;function Sv(e,t){for(var r=-1,s=t.length,n=e.length;++r<s;)e[n+r]=t[r];return e}var Mn=Sv,Ev=Array.isArray,ot=Ev,kv=Mn,Cv=ot;function $v(e,t,r){var s=t(e);return Cv(e)?s:kv(s,r(e))}var ac=$v;function Dv(e,t){for(var r=-1,s=e==null?0:e.length,n=0,i=[];++r<s;){var o=e[r];t(o,r,e)&&(i[n++]=o)}return i}var Tv=Dv;function Av(){return[]}var sc=Av,Mv=Tv,Pv=sc,Ov=Object.prototype,Rv=Ov.propertyIsEnumerable,Ji=Object.getOwnPropertySymbols,_v=Ji?function(e){return e==null?[]:(e=Object(e),Mv(Ji(e),function(t){return Rv.call(e,t)}))}:Pv,Pn=_v;function Lv(e,t){for(var r=-1,s=Array(e);++r<e;)s[r]=t(r);return s}var Iv=Lv,Fv=yr,Wv=Tt,Hv="[object Arguments]";function Uv(e){return Wv(e)&&Fv(e)==Hv}var zv=Uv,Qi=zv,Bv=Tt,nc=Object.prototype,Gv=nc.hasOwnProperty,qv=nc.propertyIsEnumerable,Yv=Qi(function(){return arguments}())?Qi:function(e){return Bv(e)&&Gv.call(e,"callee")&&!qv.call(e,"callee")},On=Yv,Ua={exports:{}};function Vv(){return!1}var Kv=Vv;Ua.exports;(function(e,t){var r=xt,s=Kv,n=t&&!t.nodeType&&t,i=n&&!0&&e&&!e.nodeType&&e,o=i&&i.exports===n,l=o?r.Buffer:void 0,c=l?l.isBuffer:void 0,d=c||s;e.exports=d})(Ua,Ua.exports);var ss=Ua.exports,Xv=yr,Jv=pn,Qv=Tt,Zv="[object Arguments]",ey="[object Array]",ty="[object Boolean]",ry="[object Date]",ay="[object Error]",sy="[object Function]",ny="[object Map]",iy="[object Number]",oy="[object Object]",ly="[object RegExp]",cy="[object Set]",dy="[object String]",uy="[object WeakMap]",my="[object ArrayBuffer]",hy="[object DataView]",fy="[object Float32Array]",py="[object Float64Array]",gy="[object Int8Array]",xy="[object Int16Array]",vy="[object Int32Array]",yy="[object Uint8Array]",by="[object Uint8ClampedArray]",wy="[object Uint16Array]",jy="[object Uint32Array]",$e={};$e[fy]=$e[py]=$e[gy]=$e[xy]=$e[vy]=$e[yy]=$e[by]=$e[wy]=$e[jy]=!0;$e[Zv]=$e[ey]=$e[my]=$e[ty]=$e[hy]=$e[ry]=$e[ay]=$e[sy]=$e[ny]=$e[iy]=$e[oy]=$e[ly]=$e[cy]=$e[dy]=$e[uy]=!1;function Ny(e){return Qv(e)&&Jv(e.length)&&!!$e[Xv(e)]}var Sy=Ny;function Ey(e){return function(t){return e(t)}}var ns=Ey,za={exports:{}};za.exports;(function(e,t){var r=Ll,s=t&&!t.nodeType&&t,n=s&&!0&&e&&!e.nodeType&&e,i=n&&n.exports===s,o=i&&r.process,l=function(){try{var c=n&&n.require&&n.require("util").types;return c||o&&o.binding&&o.binding("util")}catch{}}();e.exports=l})(za,za.exports);var Rn=za.exports,ky=Sy,Cy=ns,Zi=Rn,eo=Zi&&Zi.isTypedArray,$y=eo?Cy(eo):ky,_n=$y,Dy=Iv,Ty=On,Ay=ot,My=ss,Py=gn,Oy=_n,Ry=Object.prototype,_y=Ry.hasOwnProperty;function Ly(e,t){var r=Ay(e),s=!r&&Ty(e),n=!r&&!s&&My(e),i=!r&&!s&&!n&&Oy(e),o=r||s||n||i,l=o?Dy(e.length,String):[],c=l.length;for(var d in e)(t||_y.call(e,d))&&!(o&&(d=="length"||n&&(d=="offset"||d=="parent")||i&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||Py(d,c)))&&l.push(d);return l}var ic=Ly,Iy=Object.prototype;function Fy(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Iy;return e===r}var Ln=Fy;function Wy(e,t){return function(r){return e(t(r))}}var oc=Wy,Hy=oc,Uy=Hy(Object.keys,Object),zy=Uy,By=Ln,Gy=zy,qy=Object.prototype,Yy=qy.hasOwnProperty;function Vy(e){if(!By(e))return Gy(e);var t=[];for(var r in Object(e))Yy.call(e,r)&&r!="constructor"&&t.push(r);return t}var Ky=Vy,Xy=ic,Jy=Ky,Qy=ia;function Zy(e){return Qy(e)?Xy(e):Jy(e)}var ua=Zy,e0=ac,t0=Pn,r0=ua;function a0(e){return e0(e,r0,t0)}var lc=a0,to=lc,s0=1,n0=Object.prototype,i0=n0.hasOwnProperty;function o0(e,t,r,s,n,i){var o=r&s0,l=to(e),c=l.length,d=to(t),u=d.length;if(c!=u&&!o)return!1;for(var m=c;m--;){var f=l[m];if(!(o?f in t:i0.call(t,f)))return!1}var p=i.get(e),v=i.get(t);if(p&&v)return p==t&&v==e;var g=!0;i.set(e,t),i.set(t,e);for(var y=o;++m<c;){f=l[m];var w=e[f],j=t[f];if(s)var k=o?s(j,w,f,t,e,i):s(w,j,f,e,t,i);if(!(k===void 0?w===j||n(w,j,r,s,i):k)){g=!1;break}y||(y=f=="constructor")}if(g&&!y){var S=e.constructor,T=t.constructor;S!=T&&"constructor"in e&&"constructor"in t&&!(typeof S=="function"&&S instanceof S&&typeof T=="function"&&T instanceof T)&&(g=!1)}return i.delete(e),i.delete(t),g}var l0=o0,c0=Jt,d0=xt,u0=c0(d0,"DataView"),m0=u0,h0=Jt,f0=xt,p0=h0(f0,"Promise"),g0=p0,x0=Jt,v0=xt,y0=x0(v0,"Set"),b0=y0,w0=Jt,j0=xt,N0=w0(j0,"WeakMap"),S0=N0,Ks=m0,Xs=Dn,Js=g0,Qs=b0,Zs=S0,cc=yr,Sr=ec,ro="[object Map]",E0="[object Object]",ao="[object Promise]",so="[object Set]",no="[object WeakMap]",io="[object DataView]",k0=Sr(Ks),C0=Sr(Xs),$0=Sr(Js),D0=Sr(Qs),T0=Sr(Zs),Lt=cc;(Ks&&Lt(new Ks(new ArrayBuffer(1)))!=io||Xs&&Lt(new Xs)!=ro||Js&&Lt(Js.resolve())!=ao||Qs&&Lt(new Qs)!=so||Zs&&Lt(new Zs)!=no)&&(Lt=function(e){var t=cc(e),r=t==E0?e.constructor:void 0,s=r?Sr(r):"";if(s)switch(s){case k0:return io;case C0:return ro;case $0:return ao;case D0:return so;case T0:return no}return t});var is=Lt,$s=An,A0=tc,M0=Nv,P0=l0,oo=is,lo=ot,co=ss,O0=_n,R0=1,uo="[object Arguments]",mo="[object Array]",wa="[object Object]",_0=Object.prototype,ho=_0.hasOwnProperty;function L0(e,t,r,s,n,i){var o=lo(e),l=lo(t),c=o?mo:oo(e),d=l?mo:oo(t);c=c==uo?wa:c,d=d==uo?wa:d;var u=c==wa,m=d==wa,f=c==d;if(f&&co(e)){if(!co(t))return!1;o=!0,u=!1}if(f&&!u)return i||(i=new $s),o||O0(e)?A0(e,t,r,s,n,i):M0(e,t,c,r,s,n,i);if(!(r&R0)){var p=u&&ho.call(e,"__wrapped__"),v=m&&ho.call(t,"__wrapped__");if(p||v){var g=p?e.value():e,y=v?t.value():t;return i||(i=new $s),n(g,y,r,s,i)}}return f?(i||(i=new $s),P0(e,t,r,s,n,i)):!1}var I0=L0,F0=I0,fo=Tt;function dc(e,t,r,s,n){return e===t?!0:e==null||t==null||!fo(e)&&!fo(t)?e!==e&&t!==t:F0(e,t,r,s,dc,n)}var In=dc,W0=In;function H0(e,t){return W0(e,t)}var U0=H0;const z0=it(U0);function Ds(e,t){var r=xn(e);return r?r.innerHeight:Ht(e).height}function uc(e,t,r){e.closest&&!r&&e.closest(t);var s=e;do{if(Uh(s,t))return s;s=s.parentElement}while(s&&s!==r&&s.nodeType===document.ELEMENT_NODE);return null}function B0(e,t,r,s){for(var n=e.length,i=r+(s?1:-1);s?i--:++i<n;)if(t(e[i],i,e))return i;return-1}var G0=B0,q0=An,Y0=In,V0=1,K0=2;function X0(e,t,r,s){var n=r.length,i=n,o=!s;if(e==null)return!i;for(e=Object(e);n--;){var l=r[n];if(o&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++n<i;){l=r[n];var c=l[0],d=e[c],u=l[1];if(o&&l[2]){if(d===void 0&&!(c in e))return!1}else{var m=new q0;if(s)var f=s(d,u,c,e,t,m);if(!(f===void 0?Y0(u,d,V0|K0,s,m):f))return!1}}return!0}var J0=X0,Q0=Nt;function Z0(e){return e===e&&!Q0(e)}var mc=Z0,eb=mc,tb=ua;function rb(e){for(var t=tb(e),r=t.length;r--;){var s=t[r],n=e[s];t[r]=[s,n,eb(n)]}return t}var ab=rb;function sb(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var hc=sb,nb=J0,ib=ab,ob=hc;function lb(e){var t=ib(e);return t.length==1&&t[0][2]?ob(t[0][0],t[0][1]):function(r){return r===e||nb(r,e,t)}}var cb=lb,db=ot,ub=oa,mb=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,hb=/^\w*$/;function fb(e,t){if(db(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||ub(e)?!0:hb.test(e)||!mb.test(e)||t!=null&&e in Object(t)}var Fn=fb,fc=Tn,pb="Expected a function";function Wn(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(pb);var r=function(){var s=arguments,n=t?t.apply(this,s):s[0],i=r.cache;if(i.has(n))return i.get(n);var o=e.apply(this,s);return r.cache=i.set(n,o)||i,o};return r.cache=new(Wn.Cache||fc),r}Wn.Cache=fc;var gb=Wn,xb=gb,vb=500;function yb(e){var t=xb(e,function(s){return r.size===vb&&r.clear(),s}),r=t.cache;return t}var bb=yb,wb=bb,jb=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Nb=/\\(\\)?/g,Sb=wb(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(jb,function(r,s,n,i){t.push(n?i.replace(Nb,"$1"):s||r)}),t}),Eb=Sb;function kb(e,t){for(var r=-1,s=e==null?0:e.length,n=Array(s);++r<s;)n[r]=t(e[r],r,e);return n}var Hn=kb,po=vr,Cb=Hn,$b=ot,Db=oa,go=po?po.prototype:void 0,xo=go?go.toString:void 0;function pc(e){if(typeof e=="string")return e;if($b(e))return Cb(e,pc)+"";if(Db(e))return xo?xo.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var Tb=pc,Ab=Tb;function Mb(e){return e==null?"":Ab(e)}var Pb=Mb,Ob=ot,Rb=Fn,_b=Eb,Lb=Pb;function Ib(e,t){return Ob(e)?e:Rb(e,t)?[e]:_b(Lb(e))}var os=Ib,Fb=oa;function Wb(e){if(typeof e=="string"||Fb(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var ma=Wb,Hb=os,Ub=ma;function zb(e,t){t=Hb(t,e);for(var r=0,s=t.length;e!=null&&r<s;)e=e[Ub(t[r++])];return r&&r==s?e:void 0}var ls=zb,Bb=ls;function Gb(e,t,r){var s=e==null?void 0:Bb(e,t);return s===void 0?r:s}var qb=Gb;function Yb(e,t){return e!=null&&t in Object(e)}var Vb=Yb,Kb=os,Xb=On,Jb=ot,Qb=gn,Zb=pn,ew=ma;function tw(e,t,r){t=Kb(t,e);for(var s=-1,n=t.length,i=!1;++s<n;){var o=ew(t[s]);if(!(i=e!=null&&r(e,o)))break;e=e[o]}return i||++s!=n?i:(n=e==null?0:e.length,!!n&&Zb(n)&&Qb(o,n)&&(Jb(e)||Xb(e)))}var rw=tw,aw=Vb,sw=rw;function nw(e,t){return e!=null&&sw(e,t,aw)}var iw=nw,ow=In,lw=qb,cw=iw,dw=Fn,uw=mc,mw=hc,hw=ma,fw=1,pw=2;function gw(e,t){return dw(e)&&uw(t)?mw(hw(e),t):function(r){var s=lw(r,e);return s===void 0&&s===t?cw(r,e):ow(t,s,fw|pw)}}var xw=gw;function vw(e){return e}var cs=vw;function yw(e){return function(t){return t==null?void 0:t[e]}}var bw=yw,ww=ls;function jw(e){return function(t){return ww(t,e)}}var Nw=jw,Sw=bw,Ew=Nw,kw=Fn,Cw=ma;function $w(e){return kw(e)?Sw(Cw(e)):Ew(e)}var Dw=$w,Tw=cb,Aw=xw,Mw=cs,Pw=ot,Ow=Dw;function Rw(e){return typeof e=="function"?e:e==null?Mw:typeof e=="object"?Pw(e)?Aw(e[0],e[1]):Tw(e):Ow(e)}var ds=Rw,_w=G0,Lw=ds,Iw=Wl,Fw=Math.max;function Ww(e,t,r){var s=e==null?0:e.length;if(!s)return-1;var n=r==null?0:Iw(r);return n<0&&(n=Fw(s+n,0)),_w(e,Lw(t),n)}var Hw=Ww;const Uw=it(Hw);var zw=Math.ceil,Bw=Math.max;function Gw(e,t,r,s){for(var n=-1,i=Bw(zw((t-e)/(r||1)),0),o=Array(i);i--;)o[s?i:++n]=e,e+=r;return o}var qw=Gw,Yw=qw,Vw=Qa,Ts=Fl;function Kw(e){return function(t,r,s){return s&&typeof s!="number"&&Vw(t,r,s)&&(r=s=void 0),t=Ts(t),r===void 0?(r=t,t=0):r=Ts(r),s=s===void 0?t<r?1:-1:Ts(s),Yw(t,r,s,e)}}var Xw=Kw,Jw=Xw,Qw=Jw(),Zw=Qw;const ej=it(Zw);var vo=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function tj(e,t){return!!(e===t||vo(e)&&vo(t))}function rj(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!tj(e[r],t[r]))return!1;return!0}function gc(e,t){t===void 0&&(t=rj);var r=null;function s(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];if(r&&r.lastThis===this&&t(n,r.lastArgs))return r.lastResult;var o=e.apply(this,n);return r={lastResult:o,lastArgs:n,lastThis:this},o}return s.clear=function(){r=null},s}function en(e,t){var r=xn(e);return r?r.innerWidth:Ht(e).width}var yo=vr,aj=On,sj=ot,bo=yo?yo.isConcatSpreadable:void 0;function nj(e){return sj(e)||aj(e)||!!(bo&&e&&e[bo])}var ij=nj,oj=Mn,lj=ij;function xc(e,t,r,s,n){var i=-1,o=e.length;for(r||(r=lj),n||(n=[]);++i<o;){var l=e[i];t>0&&r(l)?t>1?xc(l,t-1,r,s,n):oj(n,l):s||(n[n.length]=l)}return n}var vc=xc;function cj(e){return function(t,r,s){for(var n=-1,i=Object(t),o=s(t),l=o.length;l--;){var c=o[e?l:++n];if(r(i[c],c,i)===!1)break}return t}}var dj=cj,uj=dj,mj=uj(),hj=mj,fj=hj,pj=ua;function gj(e,t){return e&&fj(e,t,pj)}var Un=gj,xj=ia;function vj(e,t){return function(r,s){if(r==null)return r;if(!xj(r))return e(r,s);for(var n=r.length,i=t?n:-1,o=Object(r);(t?i--:++i<n)&&s(o[i],i,o)!==!1;);return r}}var yj=vj,bj=Un,wj=yj,jj=wj(bj),Nj=jj,Sj=Nj,Ej=ia;function kj(e,t){var r=-1,s=Ej(e)?Array(e.length):[];return Sj(e,function(n,i,o){s[++r]=t(n,i,o)}),s}var Cj=kj;function $j(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var Dj=$j,wo=oa;function Tj(e,t){if(e!==t){var r=e!==void 0,s=e===null,n=e===e,i=wo(e),o=t!==void 0,l=t===null,c=t===t,d=wo(t);if(!l&&!d&&!i&&e>t||i&&o&&c&&!l&&!d||s&&o&&c||!r&&c||!n)return 1;if(!s&&!i&&!d&&e<t||d&&r&&n&&!s&&!i||l&&r&&n||!o&&n||!c)return-1}return 0}var Aj=Tj,Mj=Aj;function Pj(e,t,r){for(var s=-1,n=e.criteria,i=t.criteria,o=n.length,l=r.length;++s<o;){var c=Mj(n[s],i[s]);if(c){if(s>=l)return c;var d=r[s];return c*(d=="desc"?-1:1)}}return e.index-t.index}var Oj=Pj,As=Hn,Rj=ls,_j=ds,Lj=Cj,Ij=Dj,Fj=ns,Wj=Oj,Hj=cs,Uj=ot;function zj(e,t,r){t.length?t=As(t,function(i){return Uj(i)?function(o){return Rj(o,i.length===1?i[0]:i)}:i}):t=[Hj];var s=-1;t=As(t,Fj(_j));var n=Lj(e,function(i,o,l){var c=As(t,function(d){return d(i)});return{criteria:c,index:++s,value:i}});return Ij(n,function(i,o){return Wj(i,o,r)})}var Bj=zj;function Gj(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var qj=Gj,Yj=qj,jo=Math.max;function Vj(e,t,r){return t=jo(t===void 0?e.length-1:t,0),function(){for(var s=arguments,n=-1,i=jo(s.length-t,0),o=Array(i);++n<i;)o[n]=s[t+n];n=-1;for(var l=Array(t+1);++n<t;)l[n]=s[n];return l[t]=r(o),Yj(e,this,l)}}var yc=Vj;function Kj(e){return function(){return e}}var Xj=Kj,Jj=Jt,Qj=function(){try{var e=Jj(Object,"defineProperty");return e({},"",{}),e}catch{}}(),bc=Qj,Zj=Xj,No=bc,eN=cs,tN=No?function(e,t){return No(e,"toString",{configurable:!0,enumerable:!1,value:Zj(t),writable:!0})}:eN,rN=tN,aN=800,sN=16,nN=Date.now;function iN(e){var t=0,r=0;return function(){var s=nN(),n=sN-(s-r);if(r=s,n>0){if(++t>=aN)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var oN=iN,lN=rN,cN=oN,dN=cN(lN),wc=dN,uN=cs,mN=yc,hN=wc;function fN(e,t){return hN(mN(e,t,uN),e+"")}var jc=fN,pN=vc,gN=Bj,xN=jc,So=Qa,vN=xN(function(e,t){if(e==null)return[];var r=t.length;return r>1&&So(e,t[0],t[1])?t=[]:r>2&&So(t[0],t[1],t[2])&&(t=[t[0]]),gN(e,pN(t,1),[])}),yN=vN;const bN=it(yN);function Nc(e){return wl(e)||Rl(e)||un(e)||jl()}function wN(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var jN=wN,NN=Nt,SN=Ln,EN=jN,kN=Object.prototype,CN=kN.hasOwnProperty;function $N(e){if(!NN(e))return EN(e);var t=SN(e),r=[];for(var s in e)s=="constructor"&&(t||!CN.call(e,s))||r.push(s);return r}var DN=$N,TN=ic,AN=DN,MN=ia;function PN(e){return MN(e)?TN(e,!0):AN(e)}var us=PN,ON=jc,RN=na,_N=Qa,LN=us,Sc=Object.prototype,IN=Sc.hasOwnProperty,FN=ON(function(e,t){e=Object(e);var r=-1,s=t.length,n=s>2?t[2]:void 0;for(n&&_N(t[0],t[1],n)&&(s=1);++r<s;)for(var i=t[r],o=LN(i),l=-1,c=o.length;++l<c;){var d=o[l],u=e[d];(u===void 0||RN(u,Sc[d])&&!IN.call(e,d))&&(e[d]=i[d])}return e}),WN=FN;const HN=it(WN);var Eo=bc;function UN(e,t,r){t=="__proto__"&&Eo?Eo(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var zn=UN,zN=zn,BN=Un,GN=ds;function qN(e,t){var r={};return t=GN(t),BN(e,function(s,n,i){zN(r,n,t(s,n,i))}),r}var YN=qN;const VN=it(YN);function KN(e,t){for(var r=-1,s=e==null?0:e.length;++r<s&&t(e[r],r,e)!==!1;);return e}var Ec=KN,XN=zn,JN=na,QN=Object.prototype,ZN=QN.hasOwnProperty;function e1(e,t,r){var s=e[t];(!(ZN.call(e,t)&&JN(s,r))||r===void 0&&!(t in e))&&XN(e,t,r)}var kc=e1,t1=kc,r1=zn;function a1(e,t,r,s){var n=!r;r||(r={});for(var i=-1,o=t.length;++i<o;){var l=t[i],c=s?s(r[l],e[l],l,r,e):void 0;c===void 0&&(c=e[l]),n?r1(r,l,c):t1(r,l,c)}return r}var ha=a1,s1=ha,n1=ua;function i1(e,t){return e&&s1(t,n1(t),e)}var o1=i1,l1=ha,c1=us;function d1(e,t){return e&&l1(t,c1(t),e)}var u1=d1,Ba={exports:{}};Ba.exports;(function(e,t){var r=xt,s=t&&!t.nodeType&&t,n=s&&!0&&e&&!e.nodeType&&e,i=n&&n.exports===s,o=i?r.Buffer:void 0,l=o?o.allocUnsafe:void 0;function c(d,u){if(u)return d.slice();var m=d.length,f=l?l(m):new d.constructor(m);return d.copy(f),f}e.exports=c})(Ba,Ba.exports);var m1=Ba.exports;function h1(e,t){var r=-1,s=e.length;for(t||(t=Array(s));++r<s;)t[r]=e[r];return t}var f1=h1,p1=ha,g1=Pn;function x1(e,t){return p1(e,g1(e),t)}var v1=x1,y1=oc,b1=y1(Object.getPrototypeOf,Object),ms=b1,w1=Mn,j1=ms,N1=Pn,S1=sc,E1=Object.getOwnPropertySymbols,k1=E1?function(e){for(var t=[];e;)w1(t,N1(e)),e=j1(e);return t}:S1,Cc=k1,C1=ha,$1=Cc;function D1(e,t){return C1(e,$1(e),t)}var T1=D1,A1=ac,M1=Cc,P1=us;function O1(e){return A1(e,P1,M1)}var $c=O1,R1=Object.prototype,_1=R1.hasOwnProperty;function L1(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&_1.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var I1=L1,ko=rc;function F1(e){var t=new e.constructor(e.byteLength);return new ko(t).set(new ko(e)),t}var Bn=F1,W1=Bn;function H1(e,t){var r=t?W1(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var U1=H1,z1=/\w*$/;function B1(e){var t=new e.constructor(e.source,z1.exec(e));return t.lastIndex=e.lastIndex,t}var G1=B1,Co=vr,$o=Co?Co.prototype:void 0,Do=$o?$o.valueOf:void 0;function q1(e){return Do?Object(Do.call(e)):{}}var Y1=q1,V1=Bn;function K1(e,t){var r=t?V1(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var X1=K1,J1=Bn,Q1=U1,Z1=G1,eS=Y1,tS=X1,rS="[object Boolean]",aS="[object Date]",sS="[object Map]",nS="[object Number]",iS="[object RegExp]",oS="[object Set]",lS="[object String]",cS="[object Symbol]",dS="[object ArrayBuffer]",uS="[object DataView]",mS="[object Float32Array]",hS="[object Float64Array]",fS="[object Int8Array]",pS="[object Int16Array]",gS="[object Int32Array]",xS="[object Uint8Array]",vS="[object Uint8ClampedArray]",yS="[object Uint16Array]",bS="[object Uint32Array]";function wS(e,t,r){var s=e.constructor;switch(t){case dS:return J1(e);case rS:case aS:return new s(+e);case uS:return Q1(e,r);case mS:case hS:case fS:case pS:case gS:case xS:case vS:case yS:case bS:return tS(e,r);case sS:return new s;case nS:case lS:return new s(e);case iS:return Z1(e);case oS:return new s;case cS:return eS(e)}}var jS=wS,NS=Nt,To=Object.create,SS=function(){function e(){}return function(t){if(!NS(t))return{};if(To)return To(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),Dc=SS,ES=Dc,kS=ms,CS=Ln;function $S(e){return typeof e.constructor=="function"&&!CS(e)?ES(kS(e)):{}}var DS=$S,TS=is,AS=Tt,MS="[object Map]";function PS(e){return AS(e)&&TS(e)==MS}var OS=PS,RS=OS,_S=ns,Ao=Rn,Mo=Ao&&Ao.isMap,LS=Mo?_S(Mo):RS,IS=LS,FS=is,WS=Tt,HS="[object Set]";function US(e){return WS(e)&&FS(e)==HS}var zS=US,BS=zS,GS=ns,Po=Rn,Oo=Po&&Po.isSet,qS=Oo?GS(Oo):BS,YS=qS,VS=An,KS=Ec,XS=kc,JS=o1,QS=u1,ZS=m1,e2=f1,t2=v1,r2=T1,a2=lc,s2=$c,n2=is,i2=I1,o2=jS,l2=DS,c2=ot,d2=ss,u2=IS,m2=Nt,h2=YS,f2=ua,p2=us,g2=1,x2=2,v2=4,Tc="[object Arguments]",y2="[object Array]",b2="[object Boolean]",w2="[object Date]",j2="[object Error]",Ac="[object Function]",N2="[object GeneratorFunction]",S2="[object Map]",E2="[object Number]",Mc="[object Object]",k2="[object RegExp]",C2="[object Set]",$2="[object String]",D2="[object Symbol]",T2="[object WeakMap]",A2="[object ArrayBuffer]",M2="[object DataView]",P2="[object Float32Array]",O2="[object Float64Array]",R2="[object Int8Array]",_2="[object Int16Array]",L2="[object Int32Array]",I2="[object Uint8Array]",F2="[object Uint8ClampedArray]",W2="[object Uint16Array]",H2="[object Uint32Array]",ke={};ke[Tc]=ke[y2]=ke[A2]=ke[M2]=ke[b2]=ke[w2]=ke[P2]=ke[O2]=ke[R2]=ke[_2]=ke[L2]=ke[S2]=ke[E2]=ke[Mc]=ke[k2]=ke[C2]=ke[$2]=ke[D2]=ke[I2]=ke[F2]=ke[W2]=ke[H2]=!0;ke[j2]=ke[Ac]=ke[T2]=!1;function $a(e,t,r,s,n,i){var o,l=t&g2,c=t&x2,d=t&v2;if(r&&(o=n?r(e,s,n,i):r(e)),o!==void 0)return o;if(!m2(e))return e;var u=c2(e);if(u){if(o=i2(e),!l)return e2(e,o)}else{var m=n2(e),f=m==Ac||m==N2;if(d2(e))return ZS(e,l);if(m==Mc||m==Tc||f&&!n){if(o=c||f?{}:l2(e),!l)return c?r2(e,QS(o,e)):t2(e,JS(o,e))}else{if(!ke[m])return n?e:{};o=o2(e,m,l)}}i||(i=new VS);var p=i.get(e);if(p)return p;i.set(e,o),h2(e)?e.forEach(function(y){o.add($a(y,t,r,y,e,i))}):u2(e)&&e.forEach(function(y,w){o.set(w,$a(y,t,r,w,e,i))});var v=d?c?s2:a2:c?p2:f2,g=u?void 0:v(e);return KS(g||e,function(y,w){g&&(w=y,y=e[w]),XS(o,w,$a(y,t,r,w,e,i))}),o}var U2=$a;function z2(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var B2=z2,G2=ls,q2=_l;function Y2(e,t){return t.length<2?e:G2(e,q2(t,0,-1))}var V2=Y2,K2=os,X2=B2,J2=V2,Q2=ma;function Z2(e,t){return t=K2(t,e),e=J2(e,t),e==null||delete e[Q2(X2(t))]}var eE=Z2,tE=yr,rE=ms,aE=Tt,sE="[object Object]",nE=Function.prototype,iE=Object.prototype,Pc=nE.toString,oE=iE.hasOwnProperty,lE=Pc.call(Object);function cE(e){if(!aE(e)||tE(e)!=sE)return!1;var t=rE(e);if(t===null)return!0;var r=oE.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&Pc.call(r)==lE}var dE=cE,uE=dE;function mE(e){return uE(e)?void 0:e}var hE=mE,fE=vc;function pE(e){var t=e==null?0:e.length;return t?fE(e,1):[]}var gE=pE,xE=gE,vE=yc,yE=wc;function bE(e){return yE(vE(e,void 0,xE),e+"")}var wE=bE,jE=Hn,NE=U2,SE=eE,EE=os,kE=ha,CE=hE,$E=wE,DE=$c,TE=1,AE=2,ME=4,PE=$E(function(e,t){var r={};if(e==null)return r;var s=!1;t=jE(t,function(i){return i=EE(i,e),s||(s=i.length>1),i}),kE(e,DE(e),r),s&&(r=NE(r,TE|AE|ME,CE));for(var n=t.length;n--;)SE(r,t[n]);return r}),OE=PE;const RE=it(OE);var _E=Ec,LE=Dc,IE=Un,FE=ds,WE=ms,HE=ot,UE=ss,zE=fn,BE=Nt,GE=_n;function qE(e,t,r){var s=HE(e),n=s||UE(e)||GE(e);if(t=FE(t),r==null){var i=e&&e.constructor;n?r=s?new i:[]:BE(e)?r=zE(i)?LE(WE(e)):{}:r={}}return(n?_E:IE)(e,function(o,l,c){return t(r,o,l,c)}),r}var YE=qE;const VE=it(YE);var KE={exports:{}};(function(e,t){(function(r,s){e.exports=s()})(at,function(){return function(r,s,n){s.prototype.isBetween=function(i,o,l,c){var d=n(i),u=n(o),m=(c=c||"()")[0]==="(",f=c[1]===")";return(m?this.isAfter(d,l):!this.isBefore(d,l))&&(f?this.isBefore(u,l):!this.isAfter(u,l))||(m?this.isBefore(d,l):!this.isAfter(d,l))&&(f?this.isAfter(u,l):!this.isBefore(u,l))}}})})(KE);var XE={exports:{}};(function(e,t){(function(r,s){e.exports=s()})(at,function(){return function(r,s){s.prototype.isSameOrAfter=function(n,i){return this.isSame(n,i)||this.isAfter(n,i)}}})})(XE);var JE={exports:{}};(function(e,t){(function(r,s){e.exports=s()})(at,function(){return function(r,s){s.prototype.isSameOrBefore=function(n,i){return this.isSame(n,i)||this.isBefore(n,i)}}})})(JE);var QE={exports:{}};(function(e,t){(function(r,s){e.exports=s()})(at,function(){return function(r,s,n){var i=s.prototype,o=function(m){return m&&(m.indexOf?m:m.s)},l=function(m,f,p,v,g){var y=m.name?m:m.$locale(),w=o(y[f]),j=o(y[p]),k=w||j.map(function(T){return T.slice(0,v)});if(!g)return k;var S=y.weekStart;return k.map(function(T,b){return k[(b+(S||0))%7]})},c=function(){return n.Ls[n.locale()]},d=function(m,f){return m.formats[f]||function(p){return p.replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(v,g,y){return g||y.slice(1)})}(m.formats[f.toUpperCase()])},u=function(){var m=this;return{months:function(f){return f?f.format("MMMM"):l(m,"months")},monthsShort:function(f){return f?f.format("MMM"):l(m,"monthsShort","months",3)},firstDayOfWeek:function(){return m.$locale().weekStart||0},weekdays:function(f){return f?f.format("dddd"):l(m,"weekdays")},weekdaysMin:function(f){return f?f.format("dd"):l(m,"weekdaysMin","weekdays",2)},weekdaysShort:function(f){return f?f.format("ddd"):l(m,"weekdaysShort","weekdays",3)},longDateFormat:function(f){return d(m.$locale(),f)},meridiem:this.$locale().meridiem,ordinal:this.$locale().ordinal}};i.localeData=function(){return u.bind(this)()},n.localeData=function(){var m=c();return{firstDayOfWeek:function(){return m.weekStart||0},weekdays:function(){return n.weekdays()},weekdaysShort:function(){return n.weekdaysShort()},weekdaysMin:function(){return n.weekdaysMin()},months:function(){return n.months()},monthsShort:function(){return n.monthsShort()},longDateFormat:function(f){return d(m,f)},meridiem:m.meridiem,ordinal:m.ordinal}},n.months=function(){return l(c(),"months")},n.monthsShort=function(){return l(c(),"monthsShort","months",3)},n.weekdays=function(m){return l(c(),"weekdays",null,null,m)},n.weekdaysShort=function(m){return l(c(),"weekdaysShort","weekdays",3,m)},n.weekdaysMin=function(m){return l(c(),"weekdaysMin","weekdays",2,m)}}})})(QE);var ZE={exports:{}};(function(e,t){(function(r,s){e.exports=s()})(at,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(s,n,i){var o=n.prototype,l=o.format;i.en.formats=r,o.format=function(c){c===void 0&&(c="YYYY-MM-DDTHH:mm:ssZ");var d=this.$locale().formats,u=function(m,f){return m.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(p,v,g){var y=g&&g.toUpperCase();return v||f[g]||r[g]||f[y].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(w,j,k){return j||k.slice(1)})})}(c,d===void 0?{}:d);return l.call(this,u)}}})})(ZE);var ek={exports:{}};(function(e,t){(function(r,s){e.exports=s()})(at,function(){return function(r,s,n){var i=function(o,l){if(!l||!l.length||l.length===1&&!l[0]||l.length===1&&Array.isArray(l[0])&&!l[0].length)return null;var c;l.length===1&&l[0].length>0&&(l=l[0]),c=(l=l.filter(function(u){return u}))[0];for(var d=1;d<l.length;d+=1)l[d].isValid()&&!l[d][o](c)||(c=l[d]);return c};n.max=function(){var o=[].slice.call(arguments,0);return i("isAfter",o)},n.min=function(){var o=[].slice.call(arguments,0);return i("isBefore",o)}}})})(ek);var tk={exports:{}};(function(e,t){(function(r,s){e.exports=s()})(at,function(){var r="minute",s=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(i,o,l){var c=o.prototype;l.utc=function(g){var y={date:g,utc:!0,args:arguments};return new o(y)},c.utc=function(g){var y=l(this.toDate(),{locale:this.$L,utc:!0});return g?y.add(this.utcOffset(),r):y},c.local=function(){return l(this.toDate(),{locale:this.$L,utc:!1})};var d=c.parse;c.parse=function(g){g.utc&&(this.$u=!0),this.$utils().u(g.$offset)||(this.$offset=g.$offset),d.call(this,g)};var u=c.init;c.init=function(){if(this.$u){var g=this.$d;this.$y=g.getUTCFullYear(),this.$M=g.getUTCMonth(),this.$D=g.getUTCDate(),this.$W=g.getUTCDay(),this.$H=g.getUTCHours(),this.$m=g.getUTCMinutes(),this.$s=g.getUTCSeconds(),this.$ms=g.getUTCMilliseconds()}else u.call(this)};var m=c.utcOffset;c.utcOffset=function(g,y){var w=this.$utils().u;if(w(g))return this.$u?0:w(this.$offset)?m.call(this):this.$offset;if(typeof g=="string"&&(g=function(T){T===void 0&&(T="");var b=T.match(s);if(!b)return null;var $=(""+b[0]).match(n)||["-",0,0],A=$[0],R=60*+$[1]+ +$[2];return R===0?0:A==="+"?R:-R}(g),g===null))return this;var j=Math.abs(g)<=16?60*g:g;if(j===0)return this.utc(y);var k=this.clone();if(y)return k.$offset=j,k.$u=!1,k;var S=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();return(k=this.local().add(j+S,r)).$offset=j,k.$x.$localOffset=S,k};var f=c.format;c.format=function(g){var y=g||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return f.call(this,y)},c.valueOf=function(){var g=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*g},c.isUTC=function(){return!!this.$u},c.toISOString=function(){return this.toDate().toISOString()},c.toString=function(){return this.toDate().toUTCString()};var p=c.toDate;c.toDate=function(g){return g==="s"&&this.$offset?l(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():p.call(this)};var v=c.diff;c.diff=function(g,y,w){if(g&&this.$u===g.$u)return v.call(this,g,y,w);var j=this.local(),k=l(g).local();return v.call(j,k,y,w)}}})})(tk);var rk={exports:{}};(function(e,t){(function(r,s){e.exports=s()})(at,function(){return function(r,s){s.prototype.isLeapYear=function(){return this.$y%4==0&&this.$y%100!=0||this.$y%400==0}}})})(rk);function ut(e){return e.children}var Je={PREVIOUS:"PREV",NEXT:"NEXT",TODAY:"TODAY",DATE:"DATE"},Ye={MONTH:"month",WEEK:"week",WORK_WEEK:"work_week",DAY:"day",AGENDA:"agenda"},Ro=Object.keys(Ye).map(function(e){return Ye[e]});K.oneOfType([K.string,K.func]);K.any;K.func;K.oneOfType([K.arrayOf(K.oneOf(Ro)),K.objectOf(function(e,t){var r=Ro.indexOf(t)!==-1&&typeof e[t]=="boolean";if(r)return null;for(var s=arguments.length,n=new Array(s>2?s-2:0),i=2;i<s;i++)n[i-2]=arguments[i];return K.elementType.apply(K,[e,t].concat(n))})]);K.oneOfType([K.oneOf(["overlap","no-overlap"]),K.func]);var _o={seconds:1e3,minutes:1e3*60,hours:1e3*60*60,day:1e3*60*60*24};function Oc(e,t){var r=We(e,"month");return We(r,"week",t.startOfWeek())}function Rc(e,t){var r=Ia(e,"month");return Ia(r,"week",t.startOfWeek())}function ak(e,t){for(var r=Oc(e,t),s=Rc(e,t),n=[];gr(r,s,"day");)n.push(r),r=dt(r,1,"day");return n}function sk(e,t){var r=We(e,t);return pr(r,e)?r:dt(r,1,t)}function nk(e,t){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"day",s=e,n=[];gr(s,t,r);)n.push(s),s=dt(s,1,r);return n}function ik(e,t){return t==null&&e==null?null:(t==null&&(t=new Date),e==null&&(e=new Date),e=We(e,"day"),e=Jr(e,Jr(t)),e=lr(e,lr(t)),e=Xr(e,Xr(t)),Kr(e,Kr(t)))}function Lo(e){return Jr(e)===0&&lr(e)===0&&Xr(e)===0&&Kr(e)===0}function ok(e,t,r,s){return r==="day"&&(r="date"),Math.abs(yi[r](e,void 0,s)-yi[r](t,void 0,s))}function Gn(e,t,r){return!r||r==="milliseconds"?Math.abs(+e-+t):Math.round(Math.abs(+We(e,r)/_o[r]-+We(t,r)/_o[r]))}var lk=K.oneOfType([K.string,K.func]);function ck(e,t,r,s,n){var i=typeof s=="function"?s(r,n,e):t.call(e,r,s,n);return zr(i==null||typeof i=="string","`localizer format(..)` must return a string, null, or undefined"),i}function dk(e,t,r){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,t+r,0,0)}function qn(e,t){return e.getTimezoneOffset()-t.getTimezoneOffset()}function uk(e,t){return Gn(e,t,"minutes")+qn(e,t)}function mk(e){var t=We(e,"day");return Gn(t,e,"minutes")+qn(t,e)}function hk(e,t){return hn(e,t,"day")}function fk(e,t,r){var s=pr(e,t,"minutes");return s?sa(t,r,"minutes"):Ja(t,r,"minutes")}function tn(e,t){return ok(e,t,"day")}function pk(e){var t=e.evtA,r=t.start,s=t.end,n=t.allDay,i=e.evtB,o=i.start,l=i.end,c=i.allDay,d=+We(r,"day")-+We(o,"day"),u=tn(r,s),m=tn(o,l);return d||m-u||!!c-!!n||+r-+o||+s-+l}function gk(e){var t=e.event,r=t.start,s=t.end,n=e.range,i=n.start,o=n.end,l=We(r,"day"),c=gr(l,o,"day"),d=mn(l,s,"minutes"),u=d?Ja(s,i,"minutes"):sa(s,i,"minutes");return c&&u}function xk(e,t){return pr(e,t,"day")}function vk(e,t){return Lo(e)&&Lo(t)}var yk=Le(function e(t){var r=this;_e(this,e),zr(typeof t.format=="function","date localizer `format(..)` must be a function"),zr(typeof t.firstOfWeek=="function","date localizer `firstOfWeek(..)` must be a function"),this.propType=t.propType||lk,this.formats=t.formats,this.format=function(){for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return ck.apply(void 0,[r,t.format].concat(n))},this.startOfWeek=t.firstOfWeek,this.merge=t.merge||ik,this.inRange=t.inRange||Al,this.lt=t.lt||hn,this.lte=t.lte||gr,this.gt=t.gt||Ja,this.gte=t.gte||sa,this.eq=t.eq||pr,this.neq=t.neq||mn,this.startOf=t.startOf||We,this.endOf=t.endOf||Ia,this.add=t.add||dt,this.range=t.range||nk,this.diff=t.diff||Gn,this.ceil=t.ceil||sk,this.min=t.min||Dl,this.max=t.max||Tl,this.minutes=t.minutes||lr,this.daySpan=t.daySpan||tn,this.firstVisibleDay=t.firstVisibleDay||Oc,this.lastVisibleDay=t.lastVisibleDay||Rc,this.visibleDays=t.visibleDays||ak,this.getSlotDate=t.getSlotDate||dk,this.getTimezoneOffset=t.getTimezoneOffset||function(s){return s.getTimezoneOffset()},this.getDstOffset=t.getDstOffset||qn,this.getTotalMin=t.getTotalMin||uk,this.getMinutesFromMidnight=t.getMinutesFromMidnight||mk,this.continuesPrior=t.continuesPrior||hk,this.continuesAfter=t.continuesAfter||fk,this.sortEvents=t.sortEvents||pk,this.inEventRange=t.inEventRange||gk,this.isSameDate=t.isSameDate||xk,this.startAndEndAreDateOnly=t.startAndEndAreDateOnly||vk,this.segmentOffset=t.browserTZOffset?t.browserTZOffset():0});function bk(e,t,r,s){var n=Ne(Ne({},e.formats),r);return Ne(Ne({},e),{},{messages:s,startOfWeek:function(){return e.startOfWeek(t)},format:function(o,l){return e.format(o,n[l]||l,t)}})}var wk=function(e){function t(){var r;_e(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return r=Be(this,t,[].concat(n)),r.navigate=function(o){r.props.onNavigate(o)},r.view=function(o){r.props.onView(o)},r}return Ge(t,e),Le(t,[{key:"render",value:function(){var s=this.props,n=s.localizer.messages,i=s.label;return E.createElement("div",{className:"rbc-toolbar"},E.createElement("span",{className:"rbc-btn-group"},E.createElement("button",{type:"button",onClick:this.navigate.bind(null,Je.TODAY)},n.today),E.createElement("button",{type:"button",onClick:this.navigate.bind(null,Je.PREVIOUS)},n.previous),E.createElement("button",{type:"button",onClick:this.navigate.bind(null,Je.NEXT)},n.next)),E.createElement("span",{className:"rbc-toolbar-label"},i),E.createElement("span",{className:"rbc-btn-group"},this.viewNamesGroup(n)))}},{key:"viewNamesGroup",value:function(s){var n=this,i=this.props.views,o=this.props.view;if(i.length>1)return i.map(function(l){return E.createElement("button",{type:"button",key:l,className:Me({"rbc-active":o===l}),onClick:n.view.bind(null,l)},s[l])})}}])}(E.Component);function De(e,t){e&&e.apply(null,[].concat(t))}var jk={date:"Date",time:"Time",event:"Event",allDay:"All Day",week:"Week",work_week:"Work Week",day:"Day",month:"Month",previous:"Back",next:"Next",yesterday:"Yesterday",tomorrow:"Tomorrow",today:"Today",agenda:"Agenda",noEventsInRange:"There are no events in this range.",showMore:function(t){return"+".concat(t," more")}};function Nk(e){return Ne(Ne({},jk),e)}function Sk(e){var t=e.ref,r=e.callback;x.useEffect(function(){var s=function(i){t.current&&!t.current.contains(i.target)&&r()};return document.addEventListener("mousedown",s),function(){document.removeEventListener("mousedown",s)}},[t,r])}var Ek=["style","className","event","selected","isAllDay","onSelect","onDoubleClick","onKeyPress","localizer","continuesPrior","continuesAfter","accessors","getters","children","components","slotStart","slotEnd"],_c=function(e){function t(){return _e(this,t),Be(this,t,arguments)}return Ge(t,e),Le(t,[{key:"render",value:function(){var s=this.props,n=s.style,i=s.className,o=s.event,l=s.selected,c=s.isAllDay,d=s.onSelect,u=s.onDoubleClick,m=s.onKeyPress,f=s.localizer,p=s.continuesPrior,v=s.continuesAfter,g=s.accessors,y=s.getters,w=s.children,j=s.components,k=j.event,S=j.eventWrapper,T=s.slotStart,b=s.slotEnd,$=pt(s,Ek);delete $.resizable;var A=g.title(o),R=g.tooltip(o),I=g.end(o),z=g.start(o),Y=g.allDay(o),B=c||Y||f.diff(z,f.ceil(I,"day"),"day")>1,N=y.eventProp(o,z,I,l),G=E.createElement("div",{className:"rbc-event-content",title:R||void 0},k?E.createElement(k,{event:o,continuesPrior:p,continuesAfter:v,title:A,isAllDay:Y,localizer:f,slotStart:T,slotEnd:b}):A);return E.createElement(S,Object.assign({},this.props,{type:"date"}),E.createElement("div",Object.assign({},$,{style:Ne(Ne({},N.style),n),className:Me("rbc-event",i,N.className,{"rbc-selected":l,"rbc-event-allday":B,"rbc-event-continues-prior":p,"rbc-event-continues-after":v}),onClick:function(X){return d&&d(o,X)},onDoubleClick:function(X){return u&&u(o,X)},onKeyDown:function(X){return m&&m(o,X)}}),typeof w=="function"?w(G):G))}}])}(E.Component);function hs(e,t){return!e||t==null?!1:z0(e,t)}function Lc(e,t){var r=e.right-e.left,s=r/t;return s}function Ic(e,t,r,s){var n=Lc(e,s);return r?s-1-Math.floor((t-e.left)/n):Math.floor((t-e.left)/n)}function kk(e,t){var r=t.x,s=t.y;return s>=e.top&&s<=e.bottom&&r>=e.left&&r<=e.right}function Ck(e,t,r,s,n){var i=-1,o=-1,l=s-1,c=Lc(t,s),d=Ic(t,r.x,n,s),u=t.top<r.y&&t.bottom>r.y,m=t.top<e.y&&t.bottom>e.y,f=e.y>t.bottom,p=t.top>e.y,v=r.top<t.top&&r.bottom>t.bottom;return v&&(i=0,o=l),u&&(p?(i=0,o=d):f&&(i=d,o=l)),m&&(i=o=n?l-Math.floor((e.x-t.left)/c):Math.floor((e.x-t.left)/c),u?d<i?i=d:o=d:e.y<r.y?o=l:i=0),{startIdx:i,endIdx:o}}function $k(e){var t=e.target,r=e.offset,s=e.container,n=e.box,i=Ht(t),o=i.top,l=i.left,c=i.width,d=i.height,u=Ht(s),m=u.top,f=u.left,p=u.width,v=u.height,g=Ht(n),y=g.width,w=g.height,j=m+v,k=f+p,S=o+w,T=l+y,b=r.x,$=r.y,A=S>j?o-w-$:o+$+d,R=T>k?l+b-y+c:l+b;return{topOffset:A,leftOffset:R}}function Dk(e){var t=e.containerRef,r=e.accessors,s=e.getters,n=e.selected,i=e.components,o=e.localizer,l=e.position,c=e.show,d=e.events,u=e.slotStart,m=e.slotEnd,f=e.onSelect,p=e.onDoubleClick,v=e.onKeyPress,g=e.handleDragStart,y=e.popperRef,w=e.target,j=e.offset;Sk({ref:y,callback:c}),x.useLayoutEffect(function(){var T=$k({target:w,offset:j,container:t.current,box:y.current}),b=T.topOffset,$=T.leftOffset;y.current.style.top="".concat(b,"px"),y.current.style.left="".concat($,"px")},[j.x,j.y,w]);var k=l.width,S={minWidth:k+k/2};return E.createElement("div",{style:S,className:"rbc-overlay",ref:y},E.createElement("div",{className:"rbc-overlay-header"},o.format(u,"dayHeaderFormat")),d.map(function(T,b){return E.createElement(_c,{key:b,type:"popup",localizer:o,event:T,getters:s,onSelect:f,accessors:r,components:i,onDoubleClick:p,onKeyPress:v,continuesPrior:o.lt(r.end(T),u,"day"),continuesAfter:o.gte(r.start(T),m,"day"),slotStart:u,slotEnd:m,selected:hs(T,n),draggable:!0,onDragStart:function(){return g(T)},onDragEnd:function(){return c()}})}))}var Fc=E.forwardRef(function(e,t){return E.createElement(Dk,Object.assign({},e,{popperRef:t}))});Fc.propTypes={accessors:K.object.isRequired,getters:K.object.isRequired,selected:K.object,components:K.object.isRequired,localizer:K.object.isRequired,position:K.object.isRequired,show:K.func.isRequired,events:K.array.isRequired,slotStart:K.instanceOf(Date).isRequired,slotEnd:K.instanceOf(Date),onSelect:K.func,onDoubleClick:K.func,onKeyPress:K.func,handleDragStart:K.func,style:K.object,offset:K.shape({x:K.number,y:K.number})};function Tk(e){var t=e.containerRef,r=e.popupOffset,s=r===void 0?5:r,n=e.overlay,i=e.accessors,o=e.localizer,l=e.components,c=e.getters,d=e.selected,u=e.handleSelectEvent,m=e.handleDoubleClickEvent,f=e.handleKeyPressEvent,p=e.handleDragStart,v=e.onHide,g=e.overlayDisplay,y=x.useRef(null);if(!n.position)return null;var w=s;isNaN(s)||(w={x:s,y:s});var j=n.position,k=n.events,S=n.date,T=n.end;return E.createElement($n,{rootClose:!0,flip:!0,show:!0,placement:"bottom",onHide:v,target:n.target},function(b){var $=b.props;return E.createElement(Fc,Object.assign({},$,{containerRef:t,ref:y,target:n.target,offset:w,accessors:i,getters:c,selected:d,components:l,localizer:o,position:j,show:g,events:k,slotStart:S,slotEnd:T,onSelect:u,onDoubleClick:m,onKeyPress:f,handleDragStart:p}))})}var Yn=E.forwardRef(function(e,t){return E.createElement(Tk,Object.assign({},e,{containerRef:t}))});Yn.propTypes={popupOffset:K.oneOfType([K.number,K.shape({x:K.number,y:K.number})]),overlay:K.shape({position:K.object,events:K.array,date:K.instanceOf(Date),end:K.instanceOf(Date)}),accessors:K.object.isRequired,localizer:K.object.isRequired,components:K.object.isRequired,getters:K.object.isRequired,selected:K.object,handleSelectEvent:K.func,handleDoubleClickEvent:K.func,handleKeyPressEvent:K.func,handleDragStart:K.func,onHide:K.func,overlayDisplay:K.func};function ze(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:document;return Lr(r,e,t,{passive:!1})}function Ak(e,t,r){return!e||Qr(e,document.elementFromPoint(t,r))}function Mk(e,t){var r=t.clientX,s=t.clientY,n=document.elementFromPoint(r,s);return uc(n,".rbc-event",e)}function Pk(e,t){var r=t.clientX,s=t.clientY,n=document.elementFromPoint(r,s);return uc(n,".rbc-show-more",e)}function Ga(e,t){return!!Mk(e,t)}function Ok(e,t){return!!Pk(e,t)}function Mr(e){var t=e;return e.touches&&e.touches.length&&(t=e.touches[0]),{clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY}}var Io=5,Rk=250,Wc=function(){function e(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=r.global,n=s===void 0?!1:s,i=r.longPressThreshold,o=i===void 0?250:i,l=r.validContainers,c=l===void 0?[]:l;_e(this,e),this._initialEvent=null,this.selecting=!1,this.isDetached=!1,this.container=t,this.globalMouse=!t||n,this.longPressThreshold=o,this.validContainers=c,this._listeners=Object.create(null),this._handleInitialEvent=this._handleInitialEvent.bind(this),this._handleMoveEvent=this._handleMoveEvent.bind(this),this._handleTerminatingEvent=this._handleTerminatingEvent.bind(this),this._keyListener=this._keyListener.bind(this),this._dropFromOutsideListener=this._dropFromOutsideListener.bind(this),this._dragOverFromOutsideListener=this._dragOverFromOutsideListener.bind(this),this._removeTouchMoveWindowListener=ze("touchmove",function(){},window),this._removeKeyDownListener=ze("keydown",this._keyListener),this._removeKeyUpListener=ze("keyup",this._keyListener),this._removeDropFromOutsideListener=ze("drop",this._dropFromOutsideListener),this._removeDragOverFromOutsideListener=ze("dragover",this._dragOverFromOutsideListener),this._addInitialEventListener()}return Le(e,[{key:"on",value:function(r,s){var n=this._listeners[r]||(this._listeners[r]=[]);return n.push(s),{remove:function(){var o=n.indexOf(s);o!==-1&&n.splice(o,1)}}}},{key:"emit",value:function(r){for(var s=arguments.length,n=new Array(s>1?s-1:0),i=1;i<s;i++)n[i-1]=arguments[i];var o,l=this._listeners[r]||[];return l.forEach(function(c){o===void 0&&(o=c.apply(void 0,n))}),o}},{key:"teardown",value:function(){this._initialEvent=null,this._initialEventData=null,this._selectRect=null,this.selecting=!1,this._lastClickData=null,this.isDetached=!0,this._listeners=Object.create(null),this._removeTouchMoveWindowListener&&this._removeTouchMoveWindowListener(),this._removeInitialEventListener&&this._removeInitialEventListener(),this._removeEndListener&&this._removeEndListener(),this._onEscListener&&this._onEscListener(),this._removeMoveListener&&this._removeMoveListener(),this._removeKeyUpListener&&this._removeKeyUpListener(),this._removeKeyDownListener&&this._removeKeyDownListener(),this._removeDropFromOutsideListener&&this._removeDropFromOutsideListener(),this._removeDragOverFromOutsideListener&&this._removeDragOverFromOutsideListener()}},{key:"isSelected",value:function(r){var s=this._selectRect;return!s||!this.selecting?!1:Fo(s,Xt(r))}},{key:"filter",value:function(r){var s=this._selectRect;return!s||!this.selecting?[]:r.filter(this.isSelected,this)}},{key:"_addLongPressListener",value:function(r,s){var n=this,i=null,o=null,l=null,c=function(f){i=setTimeout(function(){u(),r(f)},n.longPressThreshold),o=ze("touchmove",function(){return u()}),l=ze("touchend",function(){return u()})},d=ze("touchstart",c),u=function(){i&&clearTimeout(i),o&&o(),l&&l(),i=null,o=null,l=null};return s&&c(s),function(){u(),d()}}},{key:"_addInitialEventListener",value:function(){var r=this,s=ze("mousedown",function(i){r._removeInitialEventListener(),r._handleInitialEvent(i),r._removeInitialEventListener=ze("mousedown",r._handleInitialEvent)}),n=ze("touchstart",function(i){r._removeInitialEventListener(),r._removeInitialEventListener=r._addLongPressListener(r._handleInitialEvent,i)});this._removeInitialEventListener=function(){s(),n()}}},{key:"_dropFromOutsideListener",value:function(r){var s=Mr(r),n=s.pageX,i=s.pageY,o=s.clientX,l=s.clientY;this.emit("dropFromOutside",{x:n,y:i,clientX:o,clientY:l}),r.preventDefault()}},{key:"_dragOverFromOutsideListener",value:function(r){var s=Mr(r),n=s.pageX,i=s.pageY,o=s.clientX,l=s.clientY;this.emit("dragOverFromOutside",{x:n,y:i,clientX:o,clientY:l}),r.preventDefault()}},{key:"_handleInitialEvent",value:function(r){if(this._initialEvent=r,!this.isDetached){var s=Mr(r),n=s.clientX,i=s.clientY,o=s.pageX,l=s.pageY,c=this.container(),d,u;if(!(r.which===3||r.button===2||!Ak(c,n,i))){if(!this.globalMouse&&c&&!Qr(c,r.target)){var m=_k(0),f=m.top,p=m.left,v=m.bottom,g=m.right;if(u=Xt(c),d=Fo({top:u.top-f,left:u.left-p,bottom:u.bottom+v,right:u.right+g},{top:l,left:o}),!d)return}var y=this.emit("beforeSelect",this._initialEventData={isTouch:/^touch/.test(r.type),x:o,y:l,clientX:n,clientY:i});if(y!==!1)switch(r.type){case"mousedown":this._removeEndListener=ze("mouseup",this._handleTerminatingEvent),this._onEscListener=ze("keydown",this._handleTerminatingEvent),this._removeMoveListener=ze("mousemove",this._handleMoveEvent);break;case"touchstart":this._handleMoveEvent(r),this._removeEndListener=ze("touchend",this._handleTerminatingEvent),this._removeMoveListener=ze("touchmove",this._handleMoveEvent);break}}}}},{key:"_isWithinValidContainer",value:function(r){var s=r.target,n=this.validContainers;return!n||!n.length||!s?!0:n.some(function(i){return!!s.closest(i)})}},{key:"_handleTerminatingEvent",value:function(r){var s=this.selecting,n=this._selectRect;if(!s&&r.type.includes("key")&&(r=this._initialEvent),this.selecting=!1,this._removeEndListener&&this._removeEndListener(),this._removeMoveListener&&this._removeMoveListener(),this._selectRect=null,this._initialEvent=null,this._initialEventData=null,!!r){var i=!this.container||Qr(this.container(),r.target),o=this._isWithinValidContainer(r);return r.key==="Escape"||!o?this.emit("reset"):!s&&i?this._handleClickEvent(r):s?this.emit("select",n):this.emit("reset")}}},{key:"_handleClickEvent",value:function(r){var s=Mr(r),n=s.pageX,i=s.pageY,o=s.clientX,l=s.clientY,c=new Date().getTime();return this._lastClickData&&c-this._lastClickData.timestamp<Rk?(this._lastClickData=null,this.emit("doubleClick",{x:n,y:i,clientX:o,clientY:l})):(this._lastClickData={timestamp:c},this.emit("click",{x:n,y:i,clientX:o,clientY:l}))}},{key:"_handleMoveEvent",value:function(r){if(!(this._initialEventData===null||this.isDetached)){var s=this._initialEventData,n=s.x,i=s.y,o=Mr(r),l=o.pageX,c=o.pageY,d=Math.abs(n-l),u=Math.abs(i-c),m=Math.min(l,n),f=Math.min(c,i),p=this.selecting,v=this.isClick(l,c);v&&!p&&!(d||u)||(!p&&!v&&this.emit("selectStart",this._initialEventData),v||(this.selecting=!0,this._selectRect={top:f,left:m,x:l,y:c,right:m+d,bottom:f+u},this.emit("selecting",this._selectRect)),r.preventDefault())}}},{key:"_keyListener",value:function(r){this.ctrl=r.metaKey||r.ctrlKey}},{key:"isClick",value:function(r,s){var n=this._initialEventData,i=n.x,o=n.y,l=n.isTouch;return!l&&Math.abs(r-i)<=Io&&Math.abs(s-o)<=Io}}])}();function _k(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return bt(e)!=="object"&&(e={top:e,left:e,right:e,bottom:e}),e}function Fo(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=Xt(e),n=s.top,i=s.left,o=s.right,l=o===void 0?i:o,c=s.bottom,d=c===void 0?n:c,u=Xt(t),m=u.top,f=u.left,p=u.right,v=p===void 0?f:p,g=u.bottom,y=g===void 0?m:g;return!(d-r<m||n+r>y||l-r<f||i+r>v)}function Xt(e){if(!e.getBoundingClientRect)return e;var t=e.getBoundingClientRect(),r=t.left+Wo("left"),s=t.top+Wo("top");return{top:s,left:r,right:(e.offsetWidth||0)+r,bottom:(e.offsetHeight||0)+s}}function Wo(e){if(e==="left")return window.pageXOffset||document.body.scrollLeft||0;if(e==="top")return window.pageYOffset||document.body.scrollTop||0}var Lk=function(e){function t(r,s){var n;return _e(this,t),n=Be(this,t,[r,s]),n.state={selecting:!1},n.containerRef=x.createRef(),n}return Ge(t,e),Le(t,[{key:"componentDidMount",value:function(){this.props.selectable&&this._selectable()}},{key:"componentWillUnmount",value:function(){this._teardownSelectable()}},{key:"componentDidUpdate",value:function(s){!s.selectable&&this.props.selectable&&this._selectable(),s.selectable&&!this.props.selectable&&this._teardownSelectable()}},{key:"render",value:function(){var s=this.props,n=s.range,i=s.getNow,o=s.getters,l=s.date,c=s.components.dateCellWrapper,d=s.localizer,u=this.state,m=u.selecting,f=u.startIdx,p=u.endIdx,v=i();return E.createElement("div",{className:"rbc-row-bg",ref:this.containerRef},n.map(function(g,y){var w=m&&y>=f&&y<=p,j=o.dayProp(g),k=j.className,S=j.style;return E.createElement(c,{key:y,value:g,range:n},E.createElement("div",{style:S,className:Me("rbc-day-bg",k,w&&"rbc-selected-cell",d.isSameDate(g,v)&&"rbc-today",l&&d.neq(l,g,"month")&&"rbc-off-range-bg")}))}))}},{key:"_selectable",value:function(){var s=this,n=this.containerRef.current,i=this._selector=new Wc(this.props.container,{longPressThreshold:this.props.longPressThreshold}),o=function(c,d){if(!Ga(n,c)&&!Ok(n,c)){var u=Xt(n),m=s.props,f=m.range,p=m.rtl;if(kk(u,c)){var v=Ic(u,c.x,p,f.length);s._selectSlot({startIdx:v,endIdx:v,action:d,box:c})}}s._initial={},s.setState({selecting:!1})};i.on("selecting",function(l){var c=s.props,d=c.range,u=c.rtl,m=-1,f=-1;if(s.state.selecting||(De(s.props.onSelectStart,[l]),s._initial={x:l.x,y:l.y}),i.isSelected(n)){var p=Xt(n),v=Ck(s._initial,p,l,d.length,u);m=v.startIdx,f=v.endIdx}s.setState({selecting:!0,startIdx:m,endIdx:f})}),i.on("beforeSelect",function(l){if(s.props.selectable==="ignoreEvents")return!Ga(s.containerRef.current,l)}),i.on("click",function(l){return o(l,"click")}),i.on("doubleClick",function(l){return o(l,"doubleClick")}),i.on("select",function(l){s._selectSlot(Ne(Ne({},s.state),{},{action:"select",bounds:l})),s._initial={},s.setState({selecting:!1}),De(s.props.onSelectEnd,[s.state])})}},{key:"_teardownSelectable",value:function(){this._selector&&(this._selector.teardown(),this._selector=null)}},{key:"_selectSlot",value:function(s){var n=s.endIdx,i=s.startIdx,o=s.action,l=s.bounds,c=s.box;n!==-1&&i!==-1&&this.props.onSelectSlot&&this.props.onSelectSlot({start:i,end:n,action:o,bounds:l,box:c,resourceId:this.props.resourceId})}}])}(E.Component),et={propTypes:{slotMetrics:K.object.isRequired,selected:K.object,isAllDay:K.bool,accessors:K.object.isRequired,localizer:K.object.isRequired,components:K.object.isRequired,getters:K.object.isRequired,onSelect:K.func,onDoubleClick:K.func,onKeyPress:K.func},defaultProps:{segments:[],selected:{}},renderEvent:function(t,r){var s=t.selected;t.isAllDay;var n=t.accessors,i=t.getters,o=t.onSelect,l=t.onDoubleClick,c=t.onKeyPress,d=t.localizer,u=t.slotMetrics,m=t.components,f=t.resizable,p=u.continuesPrior(r),v=u.continuesAfter(r);return E.createElement(_c,{event:r,getters:i,localizer:d,accessors:n,components:m,onSelect:o,onDoubleClick:l,onKeyPress:c,continuesPrior:p,continuesAfter:v,slotStart:u.first,slotEnd:u.last,selected:hs(r,s),resizable:f})},renderSpan:function(t,r,s){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:" ",i=Math.abs(r)/t*100+"%";return E.createElement("div",{key:s,className:"rbc-row-segment",style:{WebkitFlexBasis:i,flexBasis:i,maxWidth:i}},n)}},Hc=function(e){function t(){return _e(this,t),Be(this,t,arguments)}return Ge(t,e),Le(t,[{key:"render",value:function(){var s=this,n=this.props,i=n.segments,o=n.slotMetrics.slots,l=n.className,c=1;return E.createElement("div",{className:Me(l,"rbc-row")},i.reduce(function(d,u,m){var f=u.event,p=u.left,v=u.right,g=u.span,y="_lvl_"+m,w=p-c,j=et.renderEvent(s.props,f);return w&&d.push(et.renderSpan(o,w,"".concat(y,"_gap"))),d.push(et.renderSpan(o,g,y,j)),c=v+1,d},[]))}}])}(E.Component);Hc.defaultProps=Ne({},et.defaultProps);function Uc(e){var t=e.dateRange,r=e.unit,s=r===void 0?"day":r,n=e.localizer;return{first:t[0],last:n.add(t[t.length-1],1,s)}}function Ik(e,t,r,s){var n=Uc({dateRange:t,localizer:s}),i=n.first,o=n.last,l=s.diff(i,o,"day"),c=s.max(s.startOf(r.start(e),"day"),i),d=s.min(s.ceil(r.end(e),"day"),o),u=Uw(t,function(f){return s.isSameDate(f,c)}),m=s.diff(c,d,"day");return m=Math.min(m,l),m=Math.max(m-s.segmentOffset,1),{event:e,span:m,left:u+1,right:Math.max(u+m,1)}}function rn(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1/0,r,s,n,i=[],o=[];for(r=0;r<e.length;r++){for(n=e[r],s=0;s<i.length&&Fk(n,i[s]);s++);s>=t?o.push(n):(i[s]||(i[s]=[])).push(n)}for(r=0;r<i.length;r++)i[r].sort(function(l,c){return l.left-c.left});return{levels:i,extra:o}}function ta(e,t,r,s,n){var i={start:s.start(e),end:s.end(e)},o={start:t,end:r};return n.inEventRange({event:i,range:o})}function Fk(e,t){return t.some(function(r){return r.left<=e.right&&r.right>=e.left})}function Wk(e,t,r){var s=ka(e),n=[],i=[];s.forEach(function(c){var d=t.start(c),u=t.end(c);r.daySpan(d,u)>1?n.push(c):i.push(c)});var o=n.sort(function(c,d){return an(c,d,t,r)}),l=i.sort(function(c,d){return an(c,d,t,r)});return[].concat(ka(o),ka(l))}function an(e,t,r,s){var n={start:r.start(e),end:r.end(e),allDay:r.allDay(e)},i={start:r.start(t),end:r.end(t),allDay:r.allDay(t)};return s.sortEvents({evtA:n,evtB:i})}var sn=function(t,r){return t.left<=r&&t.right>=r},Ms=function(t,r){return t.filter(function(s){return sn(s,r)}).map(function(s){return s.event})},zc=function(e){function t(){return _e(this,t),Be(this,t,arguments)}return Ge(t,e),Le(t,[{key:"render",value:function(){for(var s=this.props,n=s.segments,i=s.slotMetrics.slots,o=rn(n).levels[0],l=1,c=1,d=[];l<=i;){var u="_lvl_"+l,m=o.filter(function(S){return sn(S,l)})[0]||{},f=m.event,p=m.left,v=m.right,g=m.span;if(!f){var y=this.getHiddenEventsForSlot(n,l);if(y.length>0){var w=l-c;w&&d.push(et.renderSpan(i,w,u+"_gap")),d.push(et.renderSpan(i,1,u,this.renderShowMore(n,l))),c=l=l+1;continue}l++;continue}var j=Math.max(0,p-c);if(this.canRenderSlotEvent(p,g)){var k=et.renderEvent(this.props,f);j&&d.push(et.renderSpan(i,j,u+"_gap")),d.push(et.renderSpan(i,g,u,k)),c=l=v+1}else j&&d.push(et.renderSpan(i,j,u+"_gap")),d.push(et.renderSpan(i,1,u,this.renderShowMore(n,l))),c=l=l+1}return E.createElement("div",{className:"rbc-row"},d)}},{key:"getHiddenEventsForSlot",value:function(s,n){var i=Ms(s,n),o=rn(s).levels[0],l=o.filter(function(c){return sn(c,n)}).map(function(c){return c.event});return i.filter(function(c){return!l.some(function(d){return d===c})})}},{key:"canRenderSlotEvent",value:function(s,n){var i=this.props.segments;return ej(s,s+n).every(function(o){var l=Ms(i,o).length;return l===1})}},{key:"renderShowMore",value:function(s,n){var i=this,o=this.props,l=o.localizer,c=o.slotMetrics,d=o.components,u=c.getEventsForSlot(n),m=Ms(s,n),f=m.length;if(d!=null&&d.showMore){var p=d.showMore,v=c.getDateForSlot(n-1);return f?E.createElement(p,{localizer:l,slotDate:v,slot:n,count:f,events:u,remainingEvents:m}):!1}return f?E.createElement("button",{type:"button",key:"sm_"+n,className:Me("rbc-button-link","rbc-show-more"),onClick:function(y){return i.showMore(n,y)}},l.messages.showMore(f,m,u)):!1}},{key:"showMore",value:function(s,n){n.preventDefault(),n.stopPropagation(),this.props.onShowMore(s,n.target)}}])}(E.Component);zc.defaultProps=Ne({},et.defaultProps);var Hk=function(t){var r=t.children;return E.createElement("div",{className:"rbc-row-content-scroll-container"},r)},Uk=function(t,r){return t.left<=r&&t.right>=r},zk=function(t,r){return t[0].range===r[0].range&&t[0].events===r[0].events};function Bc(){return gc(function(e){for(var t=e.range,r=e.events,s=e.maxRows,n=e.minRows,i=e.accessors,o=e.localizer,l=Uc({dateRange:t,localizer:o}),c=l.first,d=l.last,u=r.map(function(g){return Ik(g,t,i,o)}),m=rn(u,Math.max(s-1,1)),f=m.levels,p=m.extra,v=p.length>0?n-1:n;f.length<v;)f.push([]);return{first:c,last:d,levels:f,extra:p,range:t,slots:t.length,clone:function(y){var w=Bc();return w(Ne(Ne({},e),y))},getDateForSlot:function(y){return t[y]},getSlotForDate:function(y){return t.find(function(w){return o.isSameDate(w,y)})},getEventsForSlot:function(y){return u.filter(function(w){return Uk(w,y)}).map(function(w){return w.event})},continuesPrior:function(y){return o.continuesPrior(i.start(y),c)},continuesAfter:function(y){var w=i.start(y),j=i.end(y);return o.continuesAfter(w,j,d)}}},zk)}var ra=function(e){function t(){var r;_e(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return r=Be(this,t,[].concat(n)),r.handleSelectSlot=function(o){var l=r.props,c=l.range,d=l.onSelectSlot;d(c.slice(o.start,o.end+1),o)},r.handleShowMore=function(o,l){var c=r.props,d=c.range,u=c.onShowMore,m=r.slotMetrics(r.props),f=Bh(r.containerRef.current,".rbc-row-bg")[0],p;f&&(p=f.children[o-1]);var v=m.getEventsForSlot(o);u(v,d[o-1],p,o,l)},r.getContainer=function(){var o=r.props.container;return o?o():r.containerRef.current},r.renderHeadingCell=function(o,l){var c=r.props,d=c.renderHeader,u=c.getNow,m=c.localizer;return d({date:o,key:"header_".concat(l),className:Me("rbc-date-cell",m.isSameDate(o,u())&&"rbc-now")})},r.renderDummy=function(){var o=r.props,l=o.className,c=o.range,d=o.renderHeader,u=o.showAllEvents;return E.createElement("div",{className:l,ref:r.containerRef},E.createElement("div",{className:Me("rbc-row-content",u&&"rbc-row-content-scrollable")},d&&E.createElement("div",{className:"rbc-row",ref:r.headingRowRef},c.map(r.renderHeadingCell)),E.createElement("div",{className:"rbc-row",ref:r.eventRowRef},E.createElement("div",{className:"rbc-row-segment"},E.createElement("div",{className:"rbc-event"},E.createElement("div",{className:"rbc-event-content"}," "))))))},r.containerRef=x.createRef(),r.headingRowRef=x.createRef(),r.eventRowRef=x.createRef(),r.slotMetrics=Bc(),r}return Ge(t,e),Le(t,[{key:"getRowLimit",value:function(){var s,n=Ds(this.eventRowRef.current),i=(s=this.headingRowRef)!==null&&s!==void 0&&s.current?Ds(this.headingRowRef.current):0,o=Ds(this.containerRef.current)-i;return Math.max(Math.floor(o/n),1)}},{key:"render",value:function(){var s=this.props,n=s.date,i=s.rtl,o=s.range,l=s.className,c=s.selected,d=s.selectable,u=s.renderForMeasure,m=s.accessors,f=s.getters,p=s.components,v=s.getNow,g=s.renderHeader,y=s.onSelect,w=s.localizer,j=s.onSelectStart,k=s.onSelectEnd,S=s.onDoubleClick,T=s.onKeyPress,b=s.resourceId,$=s.longPressThreshold,A=s.isAllDay,R=s.resizable,I=s.showAllEvents;if(u)return this.renderDummy();var z=this.slotMetrics(this.props),Y=z.levels,B=z.extra,N=I?Hk:ut,G=p.weekWrapper,te={selected:c,accessors:m,getters:f,localizer:w,components:p,onSelect:y,onDoubleClick:S,onKeyPress:T,resourceId:b,slotMetrics:z,resizable:R};return E.createElement("div",{className:l,role:"rowgroup",ref:this.containerRef},E.createElement(Lk,{localizer:w,date:n,getNow:v,rtl:i,range:o,selectable:d,container:this.getContainer,getters:f,onSelectStart:j,onSelectEnd:k,onSelectSlot:this.handleSelectSlot,components:p,longPressThreshold:$,resourceId:b}),E.createElement("div",{className:Me("rbc-row-content",I&&"rbc-row-content-scrollable"),role:"row"},g&&E.createElement("div",{className:"rbc-row ",ref:this.headingRowRef},o.map(this.renderHeadingCell)),E.createElement(N,null,E.createElement(G,Object.assign({isAllDay:A},te,{rtl:this.props.rtl}),Y.map(function(X,W){return E.createElement(Hc,Object.assign({key:W,segments:X},te))}),!!B.length&&E.createElement(zc,Object.assign({segments:B,onShowMore:this.handleShowMore},te))))))}}])}(E.Component);ra.defaultProps={minRows:0,maxRows:1/0};var Vn=function(t){var r=t.label;return E.createElement("span",{role:"columnheader","aria-sort":"none"},r)},Bk=function(t){var r=t.label,s=t.drilldownView,n=t.onDrillDown;return s?E.createElement("button",{type:"button",className:"rbc-button-link",onClick:n},r):E.createElement("span",null,r)},Gk=["date","className"],qk=function(t,r,s,n,i){return t.filter(function(o){return ta(o,r,s,n,i)})},fs=function(e){function t(){var r;_e(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return r=Be(this,t,[].concat(n)),r.getContainer=function(){return r.containerRef.current},r.renderWeek=function(o,l){var c=r.props,d=c.events,u=c.components,m=c.selectable,f=c.getNow,p=c.selected,v=c.date,g=c.localizer,y=c.longPressThreshold,w=c.accessors,j=c.getters,k=c.showAllEvents,S=r.state,T=S.needLimitMeasure,b=S.rowLimit,$=qk(ka(d),o[0],o[o.length-1],w,g),A=Wk($,w,g);return E.createElement(ra,{key:l,ref:l===0?r.slotRowRef:void 0,container:r.getContainer,className:"rbc-month-row",getNow:f,date:v,range:o,events:A,maxRows:k?1/0:b,selected:p,selectable:m,components:u,accessors:w,getters:j,localizer:g,renderHeader:r.readerDateHeading,renderForMeasure:T,onShowMore:r.handleShowMore,onSelect:r.handleSelectEvent,onDoubleClick:r.handleDoubleClickEvent,onKeyPress:r.handleKeyPressEvent,onSelectSlot:r.handleSelectSlot,longPressThreshold:y,rtl:r.props.rtl,resizable:r.props.resizable,showAllEvents:k})},r.readerDateHeading=function(o){var l=o.date,c=o.className,d=pt(o,Gk),u=r.props,m=u.date,f=u.getDrilldownView,p=u.localizer,v=p.neq(m,l,"month"),g=p.isSameDate(l,m),y=f(l),w=p.format(l,"dateFormat"),j=r.props.components.dateHeader||Bk;return E.createElement("div",Object.assign({},d,{className:Me(c,v&&"rbc-off-range",g&&"rbc-current"),role:"cell"}),E.createElement(j,{label:w,date:l,drilldownView:y,isOffRange:v,onDrillDown:function(S){return r.handleHeadingClick(l,y,S)}}))},r.handleSelectSlot=function(o,l){r._pendingSelection=r._pendingSelection.concat(o),clearTimeout(r._selectTimer),r._selectTimer=setTimeout(function(){return r.selectDates(l)})},r.handleHeadingClick=function(o,l,c){c.preventDefault(),r.clearSelection(),De(r.props.onDrillDown,[o,l])},r.handleSelectEvent=function(){r.clearSelection();for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];De(r.props.onSelectEvent,l)},r.handleDoubleClickEvent=function(){r.clearSelection();for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];De(r.props.onDoubleClickEvent,l)},r.handleKeyPressEvent=function(){r.clearSelection();for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];De(r.props.onKeyPressEvent,l)},r.handleShowMore=function(o,l,c,d,u){var m=r.props,f=m.popup,p=m.onDrillDown,v=m.onShowMore,g=m.getDrilldownView,y=m.doShowMoreDrillDown;if(r.clearSelection(),f){var w=Bl(c,r.containerRef.current);r.setState({overlay:{date:l,events:o,position:w,target:u}})}else y&&De(p,[l,g(l)||Ye.DAY]);De(v,[o,l,d])},r.overlayDisplay=function(){r.setState({overlay:null})},r.state={rowLimit:5,needLimitMeasure:!0,date:null},r.containerRef=x.createRef(),r.slotRowRef=x.createRef(),r._bgRows=[],r._pendingSelection=[],r}return Ge(t,e),Le(t,[{key:"componentDidMount",value:function(){var s=this,n;this.state.needLimitMeasure&&this.measureRowLimit(this.props),window.addEventListener("resize",this._resizeListener=function(){n||Gl(function(){n=!1,s.setState({needLimitMeasure:!0})})},!1)}},{key:"componentDidUpdate",value:function(){this.state.needLimitMeasure&&this.measureRowLimit(this.props)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this._resizeListener,!1)}},{key:"render",value:function(){var s=this.props,n=s.date,i=s.localizer,o=s.className,l=i.visibleDays(n,i),c=$h(l,7);return this._weekCount=c.length,E.createElement("div",{className:Me("rbc-month-view",o),role:"table","aria-label":"Month View",ref:this.containerRef},E.createElement("div",{className:"rbc-row rbc-month-header",role:"row"},this.renderHeaders(c[0])),c.map(this.renderWeek),this.props.popup&&this.renderOverlay())}},{key:"renderHeaders",value:function(s){var n=this.props,i=n.localizer,o=n.components,l=s[0],c=s[s.length-1],d=o.header||Vn;return i.range(l,c,"day").map(function(u,m){return E.createElement("div",{key:"header_"+m,className:"rbc-header"},E.createElement(d,{date:u,localizer:i,label:i.format(u,"weekdayFormat")}))})}},{key:"renderOverlay",value:function(){var s,n,i=this,o=(s=(n=this.state)===null||n===void 0?void 0:n.overlay)!==null&&s!==void 0?s:{},l=this.props,c=l.accessors,d=l.localizer,u=l.components,m=l.getters,f=l.selected,p=l.popupOffset,v=l.handleDragStart,g=function(){return i.setState({overlay:null})};return E.createElement(Yn,{overlay:o,accessors:c,localizer:d,components:u,getters:m,selected:f,popupOffset:p,ref:this.containerRef,handleKeyPressEvent:this.handleKeyPressEvent,handleSelectEvent:this.handleSelectEvent,handleDoubleClickEvent:this.handleDoubleClickEvent,handleDragStart:v,show:!!o.position,overlayDisplay:this.overlayDisplay,onHide:g})}},{key:"measureRowLimit",value:function(){this.setState({needLimitMeasure:!1,rowLimit:this.slotRowRef.current.getRowLimit()})}},{key:"selectDates",value:function(s){var n=this._pendingSelection.slice();this._pendingSelection=[],n.sort(function(l,c){return+l-+c});var i=new Date(n[0]),o=new Date(n[n.length-1]);o.setDate(n[n.length-1].getDate()+1),De(this.props.onSelectSlot,{slots:n,start:i,end:o,action:s.action,bounds:s.bounds,box:s.box})}},{key:"clearSelection",value:function(){clearTimeout(this._selectTimer),this._pendingSelection=[]}}],[{key:"getDerivedStateFromProps",value:function(s,n){var i=s.date,o=s.localizer;return{date:i,needLimitMeasure:o.neq(i,n.date,"month")}}}])}(E.Component);fs.range=function(e,t){var r=t.localizer,s=r.firstVisibleDay(e,r),n=r.lastVisibleDay(e,r);return{start:s,end:n}};fs.navigate=function(e,t,r){var s=r.localizer;switch(t){case Je.PREVIOUS:return s.add(e,-1,"month");case Je.NEXT:return s.add(e,1,"month");default:return e}};fs.title=function(e,t){var r=t.localizer;return r.format(e,"monthHeaderFormat")};var Ho=function(t){var r=t.min,s=t.max,n=t.step,i=t.slots,o=t.localizer;return"".concat(+o.startOf(r,"minutes"))+"".concat(+o.startOf(s,"minutes"))+"".concat(n,"-").concat(i)};function Kn(e){for(var t=e.min,r=e.max,s=e.step,n=e.timeslots,i=e.localizer,o=Ho({step:s,localizer:i}),l=1+i.getTotalMin(t,r),c=i.getMinutesFromMidnight(t),d=Math.ceil((l-1)/(s*n)),u=d*n,m=new Array(d),f=new Array(u),p=0;p<d;p++){m[p]=new Array(n);for(var v=0;v<n;v++){var g=p*n+v,y=g*s;f[g]=m[p][v]=i.getSlotDate(t,c,y)}}var w=f.length*s;f.push(i.getSlotDate(t,c,w));function j(k){var S=i.diff(t,k,"minutes")+i.getDstOffset(t,k);return Math.min(S,l)}return{groups:m,update:function(S){return Ho(S)!==o?Kn(S):this},dateIsInGroup:function(S,T){var b=m[T+1];return i.inRange(S,m[T][0],b?b[0]:r,"minutes")},nextSlot:function(S){var T=f[Math.min(f.findIndex(function(b){return b===S||i.eq(b,S)})+1,f.length-1)];return i.eq(T,S)&&(T=i.add(S,s,"minutes")),T},closestSlotToPosition:function(S){var T=Math.min(f.length-1,Math.max(0,Math.floor(S*u)));return f[T]},closestSlotFromPoint:function(S,T){var b=Math.abs(T.top-T.bottom);return this.closestSlotToPosition((S.y-T.top)/b)},closestSlotFromDate:function(S){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(i.lt(S,t,"minutes"))return f[0];if(i.gt(S,r,"minutes"))return f[f.length-1];var b=i.diff(t,S,"minutes");return f[(b-b%s)/s+T]},startsBeforeDay:function(S){return i.lt(S,t,"day")},startsAfterDay:function(S){return i.gt(S,r,"day")},startsBefore:function(S){return i.lt(i.merge(t,S),t,"minutes")},startsAfter:function(S){return i.gt(i.merge(r,S),r,"minutes")},getRange:function(S,T,b,$){b||(S=i.min(r,i.max(t,S))),$||(T=i.min(r,i.max(t,T)));var A=j(S),R=j(T),I=R>s*u&&!i.eq(r,T)?(A-s)/(s*u)*100:A/(s*u)*100;return{top:I,height:R/(s*u)*100-I,start:j(S),startDate:S,end:j(T),endDate:T}},getCurrentTimePosition:function(S){var T=j(S),b=T/(s*u)*100;return b}}}var Yk=function(){function e(t,r){var s=r.accessors,n=r.slotMetrics;_e(this,e);var i=n.getRange(s.start(t),s.end(t)),o=i.start,l=i.startDate,c=i.end,d=i.endDate,u=i.top,m=i.height;this.start=o,this.end=c,this.startMs=+l,this.endMs=+d,this.top=u,this.height=m,this.data=t}return Le(e,[{key:"_width",get:function(){if(this.rows){var r=this.rows.reduce(function(n,i){return Math.max(n,i.leaves.length+1)},0)+1;return 100/r}if(this.leaves){var s=100-this.container._width;return s/(this.leaves.length+1)}return this.row._width}},{key:"width",get:function(){var r=this._width,s=Math.min(100,this._width*1.7);if(this.rows)return s;if(this.leaves)return this.leaves.length>0?s:r;var n=this.row.leaves,i=n.indexOf(this);return i===n.length-1?r:s}},{key:"xOffset",get:function(){if(this.rows)return 0;if(this.leaves)return this.container._width;var r=this.row,s=r.leaves,n=r.xOffset,i=r._width,o=s.indexOf(this)+1;return n+o*i}}])}();function Vk(e,t,r){return Math.abs(t.start-e.start)<r||t.start>e.start&&t.start<e.end}function Kk(e){for(var t=bN(e,["startMs",function(l){return-l.endMs}]),r=[];t.length>0;){var s=t.shift();r.push(s);for(var n=0;n<t.length;n++){var i=t[n];if(!(s.endMs>i.startMs)){if(n>0){var o=t.splice(n,1)[0];r.push(o)}break}}}return r}function Gc(e){for(var t=e.events,r=e.minimumStartDifference,s=e.slotMetrics,n=e.accessors,i=t.map(function(u){return new Yk(u,{slotMetrics:s,accessors:n})}),o=Kk(i),l=[],c=function(){var m=o[d],f=l.find(function(g){return g.end>m.start||Math.abs(m.start-g.start)<r});if(!f)return m.rows=[],l.push(m),1;m.container=f;for(var p=null,v=f.rows.length-1;!p&&v>=0;v--)Vk(f.rows[v],m,r)&&(p=f.rows[v]);p?(p.leaves.push(m),m.row=p):(m.leaves=[],f.rows.push(m))},d=0;d<o.length;d++)c();return o.map(function(u){return{event:u.data,style:{top:u.top,height:u.height,width:u.width,xOffset:Math.max(0,u.xOffset)}}})}function qc(e,t,r){for(var s=0;s<e.friends.length;++s)if(!(r.indexOf(e.friends[s])>-1)){t=t>e.friends[s].idx?t:e.friends[s].idx,r.push(e.friends[s]);var n=qc(e.friends[s],t,r);t=t>n?t:n}return t}function Xk(e){var t=e.events,r=e.minimumStartDifference,s=e.slotMetrics,n=e.accessors,i=Gc({events:t,minimumStartDifference:r,slotMetrics:s,accessors:n});i.sort(function(G,te){return G=G.style,te=te.style,G.top!==te.top?G.top>te.top?1:-1:G.height!==te.height?G.top+G.height<te.top+te.height?1:-1:0});for(var o=0;o<i.length;++o)i[o].friends=[],delete i[o].style.left,delete i[o].style.left,delete i[o].idx,delete i[o].size;for(var l=0;l<i.length-1;++l)for(var c=i[l],d=c.style.top,u=c.style.top+c.style.height,m=l+1;m<i.length;++m){var f=i[m],p=f.style.top,v=f.style.top+f.style.height;(p>=d&&v<=u||v>d&&v<=u||p>=d&&p<u)&&(c.friends.push(f),f.friends.push(c))}for(var g=0;g<i.length;++g){for(var y=i[g],w=[],j=0;j<100;++j)w.push(1);for(var k=0;k<y.friends.length;++k)y.friends[k].idx!==void 0&&(w[y.friends[k].idx]=0);y.idx=w.indexOf(1)}for(var S=0;S<i.length;++S){var T=0;if(!i[S].size){var b=[],$=qc(i[S],0,b);T=100/($+1),i[S].size=T;for(var A=0;A<b.length;++A)b[A].size=T}}for(var R=0;R<i.length;++R){var I=i[R];I.style.left=I.idx*I.size;for(var z=0,Y=0;Y<I.friends.length;++Y){var B=I.friends[Y].idx;z=z>B?z:B}z<=I.idx&&(I.size=100-I.idx*I.size);var N=I.idx===0?0:3;I.style.width="calc(".concat(I.size,"% - ").concat(N,"px)"),I.style.height="calc(".concat(I.style.height,"% - 2px)"),I.style.xOffset="calc(".concat(I.style.left,"% + ").concat(N,"px)")}return i}var Uo={overlap:Gc,"no-overlap":Xk};function Jk(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Qk(e){e.events,e.minimumStartDifference,e.slotMetrics,e.accessors;var t=e.dayLayoutAlgorithm,r=t;return t in Uo&&(r=Uo[t]),Jk(r)?r.apply(this,arguments):[]}var Yc=function(e){function t(){return _e(this,t),Be(this,t,arguments)}return Ge(t,e),Le(t,[{key:"render",value:function(){var s=this.props,n=s.renderSlot,i=s.resource,o=s.group,l=s.getters,c=s.components,d=c===void 0?{}:c,u=d.timeSlotWrapper,m=u===void 0?ut:u,f=l?l.slotGroupProp(o):{};return E.createElement("div",Object.assign({className:"rbc-timeslot-group"},f),o.map(function(p,v){var g=l?l.slotProp(p,i):{};return E.createElement(m,{key:v,value:p,resource:i},E.createElement("div",Object.assign({},g,{className:Me("rbc-time-slot",g.className)}),n&&n(p,v)))}))}}])}(x.Component);function ja(e){return typeof e=="string"?e:e+"%"}function Zk(e){var t=e.style,r=e.className,s=e.event,n=e.accessors,i=e.rtl,o=e.selected,l=e.label,c=e.continuesPrior,d=e.continuesAfter,u=e.getters,m=e.onClick,f=e.onDoubleClick,p=e.isBackgroundEvent,v=e.onKeyPress,g=e.components,y=g.event,w=g.eventWrapper,j=n.title(s),k=n.tooltip(s),S=n.end(s),T=n.start(s),b=u.eventProp(s,T,S,o),$=[E.createElement("div",{key:"1",className:"rbc-event-label"},l),E.createElement("div",{key:"2",className:"rbc-event-content"},y?E.createElement(y,{event:s,title:j}):j)],A=t.height,R=t.top,I=t.width,z=t.xOffset,Y=Ne(Ne({},b.style),{},Wt({top:ja(R),height:ja(A),width:ja(I)},i?"right":"left",ja(z)));return E.createElement(w,Object.assign({type:"time"},e),E.createElement("div",{role:"button",tabIndex:0,onClick:m,onDoubleClick:f,style:Y,onKeyDown:v,title:k?(typeof l=="string"?l+": ":"")+k:void 0,className:Me(p?"rbc-background-event":"rbc-event",r,b.className,{"rbc-selected":o,"rbc-event-continues-earlier":c,"rbc-event-continues-later":d})},$))}var eC=function(t){var r=t.children,s=t.className,n=t.style,i=t.innerRef;return E.createElement("div",{className:s,style:n,ref:i},r)},tC=E.forwardRef(function(e,t){return E.createElement(eC,Object.assign({},e,{innerRef:t}))}),rC=["dayProp"],aC=["eventContainerWrapper","timeIndicatorWrapper"],Vc=function(e){function t(){var r;_e(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return r=Be(this,t,[].concat(n)),r.state={selecting:!1,timeIndicatorPosition:null},r.intervalTriggered=!1,r.renderEvents=function(o){var l=o.events,c=o.isBackgroundEvent,d=r.props,u=d.rtl,m=d.selected,f=d.accessors,p=d.localizer,v=d.getters,g=d.components,y=d.step,w=d.timeslots,j=d.dayLayoutAlgorithm,k=d.resizable,S=r,T=S.slotMetrics,b=p.messages,$=Qk({events:l,accessors:f,slotMetrics:T,minimumStartDifference:Math.ceil(y*w/2),dayLayoutAlgorithm:j});return $.map(function(A,R){var I,z=A.event,Y=A.style,B=f.end(z),N=f.start(z),G=(I=f.eventId(z))!==null&&I!==void 0?I:"evt_"+R,te="eventTimeRangeFormat",X,W=T.startsBeforeDay(N),oe=T.startsAfterDay(B);W?te="eventTimeRangeEndFormat":oe&&(te="eventTimeRangeStartFormat"),W&&oe?X=b.allDay:X=p.format({start:N,end:B},te);var ce=W||T.startsBefore(N),se=oe||T.startsAfter(B);return E.createElement(Zk,{style:Y,event:z,label:X,key:G,getters:v,rtl:u,components:g,continuesPrior:ce,continuesAfter:se,accessors:f,resource:r.props.resource,selected:hs(z,m),onClick:function(ve){return r._select(Ne(Ne(Ne({},z),r.props.resource&&{sourceResource:r.props.resource}),c&&{isBackgroundEvent:!0}),ve)},onDoubleClick:function(ve){return r._doubleClick(z,ve)},isBackgroundEvent:c,onKeyPress:function(ve){return r._keyPress(z,ve)},resizable:k})})},r._selectable=function(){var o=r.containerRef.current,l=r.props,c=l.longPressThreshold,d=l.localizer,u=r._selector=new Wc(function(){return o},{longPressThreshold:c}),m=function(g){var y=r.props.onSelecting,w=r.state||{},j=f(g),k=j.startDate,S=j.endDate;y&&(d.eq(w.startDate,k,"minutes")&&d.eq(w.endDate,S,"minutes")||y({start:k,end:S,resourceId:r.props.resource})===!1)||(r.state.start!==j.start||r.state.end!==j.end||r.state.selecting!==j.selecting)&&r.setState(j)},f=function(g){var y=r.slotMetrics.closestSlotFromPoint(g,Xt(o));r.state.selecting||(r._initialSlot=y);var w=r._initialSlot;d.lte(w,y)?y=r.slotMetrics.nextSlot(y):d.gt(w,y)&&(w=r.slotMetrics.nextSlot(w));var j=r.slotMetrics.getRange(d.min(w,y),d.max(w,y));return Ne(Ne({},j),{},{selecting:!0,top:"".concat(j.top,"%"),height:"".concat(j.height,"%")})},p=function(g,y){if(!Ga(r.containerRef.current,g)){var w=f(g),j=w.startDate,k=w.endDate;r._selectSlot({startDate:j,endDate:k,action:y,box:g})}r.setState({selecting:!1})};u.on("selecting",m),u.on("selectStart",m),u.on("beforeSelect",function(v){if(r.props.selectable==="ignoreEvents")return!Ga(r.containerRef.current,v)}),u.on("click",function(v){return p(v,"click")}),u.on("doubleClick",function(v){return p(v,"doubleClick")}),u.on("select",function(v){r.state.selecting&&(r._selectSlot(Ne(Ne({},r.state),{},{action:"select",bounds:v})),r.setState({selecting:!1}))}),u.on("reset",function(){r.state.selecting&&r.setState({selecting:!1})})},r._teardownSelectable=function(){r._selector&&(r._selector.teardown(),r._selector=null)},r._selectSlot=function(o){for(var l=o.startDate,c=o.endDate,d=o.action,u=o.bounds,m=o.box,f=l,p=[];r.props.localizer.lte(f,c);)p.push(f),f=new Date(+f+r.props.step*60*1e3);De(r.props.onSelectSlot,{slots:p,start:l,end:c,resourceId:r.props.resource,action:d,bounds:u,box:m})},r._select=function(){for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];De(r.props.onSelectEvent,l)},r._doubleClick=function(){for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];De(r.props.onDoubleClickEvent,l)},r._keyPress=function(){for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];De(r.props.onKeyPressEvent,l)},r.slotMetrics=Kn(r.props),r.containerRef=x.createRef(),r}return Ge(t,e),Le(t,[{key:"componentDidMount",value:function(){this.props.selectable&&this._selectable(),this.props.isNow&&this.setTimeIndicatorPositionUpdateInterval()}},{key:"componentWillUnmount",value:function(){this._teardownSelectable(),this.clearTimeIndicatorInterval()}},{key:"componentDidUpdate",value:function(s,n){this.props.selectable&&!s.selectable&&this._selectable(),!this.props.selectable&&s.selectable&&this._teardownSelectable();var i=this.props,o=i.getNow,l=i.isNow,c=i.localizer,d=i.date,u=i.min,m=i.max,f=c.neq(s.getNow(),o(),"minutes");if(s.isNow!==l||f){if(this.clearTimeIndicatorInterval(),l){var p=!f&&c.eq(s.date,d,"minutes")&&n.timeIndicatorPosition===this.state.timeIndicatorPosition;this.setTimeIndicatorPositionUpdateInterval(p)}}else l&&(c.neq(s.min,u,"minutes")||c.neq(s.max,m,"minutes"))&&this.positionTimeIndicator()}},{key:"setTimeIndicatorPositionUpdateInterval",value:function(){var s=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;!this.intervalTriggered&&!n&&this.positionTimeIndicator(),this._timeIndicatorTimeout=window.setTimeout(function(){s.intervalTriggered=!0,s.positionTimeIndicator(),s.setTimeIndicatorPositionUpdateInterval()},6e4)}},{key:"clearTimeIndicatorInterval",value:function(){this.intervalTriggered=!1,window.clearTimeout(this._timeIndicatorTimeout)}},{key:"positionTimeIndicator",value:function(){var s=this.props,n=s.min,i=s.max,o=s.getNow,l=o();if(l>=n&&l<=i){var c=this.slotMetrics.getCurrentTimePosition(l);this.intervalTriggered=!0,this.setState({timeIndicatorPosition:c})}else this.clearTimeIndicatorInterval()}},{key:"render",value:function(){var s=this.props,n=s.date,i=s.max,o=s.rtl,l=s.isNow,c=s.resource,d=s.accessors,u=s.localizer,m=s.getters,f=m.dayProp,p=pt(m,rC),v=s.components,g=v.eventContainerWrapper,y=v.timeIndicatorWrapper,w=pt(v,aC);this.slotMetrics=this.slotMetrics.update(this.props);var j=this.slotMetrics,k=this.state,S=k.selecting,T=k.top,b=k.height,$=k.startDate,A=k.endDate,R={start:$,end:A},I=f(i,c),z=I.className,Y=I.style,B={className:"rbc-current-time-indicator",style:{top:"".concat(this.state.timeIndicatorPosition,"%")}},N=w.dayColumnWrapper||tC;return E.createElement(N,{ref:this.containerRef,date:n,style:Y,className:Me(z,"rbc-day-slot","rbc-time-column",l&&"rbc-now",l&&"rbc-today",S&&"rbc-slot-selecting"),slotMetrics:j,resource:c},j.groups.map(function(G,te){return E.createElement(Yc,{key:te,group:G,resource:c,getters:p,components:w})}),E.createElement(g,{localizer:u,resource:c,accessors:d,getters:p,components:w,slotMetrics:j},E.createElement("div",{className:Me("rbc-events-container",o&&"rtl")},this.renderEvents({events:this.props.backgroundEvents,isBackgroundEvent:!0}),this.renderEvents({events:this.props.events}))),S&&E.createElement("div",{className:"rbc-slot-selection",style:{top:T,height:b}},E.createElement("span",null,u.format(R,"selectRangeFormat"))),l&&this.intervalTriggered&&E.createElement(y,B,E.createElement("div",B)))}}])}(E.Component);Vc.defaultProps={dragThroughEvents:!0,timeslots:2};var Kc=function(t){var r=t.label;return E.createElement(E.Fragment,null,r)},sC=function(e){function t(){var r;_e(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return r=Be(this,t,[].concat(n)),r.handleHeaderClick=function(o,l,c){c.preventDefault(),De(r.props.onDrillDown,[o,l])},r.renderRow=function(o){var l=r.props,c=l.events,d=l.rtl,u=l.selectable,m=l.getNow,f=l.range,p=l.getters,v=l.localizer,g=l.accessors,y=l.components,w=l.resizable,j=g.resourceId(o),k=o?c.filter(function(S){return g.resource(S)===j}):c;return E.createElement(ra,{isAllDay:!0,rtl:d,getNow:m,minRows:2,maxRows:r.props.allDayMaxRows+1,range:f,events:k,resourceId:j,className:"rbc-allday-cell",selectable:u,selected:r.props.selected,components:y,accessors:g,getters:p,localizer:v,onSelect:r.props.onSelectEvent,onShowMore:r.props.onShowMore,onDoubleClick:r.props.onDoubleClickEvent,onKeyPress:r.props.onKeyPressEvent,onSelectSlot:r.props.onSelectSlot,longPressThreshold:r.props.longPressThreshold,resizable:w})},r}return Ge(t,e),Le(t,[{key:"renderHeaderCells",value:function(s){var n=this,i=this.props,o=i.localizer,l=i.getDrilldownView,c=i.getNow,d=i.getters.dayProp,u=i.components.header,m=u===void 0?Vn:u,f=c();return s.map(function(p,v){var g=l(p),y=o.format(p,"dayFormat"),w=d(p),j=w.className,k=w.style,S=E.createElement(m,{date:p,label:y,localizer:o});return E.createElement("div",{key:v,style:k,className:Me("rbc-header",j,o.isSameDate(p,f)&&"rbc-today")},g?E.createElement("button",{type:"button",className:"rbc-button-link",onClick:function(b){return n.handleHeaderClick(p,g,b)}},S):E.createElement("span",null,S))})}},{key:"render",value:function(){var s=this,n=this.props,i=n.width,o=n.rtl,l=n.resources,c=n.range,d=n.events,u=n.getNow,m=n.accessors,f=n.selectable,p=n.components,v=n.getters,g=n.scrollRef,y=n.localizer,w=n.isOverflowing,j=n.components,k=j.timeGutterHeader,S=j.resourceHeader,T=S===void 0?Kc:S,b=n.resizable,$={};w&&($[o?"marginLeft":"marginRight"]="".concat(Cn()-1,"px"));var A=l.groupEvents(d);return E.createElement("div",{style:$,ref:g,className:Me("rbc-time-header",w&&"rbc-overflowing")},E.createElement("div",{className:"rbc-label rbc-time-header-gutter",style:{width:i,minWidth:i,maxWidth:i}},k&&E.createElement(k,null)),l.map(function(R,I){var z=zt(R,2),Y=z[0],B=z[1];return E.createElement("div",{className:"rbc-time-header-content",key:Y||I},B&&E.createElement("div",{className:"rbc-row rbc-row-resource",key:"resource_".concat(I)},E.createElement("div",{className:"rbc-header"},E.createElement(T,{index:I,label:m.resourceTitle(B),resource:B}))),E.createElement("div",{className:"rbc-row rbc-time-header-cell".concat(c.length<=1?" rbc-time-header-cell-single-day":"")},s.renderHeaderCells(c)),E.createElement(ra,{isAllDay:!0,rtl:o,getNow:u,minRows:2,maxRows:s.props.allDayMaxRows+1,range:c,events:A.get(Y)||[],resourceId:B&&Y,className:"rbc-allday-cell",selectable:f,selected:s.props.selected,components:p,accessors:m,getters:v,localizer:y,onSelect:s.props.onSelectEvent,onShowMore:s.props.onShowMore,onDoubleClick:s.props.onDoubleClickEvent,onKeyDown:s.props.onKeyPressEvent,onSelectSlot:s.props.onSelectSlot,longPressThreshold:s.props.longPressThreshold,resizable:b}))}))}}])}(E.Component),nC=function(e){function t(){var r;_e(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return r=Be(this,t,[].concat(n)),r.handleHeaderClick=function(o,l,c){c.preventDefault(),De(r.props.onDrillDown,[o,l])},r}return Ge(t,e),Le(t,[{key:"renderHeaderCells",value:function(s){var n=this,i=this.props,o=i.localizer,l=i.getDrilldownView,c=i.getNow,d=i.getters.dayProp,u=i.components,m=u.header,f=m===void 0?Vn:m,p=u.resourceHeader,v=p===void 0?Kc:p,g=i.resources,y=i.accessors,w=i.events,j=i.rtl,k=i.selectable,S=i.components,T=i.getters,b=i.resizable,$=c(),A=g.groupEvents(w);return s.map(function(R,I){var z=l(R),Y=o.format(R,"dayFormat"),B=d(R),N=B.className,G=B.style,te=E.createElement(f,{date:R,label:Y,localizer:o});return E.createElement("div",{key:I,className:"rbc-time-header-content rbc-resource-grouping"},E.createElement("div",{className:"rbc-row rbc-time-header-cell".concat(s.length<=1?" rbc-time-header-cell-single-day":"")},E.createElement("div",{style:G,className:Me("rbc-header",N,o.isSameDate(R,$)&&"rbc-today")},z?E.createElement("button",{type:"button",className:"rbc-button-link",onClick:function(W){return n.handleHeaderClick(R,z,W)}},te):E.createElement("span",null,te))),E.createElement("div",{className:"rbc-row"},g.map(function(X,W){var oe=zt(X,2),ce=oe[0],se=oe[1];return E.createElement("div",{key:"resource_".concat(ce,"_").concat(W),className:Me("rbc-header",N,o.isSameDate(R,$)&&"rbc-today")},E.createElement(v,{index:W,label:y.resourceTitle(se),resource:se}))})),E.createElement("div",{className:"rbc-row rbc-m-b-negative-3 rbc-h-full"},g.map(function(X,W){var oe=zt(X,2),ce=oe[0],se=oe[1],ge=(A.get(ce)||[]).filter(function(ve){return o.isSameDate(ve.start,R)||o.isSameDate(ve.end,R)});return E.createElement(ra,{key:"resource_".concat(ce,"_").concat(W),isAllDay:!0,rtl:j,getNow:c,minRows:2,maxRows:n.props.allDayMaxRows+1,range:[R],events:ge,resourceId:se&&ce,className:"rbc-allday-cell",selectable:k,selected:n.props.selected,components:S,accessors:y,getters:T,localizer:o,onSelect:n.props.onSelectEvent,onShowMore:n.props.onShowMore,onDoubleClick:n.props.onDoubleClickEvent,onKeyDown:n.props.onKeyPressEvent,onSelectSlot:n.props.onSelectSlot,longPressThreshold:n.props.longPressThreshold,resizable:b})})))})}},{key:"render",value:function(){var s=this.props,n=s.width,i=s.rtl,o=s.range,l=s.scrollRef,c=s.isOverflowing,d=s.components.timeGutterHeader,u={};return c&&(u[i?"marginLeft":"marginRight"]="".concat(Cn()-1,"px")),E.createElement("div",{style:u,ref:l,className:Me("rbc-time-header",c&&"rbc-overflowing")},E.createElement("div",{className:"rbc-label rbc-time-header-gutter",style:{width:n,minWidth:n,maxWidth:n}},d&&E.createElement(d,null)),this.renderHeaderCells(o))}}])}(E.Component);function iC(e){var t=e.min,r=e.max,s=e.localizer;return s.getTimezoneOffset(t)!==s.getTimezoneOffset(r)?{start:s.add(t,-1,"day"),end:s.add(r,-1,"day")}:{start:t,end:r}}var oC=function(t){var r=t.min,s=t.max,n=t.timeslots,i=t.step,o=t.localizer,l=t.getNow,c=t.resource,d=t.components,u=t.getters,m=t.gutterRef,f=d.timeGutterWrapper,p=x.useMemo(function(){return iC({min:r,max:s,localizer:o})},[r==null?void 0:r.toISOString(),s==null?void 0:s.toISOString(),o]),v=p.start,g=p.end,y=x.useState(Kn({min:v,max:g,timeslots:n,step:i,localizer:o})),w=zt(y,2),j=w[0],k=w[1];x.useEffect(function(){j&&k(j.update({min:v,max:g,timeslots:n,step:i,localizer:o}))},[v==null?void 0:v.toISOString(),g==null?void 0:g.toISOString(),n,i]);var S=x.useCallback(function(T,b){if(b)return null;var $=j.dateIsInGroup(l(),b);return E.createElement("span",{className:Me("rbc-label",$&&"rbc-now")},o.format(T,"timeGutterFormat"))},[j,o,l]);return E.createElement(f,{slotMetrics:j},E.createElement("div",{className:"rbc-time-gutter rbc-time-column",ref:m},j.groups.map(function(T,b){return E.createElement(Yc,{key:b,group:T,resource:c,components:d,renderSlot:S,getters:u})})))},lC=E.forwardRef(function(e,t){return E.createElement(oC,Object.assign({gutterRef:t},e))}),Ps={};function cC(e,t){return{map:function(s){return e?e.map(function(n,i){return s([t.resourceId(n),n],i)}):[s([Ps,null],0)]},groupEvents:function(s){var n=new Map;return e?(s.forEach(function(i){var o=t.resource(i)||Ps;if(Array.isArray(o))o.forEach(function(c){var d=n.get(c)||[];d.push(i),n.set(c,d)});else{var l=n.get(o)||[];l.push(i),n.set(o,l)}}),n):(n.set(Ps,s),n)}}}var Er=function(e){function t(r){var s;return _e(this,t),s=Be(this,t,[r]),s.handleScroll=function(n){s.scrollRef.current&&(s.scrollRef.current.scrollLeft=n.target.scrollLeft)},s.handleResize=function(){$i(s.rafHandle),s.rafHandle=Gl(s.checkOverflow)},s.handleKeyPressEvent=function(){s.clearSelection();for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];De(s.props.onKeyPressEvent,i)},s.handleSelectEvent=function(){s.clearSelection();for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];De(s.props.onSelectEvent,i)},s.handleDoubleClickEvent=function(){s.clearSelection();for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];De(s.props.onDoubleClickEvent,i)},s.handleShowMore=function(n,i,o,l,c){var d=s.props,u=d.popup,m=d.onDrillDown,f=d.onShowMore,p=d.getDrilldownView,v=d.doShowMoreDrillDown;if(s.clearSelection(),u){var g=Bl(o,s.containerRef.current);s.setState({overlay:{date:i,events:n,position:Ne(Ne({},g),{},{width:"200px"}),target:c}})}else v&&De(m,[i,p(i)||Ye.DAY]);De(f,[n,i,l])},s.handleSelectAllDaySlot=function(n,i){var o=s.props.onSelectSlot,l=new Date(n[0]),c=new Date(n[n.length-1]);c.setDate(n[n.length-1].getDate()+1),De(o,{slots:n,start:l,end:c,action:i.action,resourceId:i.resourceId})},s.overlayDisplay=function(){s.setState({overlay:null})},s.checkOverflow=function(){if(!s._updatingOverflow){var n=s.contentRef.current;if(n!=null&&n.scrollHeight){var i=n.scrollHeight>n.clientHeight;s.state.isOverflowing!==i&&(s._updatingOverflow=!0,s.setState({isOverflowing:i},function(){s._updatingOverflow=!1}))}}},s.memoizedResources=gc(function(n,i){return cC(n,i)}),s.state={gutterWidth:void 0,isOverflowing:null},s.scrollRef=E.createRef(),s.contentRef=E.createRef(),s.containerRef=E.createRef(),s._scrollRatio=null,s.gutterRef=x.createRef(),s}return Ge(t,e),Le(t,[{key:"getSnapshotBeforeUpdate",value:function(){return this.checkOverflow(),null}},{key:"componentDidMount",value:function(){this.props.width==null&&this.measureGutter(),this.calculateScroll(),this.applyScroll(),window.addEventListener("resize",this.handleResize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize),$i(this.rafHandle),this.measureGutterAnimationFrameRequest&&window.cancelAnimationFrame(this.measureGutterAnimationFrameRequest)}},{key:"componentDidUpdate",value:function(){this.applyScroll()}},{key:"renderDayColumn",value:function(s,n,i,o,l,c,d,u,m,f){var p=this.props,v=p.min,g=p.max,y=(o.get(n)||[]).filter(function(j){return c.inRange(s,d.start(j),d.end(j),"day")}),w=(l.get(n)||[]).filter(function(j){return c.inRange(s,d.start(j),d.end(j),"day")});return E.createElement(Vc,Object.assign({},this.props,{localizer:c,min:c.merge(s,v),max:c.merge(s,g),resource:i&&n,components:u,isNow:c.isSameDate(s,f),key:"".concat(n,"-").concat(s),date:s,events:y,backgroundEvents:w,dayLayoutAlgorithm:m}))}},{key:"renderResourcesFirst",value:function(s,n,i,o,l,c,d,u,m){var f=this;return n.map(function(p){var v=zt(p,2),g=v[0],y=v[1];return s.map(function(w){return f.renderDayColumn(w,g,y,i,o,l,c,u,m,d)})})}},{key:"renderRangeFirst",value:function(s,n,i,o,l,c,d,u,m){var f=this;return s.map(function(p){return E.createElement("div",{style:{display:"flex",minHeight:"100%",flex:1},key:p},n.map(function(v){var g=zt(v,2),y=g[0],w=g[1];return E.createElement("div",{style:{flex:1},key:c.resourceId(w)},f.renderDayColumn(p,y,w,i,o,l,c,u,m,d))}))})}},{key:"renderEvents",value:function(s,n,i,o){var l=this.props,c=l.accessors,d=l.localizer,u=l.resourceGroupingLayout,m=l.components,f=l.dayLayoutAlgorithm,p=this.memoizedResources(this.props.resources,c),v=p.groupEvents(n),g=p.groupEvents(i);return u?this.renderRangeFirst(s,p,v,g,d,c,o,m,f):this.renderResourcesFirst(s,p,v,g,d,c,o,m,f)}},{key:"render",value:function(){var s,n=this.props,i=n.events,o=n.backgroundEvents,l=n.range,c=n.width,d=n.rtl,u=n.selected,m=n.getNow,f=n.resources,p=n.components,v=n.accessors,g=n.getters,y=n.localizer,w=n.min,j=n.max,k=n.showMultiDayTimes,S=n.longPressThreshold,T=n.resizable,b=n.resourceGroupingLayout;c=c||this.state.gutterWidth;var $=l[0],A=l[l.length-1];this.slots=l.length;var R=[],I=[],z=[];i.forEach(function(B){if(ta(B,$,A,v,y)){var N=v.start(B),G=v.end(B);v.allDay(B)||y.startAndEndAreDateOnly(N,G)||!k&&!y.isSameDate(N,G)?R.push(B):I.push(B)}}),o.forEach(function(B){ta(B,$,A,v,y)&&z.push(B)}),R.sort(function(B,N){return an(B,N,v,y)});var Y={range:l,events:R,width:c,rtl:d,getNow:m,localizer:y,selected:u,allDayMaxRows:this.props.showAllEvents?1/0:(s=this.props.allDayMaxRows)!==null&&s!==void 0?s:1/0,resources:this.memoizedResources(f,v),selectable:this.props.selectable,accessors:v,getters:g,components:p,scrollRef:this.scrollRef,isOverflowing:this.state.isOverflowing,longPressThreshold:S,onSelectSlot:this.handleSelectAllDaySlot,onSelectEvent:this.handleSelectEvent,onShowMore:this.handleShowMore,onDoubleClickEvent:this.props.onDoubleClickEvent,onKeyPressEvent:this.props.onKeyPressEvent,onDrillDown:this.props.onDrillDown,getDrilldownView:this.props.getDrilldownView,resizable:T};return E.createElement("div",{className:Me("rbc-time-view",f&&"rbc-time-view-resources"),ref:this.containerRef},f&&f.length>1&&b?E.createElement(nC,Y):E.createElement(sC,Y),this.props.popup&&this.renderOverlay(),E.createElement("div",{ref:this.contentRef,className:"rbc-time-content",onScroll:this.handleScroll},E.createElement(lC,{date:$,ref:this.gutterRef,localizer:y,min:y.merge($,w),max:y.merge($,j),step:this.props.step,getNow:this.props.getNow,timeslots:this.props.timeslots,components:p,className:"rbc-time-gutter",getters:g}),this.renderEvents(l,I,z,m())))}},{key:"renderOverlay",value:function(){var s,n,i=this,o=(s=(n=this.state)===null||n===void 0?void 0:n.overlay)!==null&&s!==void 0?s:{},l=this.props,c=l.accessors,d=l.localizer,u=l.components,m=l.getters,f=l.selected,p=l.popupOffset,v=l.handleDragStart,g=function(){return i.setState({overlay:null})};return E.createElement(Yn,{overlay:o,accessors:c,localizer:d,components:u,getters:m,selected:f,popupOffset:p,ref:this.containerRef,handleKeyPressEvent:this.handleKeyPressEvent,handleSelectEvent:this.handleSelectEvent,handleDoubleClickEvent:this.handleDoubleClickEvent,handleDragStart:v,show:!!o.position,overlayDisplay:this.overlayDisplay,onHide:g})}},{key:"clearSelection",value:function(){clearTimeout(this._selectTimer),this._pendingSelection=[]}},{key:"measureGutter",value:function(){var s=this;this.measureGutterAnimationFrameRequest&&window.cancelAnimationFrame(this.measureGutterAnimationFrameRequest),this.measureGutterAnimationFrameRequest=window.requestAnimationFrame(function(){var n,i=(n=s.gutterRef)!==null&&n!==void 0&&n.current?en(s.gutterRef.current):void 0;i&&s.state.gutterWidth!==i&&s.setState({gutterWidth:i})})}},{key:"applyScroll",value:function(){if(this._scrollRatio!=null&&this.props.enableAutoScroll===!0){var s=this.contentRef.current;s.scrollTop=s.scrollHeight*this._scrollRatio,this._scrollRatio=null}}},{key:"calculateScroll",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.props,n=s.min,i=s.max,o=s.scrollToTime,l=s.localizer,c=l.diff(l.merge(o,n),o,"milliseconds"),d=l.diff(n,i,"milliseconds");this._scrollRatio=c/d}}])}(x.Component);Er.defaultProps={step:30,timeslots:2,resourceGroupingLayout:!1};var dC=["date","localizer","min","max","scrollToTime","enableAutoScroll"],ps=function(e){function t(){return _e(this,t),Be(this,t,arguments)}return Ge(t,e),Le(t,[{key:"render",value:function(){var s=this.props,n=s.date,i=s.localizer,o=s.min,l=o===void 0?i.startOf(new Date,"day"):o,c=s.max,d=c===void 0?i.endOf(new Date,"day"):c,u=s.scrollToTime,m=u===void 0?i.startOf(new Date,"day"):u,f=s.enableAutoScroll,p=f===void 0?!0:f,v=pt(s,dC),g=t.range(n,{localizer:i});return E.createElement(Er,Object.assign({},v,{range:g,eventOffset:10,localizer:i,min:l,max:d,scrollToTime:m,enableAutoScroll:p}))}}])}(E.Component);ps.range=function(e,t){var r=t.localizer;return[r.startOf(e,"day")]};ps.navigate=function(e,t,r){var s=r.localizer;switch(t){case Je.PREVIOUS:return s.add(e,-1,"day");case Je.NEXT:return s.add(e,1,"day");default:return e}};ps.title=function(e,t){var r=t.localizer;return r.format(e,"dayHeaderFormat")};var uC=["date","localizer","min","max","scrollToTime","enableAutoScroll"],$t=function(e){function t(){return _e(this,t),Be(this,t,arguments)}return Ge(t,e),Le(t,[{key:"render",value:function(){var s=this.props,n=s.date,i=s.localizer,o=s.min,l=o===void 0?i.startOf(new Date,"day"):o,c=s.max,d=c===void 0?i.endOf(new Date,"day"):c,u=s.scrollToTime,m=u===void 0?i.startOf(new Date,"day"):u,f=s.enableAutoScroll,p=f===void 0?!0:f,v=pt(s,uC),g=t.range(n,this.props);return E.createElement(Er,Object.assign({},v,{range:g,eventOffset:15,localizer:i,min:l,max:d,scrollToTime:m,enableAutoScroll:p}))}}])}(E.Component);$t.defaultProps=Er.defaultProps;$t.navigate=function(e,t,r){var s=r.localizer;switch(t){case Je.PREVIOUS:return s.add(e,-1,"week");case Je.NEXT:return s.add(e,1,"week");default:return e}};$t.range=function(e,t){var r=t.localizer,s=r.startOfWeek(),n=r.startOf(e,"week",s),i=r.endOf(e,"week",s);return r.range(n,i)};$t.title=function(e,t){var r=t.localizer,s=$t.range(e,{localizer:r}),n=Nc(s),i=n[0],o=n.slice(1);return r.format({start:i,end:o.pop()},"dayRangeHeaderFormat")};var mC=["date","localizer","min","max","scrollToTime","enableAutoScroll"];function Xn(e,t){return $t.range(e,t).filter(function(r){return[6,0].indexOf(r.getDay())===-1})}var fa=function(e){function t(){return _e(this,t),Be(this,t,arguments)}return Ge(t,e),Le(t,[{key:"render",value:function(){var s=this.props,n=s.date,i=s.localizer,o=s.min,l=o===void 0?i.startOf(new Date,"day"):o,c=s.max,d=c===void 0?i.endOf(new Date,"day"):c,u=s.scrollToTime,m=u===void 0?i.startOf(new Date,"day"):u,f=s.enableAutoScroll,p=f===void 0?!0:f,v=pt(s,mC),g=Xn(n,this.props);return E.createElement(Er,Object.assign({},v,{range:g,eventOffset:15,localizer:i,min:l,max:d,scrollToTime:m,enableAutoScroll:p}))}}])}(E.Component);fa.defaultProps=Er.defaultProps;fa.range=Xn;fa.navigate=$t.navigate;fa.title=function(e,t){var r=t.localizer,s=Xn(e,{localizer:r}),n=Nc(s),i=n[0],o=n.slice(1);return r.format({start:i,end:o.pop()},"dayRangeHeaderFormat")};var gs=30;function xs(e){var t=e.accessors,r=e.components,s=e.date,n=e.events,i=e.getters,o=e.length,l=o===void 0?gs:o,c=e.localizer,d=e.onDoubleClickEvent,u=e.onSelectEvent,m=e.selected,f=x.useRef(null),p=x.useRef(null),v=x.useRef(null),g=x.useRef(null),y=x.useRef(null);x.useEffect(function(){k()});var w=function(A,R,I){var z=r.event,Y=r.date;return R=R.filter(function(B){return ta(B,c.startOf(A,"day"),c.endOf(A,"day"),t,c)}),R.map(function(B,N){var G=t.title(B),te=t.end(B),X=t.start(B),W=i.eventProp(B,X,te,hs(B,m)),oe=N===0&&c.format(A,"agendaDateFormat"),ce=N===0?E.createElement("td",{rowSpan:R.length,className:"rbc-agenda-date-cell"},Y?E.createElement(Y,{day:A,label:oe}):oe):!1;return E.createElement("tr",{key:I+"_"+N,className:W.className,style:W.style},ce,E.createElement("td",{className:"rbc-agenda-time-cell"},j(A,B)),E.createElement("td",{className:"rbc-agenda-event-cell",onClick:function(ge){return u&&u(B,ge)},onDoubleClick:function(ge){return d&&d(B,ge)}},z?E.createElement(z,{event:B,title:G}):G))},[])},j=function(A,R){var I="",z=r.time,Y=c.messages.allDay,B=t.end(R),N=t.start(R);return t.allDay(R)||(c.eq(N,B)?Y=c.format(N,"agendaTimeFormat"):c.isSameDate(N,B)?Y=c.format({start:N,end:B},"agendaTimeRangeFormat"):c.isSameDate(A,N)?Y=c.format(N,"agendaTimeFormat"):c.isSameDate(A,B)&&(Y=c.format(B,"agendaTimeFormat"))),c.gt(A,N,"day")&&(I="rbc-continues-prior"),c.lt(A,B,"day")&&(I+=" rbc-continues-after"),E.createElement("span",{className:I.trim()},z?E.createElement(z,{event:R,day:A,label:Y}):Y)},k=function(){if(y.current){var A=f.current,R=y.current.firstChild;if(R){var I=g.current.scrollHeight>g.current.clientHeight,z=[],Y=z;z=[en(R.children[0]),en(R.children[1])],(Y[0]!==z[0]||Y[1]!==z[1])&&(p.current.style.width=z[0]+"px",v.current.style.width=z[1]+"px"),I?(pl(A,"rbc-header-overflowing"),A.style.marginRight=Cn()+"px"):gl(A,"rbc-header-overflowing")}}},S=c.messages,T=c.add(s,l,"day"),b=c.range(s,T,"day");return n=n.filter(function($){return ta($,c.startOf(s,"day"),c.endOf(T,"day"),t,c)}),n.sort(function($,A){return+t.start($)-+t.start(A)}),E.createElement("div",{className:"rbc-agenda-view"},n.length!==0?E.createElement(E.Fragment,null,E.createElement("table",{ref:f,className:"rbc-agenda-table"},E.createElement("thead",null,E.createElement("tr",null,E.createElement("th",{className:"rbc-header",ref:p},S.date),E.createElement("th",{className:"rbc-header",ref:v},S.time),E.createElement("th",{className:"rbc-header"},S.event)))),E.createElement("div",{className:"rbc-agenda-content",ref:g},E.createElement("table",{className:"rbc-agenda-table"},E.createElement("tbody",{ref:y},b.map(function($,A){return w($,n,A)}))))):E.createElement("span",{className:"rbc-agenda-empty"},S.noEventsInRange))}xs.range=function(e,t){var r=t.length,s=r===void 0?gs:r,n=t.localizer,i=n.add(e,s,"day");return{start:e,end:i}};xs.navigate=function(e,t,r){var s=r.length,n=s===void 0?gs:s,i=r.localizer;switch(t){case Je.PREVIOUS:return i.add(e,-n,"day");case Je.NEXT:return i.add(e,n,"day");default:return e}};xs.title=function(e,t){var r=t.length,s=r===void 0?gs:r,n=t.localizer,i=n.add(e,s,"day");return n.format({start:e,end:i},"agendaHeaderFormat")};var Da=Wt(Wt(Wt(Wt(Wt({},Ye.MONTH,fs),Ye.WEEK,$t),Ye.WORK_WEEK,fa),Ye.DAY,ps),Ye.AGENDA,xs),hC=["action","date","today"];function fC(e,t){var r=t.action,s=t.date,n=t.today,i=pt(t,hC);switch(e=typeof e=="string"?Da[e]:e,r){case Je.TODAY:s=n||new Date;break;case Je.DATE:break;default:zr(e&&typeof e.navigate=="function","Calendar View components must implement a static `.navigate(date, action)` method.s"),s=e.navigate(s,r,i)}return s}function pC(e,t){var r=null;return typeof t=="function"?r=t(e):typeof t=="string"&&bt(e)==="object"&&e!=null&&t in e&&(r=e[t]),r}var yt=function(t){return function(r){return pC(r,t)}},gC=["view","date","getNow","onNavigate"],xC=["view","toolbar","events","backgroundEvents","resourceGroupingLayout","style","className","elementProps","date","getNow","length","showMultiDayTimes","onShowMore","doShowMoreDrillDown","components","formats","messages","culture"];function Xc(e){if(Array.isArray(e))return e;for(var t=[],r=0,s=Object.entries(e);r<s.length;r++){var n=zt(s[r],2),i=n[0],o=n[1];o&&t.push(i)}return t}function vC(e,t){var r=t.views,s=Xc(r);return s.indexOf(e)!==-1}var Jc=function(e){function t(){var r;_e(this,t);for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return r=Be(this,t,[].concat(n)),r.getViews=function(){var o=r.props.views;return Array.isArray(o)?VE(o,function(l,c){return l[c]=Da[c]},{}):bt(o)==="object"?VN(o,function(l,c){return l===!0?Da[c]:l}):Da},r.getView=function(){var o=r.getViews();return o[r.props.view]},r.getDrilldownView=function(o){var l=r.props,c=l.view,d=l.drilldownView,u=l.getDrilldownView;return u?u(o,c,Object.keys(r.getViews())):d},r.handleRangeChange=function(o,l,c){var d=r.props,u=d.onRangeChange,m=d.localizer;u&&l.range&&u(l.range(o,{localizer:m}),c)},r.handleNavigate=function(o,l){var c=r.props,d=c.view,u=c.date,m=c.getNow,f=c.onNavigate,p=pt(c,gC),v=r.getView(),g=m();u=fC(v,Ne(Ne({},p),{},{action:o,date:l||u||g,today:g})),f(u,d,o),r.handleRangeChange(u,v)},r.handleViewChange=function(o){o!==r.props.view&&vC(o,r.props)&&r.props.onView(o);var l=r.getViews();r.handleRangeChange(r.props.date||r.props.getNow(),l[o],o)},r.handleSelectEvent=function(){for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];De(r.props.onSelectEvent,l)},r.handleDoubleClickEvent=function(){for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];De(r.props.onDoubleClickEvent,l)},r.handleKeyPressEvent=function(){for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];De(r.props.onKeyPressEvent,l)},r.handleSelectSlot=function(o){De(r.props.onSelectSlot,o)},r.handleDrillDown=function(o,l){var c=r.props.onDrillDown;if(c){c(o,l,r.drilldownView);return}l&&r.handleViewChange(l),r.handleNavigate(Je.DATE,o)},r.state={context:t.getContext(r.props)},r}return Ge(t,e),Le(t,[{key:"render",value:function(){var s=this.props,n=s.view,i=s.toolbar,o=s.events,l=s.backgroundEvents,c=s.resourceGroupingLayout,d=s.style,u=s.className,m=s.elementProps,f=s.date,p=s.getNow,v=s.length,g=s.showMultiDayTimes,y=s.onShowMore,w=s.doShowMoreDrillDown;s.components,s.formats,s.messages,s.culture;var j=pt(s,xC);f=f||p();var k=this.getView(),S=this.state.context,T=S.accessors,b=S.components,$=S.getters,A=S.localizer,R=S.viewNames,I=b.toolbar||wk,z=k.title(f,{localizer:A,length:v});return E.createElement("div",Object.assign({},m,{className:Me(u,"rbc-calendar",j.rtl&&"rbc-rtl"),style:d}),i&&E.createElement(I,{date:f,view:n,views:R,label:z,onView:this.handleViewChange,onNavigate:this.handleNavigate,localizer:A}),E.createElement(k,Object.assign({},j,{events:o,backgroundEvents:l,date:f,getNow:p,length:v,localizer:A,getters:$,components:b,accessors:T,showMultiDayTimes:g,getDrilldownView:this.getDrilldownView,onNavigate:this.handleNavigate,onDrillDown:this.handleDrillDown,onSelectEvent:this.handleSelectEvent,onDoubleClickEvent:this.handleDoubleClickEvent,onKeyPressEvent:this.handleKeyPressEvent,onSelectSlot:this.handleSelectSlot,onShowMore:y,doShowMoreDrillDown:w,resourceGroupingLayout:c})))}}],[{key:"getDerivedStateFromProps",value:function(s){return{context:t.getContext(s)}}},{key:"getContext",value:function(s){var n=s.startAccessor,i=s.endAccessor,o=s.allDayAccessor,l=s.tooltipAccessor,c=s.titleAccessor,d=s.resourceAccessor,u=s.resourceIdAccessor,m=s.resourceTitleAccessor,f=s.eventIdAccessor,p=s.eventPropGetter,v=s.backgroundEventPropGetter,g=s.slotPropGetter,y=s.slotGroupPropGetter,w=s.dayPropGetter,j=s.view,k=s.views,S=s.localizer,T=s.culture,b=s.messages,$=b===void 0?{}:b,A=s.components,R=A===void 0?{}:A,I=s.formats,z=I===void 0?{}:I,Y=Xc(k),B=Nk($);return{viewNames:Y,localizer:bk(S,T,z,B),getters:{eventProp:function(){return p&&p.apply(void 0,arguments)||{}},backgroundEventProp:function(){return v&&v.apply(void 0,arguments)||{}},slotProp:function(){return g&&g.apply(void 0,arguments)||{}},slotGroupProp:function(){return y&&y.apply(void 0,arguments)||{}},dayProp:function(){return w&&w.apply(void 0,arguments)||{}}},components:HN(R[j]||{},RE(R,Y),{eventWrapper:ut,backgroundEventWrapper:ut,eventContainerWrapper:ut,dateCellWrapper:ut,weekWrapper:ut,timeSlotWrapper:ut,timeGutterWrapper:ut,timeIndicatorWrapper:ut}),accessors:{start:yt(n),end:yt(i),allDay:yt(o),tooltip:yt(l),title:yt(c),resource:yt(d),resourceId:yt(u),resourceTitle:yt(m),eventId:yt(f)}}}}])}(E.Component);Jc.defaultProps={events:[],backgroundEvents:[],elementProps:{},popup:!1,toolbar:!0,view:Ye.MONTH,views:[Ye.MONTH,Ye.WEEK,Ye.DAY,Ye.AGENDA],step:30,length:30,allDayMaxRows:1/0,doShowMoreDrillDown:!0,drilldownView:Ye.DAY,titleAccessor:"title",tooltipAccessor:"title",allDayAccessor:"allDay",startAccessor:"start",endAccessor:"end",resourceAccessor:"resourceId",resourceIdAccessor:"id",resourceTitleAccessor:"title",eventIdAccessor:"id",longPressThreshold:250,getNow:function(){return new Date},dayLayoutAlgorithm:"overlap"};var yC=Cl(Jc,{view:"onView",date:"onNavigate",selected:"onSelectEvent"}),bC=function(t,r,s){var n=t.start,i=t.end;return"".concat(s.format(n,"P",r)," – ").concat(s.format(i,"P",r))},Os=function(t,r,s){var n=t.start,i=t.end;return"".concat(s.format(n,"p",r)," – ").concat(s.format(i,"p",r))},wC=function(t,r,s){var n=t.start;return"".concat(s.format(n,"h:mma",r)," – ")},jC=function(t,r,s){var n=t.end;return" – ".concat(s.format(n,"h:mma",r))},NC=function(t,r,s){var n=t.start,i=t.end;return"".concat(s.format(n,"MMMM dd",r)," – ").concat(s.format(i,pr(n,i,"month")?"dd":"MMMM dd",r))},SC={dateFormat:"dd",dayFormat:"dd eee",weekdayFormat:"ccc",selectRangeFormat:Os,eventTimeRangeFormat:Os,eventTimeRangeStartFormat:wC,eventTimeRangeEndFormat:jC,timeGutterFormat:"p",monthHeaderFormat:"MMMM yyyy",dayHeaderFormat:"cccc MMM dd",dayRangeHeaderFormat:NC,agendaHeaderFormat:bC,agendaDateFormat:"ccc MMM dd",agendaTimeFormat:"p",agendaTimeRangeFormat:Os},EC=function(t){var r=t.startOfWeek,s=t.getDay,n=t.format,i=t.locales;return new yk({formats:SC,firstOfWeek:function(l){return s(r(new Date,{locale:i[l]}))},format:function(l,c,d){return n(new Date(l),c,{locale:i[d]})}})};const kC={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},CC=(e,t,r)=>{let s;const n=kC[e];return typeof n=="string"?s=n:t===1?s=n.one:s=n.other.replace("{{count}}",t.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+s:s+" ago":s};function Rs(e){return(t={})=>{const r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}const $C={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},DC={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},TC={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},AC={date:Rs({formats:$C,defaultWidth:"full"}),time:Rs({formats:DC,defaultWidth:"full"}),dateTime:Rs({formats:TC,defaultWidth:"full"})},MC={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},PC=(e,t,r,s)=>MC[e];function Pr(e){return(t,r)=>{const s=r!=null&&r.context?String(r.context):"standalone";let n;if(s==="formatting"&&e.formattingValues){const o=e.defaultFormattingWidth||e.defaultWidth,l=r!=null&&r.width?String(r.width):o;n=e.formattingValues[l]||e.formattingValues[o]}else{const o=e.defaultWidth,l=r!=null&&r.width?String(r.width):e.defaultWidth;n=e.values[l]||e.values[o]}const i=e.argumentCallback?e.argumentCallback(t):t;return n[i]}}const OC={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},RC={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},_C={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},LC={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},IC={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},FC={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},WC=(e,t)=>{const r=Number(e),s=r%100;if(s>20||s<10)switch(s%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},HC={ordinalNumber:WC,era:Pr({values:OC,defaultWidth:"wide"}),quarter:Pr({values:RC,defaultWidth:"wide",argumentCallback:e=>e-1}),month:Pr({values:_C,defaultWidth:"wide"}),day:Pr({values:LC,defaultWidth:"wide"}),dayPeriod:Pr({values:IC,defaultWidth:"wide",formattingValues:FC,defaultFormattingWidth:"wide"})};function Or(e){return(t,r={})=>{const s=r.width,n=s&&e.matchPatterns[s]||e.matchPatterns[e.defaultMatchWidth],i=t.match(n);if(!i)return null;const o=i[0],l=s&&e.parsePatterns[s]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(l)?zC(l,m=>m.test(o)):UC(l,m=>m.test(o));let d;d=e.valueCallback?e.valueCallback(c):c,d=r.valueCallback?r.valueCallback(d):d;const u=t.slice(o.length);return{value:d,rest:u}}}function UC(e,t){for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return r}function zC(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r}function BC(e){return(t,r={})=>{const s=t.match(e.matchPattern);if(!s)return null;const n=s[0],i=t.match(e.parsePattern);if(!i)return null;let o=e.valueCallback?e.valueCallback(i[0]):i[0];o=r.valueCallback?r.valueCallback(o):o;const l=t.slice(n.length);return{value:o,rest:l}}}const GC=/^(\d+)(th|st|nd|rd)?/i,qC=/\d+/i,YC={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},VC={any:[/^b/i,/^(a|c)/i]},KC={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},XC={any:[/1/i,/2/i,/3/i,/4/i]},JC={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},QC={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},ZC={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},e$={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},t$={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},r$={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},a$={ordinalNumber:BC({matchPattern:GC,parsePattern:qC,valueCallback:e=>parseInt(e,10)}),era:Or({matchPatterns:YC,defaultMatchWidth:"wide",parsePatterns:VC,defaultParseWidth:"any"}),quarter:Or({matchPatterns:KC,defaultMatchWidth:"wide",parsePatterns:XC,defaultParseWidth:"any",valueCallback:e=>e+1}),month:Or({matchPatterns:JC,defaultMatchWidth:"wide",parsePatterns:QC,defaultParseWidth:"any"}),day:Or({matchPatterns:ZC,defaultMatchWidth:"wide",parsePatterns:e$,defaultParseWidth:"any"}),dayPeriod:Or({matchPatterns:t$,defaultMatchWidth:"any",parsePatterns:r$,defaultParseWidth:"any"})},Qc={code:"en-US",formatDistance:CC,formatLong:AC,formatRelative:PC,localize:HC,match:a$,options:{weekStartsOn:0,firstWeekContainsDate:1}};let s$={};function vs(){return s$}const Zc=6048e5,n$=864e5,ed=6e4,Jn=36e5,zo=Symbol.for("constructDateFrom");function gt(e,t){return typeof e=="function"?e(t):e&&typeof e=="object"&&zo in e?e[zo](t):e instanceof Date?new e.constructor(t):new Date(t)}function He(e,t){return gt(t||e,e)}function Bo(e){const t=He(e),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),+e-+r}function i$(e,...t){const r=gt.bind(null,t.find(s=>typeof s=="object"));return t.map(r)}function Go(e,t){const r=He(e,t==null?void 0:t.in);return r.setHours(0,0,0,0),r}function o$(e,t,r){const[s,n]=i$(r==null?void 0:r.in,e,t),i=Go(s),o=Go(n),l=+i-Bo(i),c=+o-Bo(o);return Math.round((l-c)/n$)}function l$(e,t){const r=He(e,t==null?void 0:t.in);return r.setFullYear(r.getFullYear(),0,1),r.setHours(0,0,0,0),r}function c$(e,t){const r=He(e,t==null?void 0:t.in);return o$(r,l$(r))+1}function hr(e,t){var l,c,d,u;const r=vs(),s=(t==null?void 0:t.weekStartsOn)??((c=(l=t==null?void 0:t.locale)==null?void 0:l.options)==null?void 0:c.weekStartsOn)??r.weekStartsOn??((u=(d=r.locale)==null?void 0:d.options)==null?void 0:u.weekStartsOn)??0,n=He(e,t==null?void 0:t.in),i=n.getDay(),o=(i<s?7:0)+i-s;return n.setDate(n.getDate()-o),n.setHours(0,0,0,0),n}function qa(e,t){return hr(e,{...t,weekStartsOn:1})}function td(e,t){const r=He(e,t==null?void 0:t.in),s=r.getFullYear(),n=gt(r,0);n.setFullYear(s+1,0,4),n.setHours(0,0,0,0);const i=qa(n),o=gt(r,0);o.setFullYear(s,0,4),o.setHours(0,0,0,0);const l=qa(o);return r.getTime()>=i.getTime()?s+1:r.getTime()>=l.getTime()?s:s-1}function d$(e,t){const r=td(e,t),s=gt(e,0);return s.setFullYear(r,0,4),s.setHours(0,0,0,0),qa(s)}function u$(e,t){const r=He(e,t==null?void 0:t.in),s=+qa(r)-+d$(r);return Math.round(s/Zc)+1}function rd(e,t){var u,m,f,p;const r=He(e,t==null?void 0:t.in),s=r.getFullYear(),n=vs(),i=(t==null?void 0:t.firstWeekContainsDate)??((m=(u=t==null?void 0:t.locale)==null?void 0:u.options)==null?void 0:m.firstWeekContainsDate)??n.firstWeekContainsDate??((p=(f=n.locale)==null?void 0:f.options)==null?void 0:p.firstWeekContainsDate)??1,o=gt((t==null?void 0:t.in)||e,0);o.setFullYear(s+1,0,i),o.setHours(0,0,0,0);const l=hr(o,t),c=gt((t==null?void 0:t.in)||e,0);c.setFullYear(s,0,i),c.setHours(0,0,0,0);const d=hr(c,t);return+r>=+l?s+1:+r>=+d?s:s-1}function m$(e,t){var l,c,d,u;const r=vs(),s=(t==null?void 0:t.firstWeekContainsDate)??((c=(l=t==null?void 0:t.locale)==null?void 0:l.options)==null?void 0:c.firstWeekContainsDate)??r.firstWeekContainsDate??((u=(d=r.locale)==null?void 0:d.options)==null?void 0:u.firstWeekContainsDate)??1,n=rd(e,t),i=gt((t==null?void 0:t.in)||e,0);return i.setFullYear(n,0,s),i.setHours(0,0,0,0),hr(i,t)}function h$(e,t){const r=He(e,t==null?void 0:t.in),s=+hr(r,t)-+m$(r,t);return Math.round(s/Zc)+1}function je(e,t){const r=e<0?"-":"",s=Math.abs(e).toString().padStart(t,"0");return r+s}const St={y(e,t){const r=e.getFullYear(),s=r>0?r:1-r;return je(t==="yy"?s%100:s,t.length)},M(e,t){const r=e.getMonth();return t==="M"?String(r+1):je(r+1,2)},d(e,t){return je(e.getDate(),t.length)},a(e,t){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(e,t){return je(e.getHours()%12||12,t.length)},H(e,t){return je(e.getHours(),t.length)},m(e,t){return je(e.getMinutes(),t.length)},s(e,t){return je(e.getSeconds(),t.length)},S(e,t){const r=t.length,s=e.getMilliseconds(),n=Math.trunc(s*Math.pow(10,r-3));return je(n,t.length)}},tr={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},qo={G:function(e,t,r){const s=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(s,{width:"abbreviated"});case"GGGGG":return r.era(s,{width:"narrow"});case"GGGG":default:return r.era(s,{width:"wide"})}},y:function(e,t,r){if(t==="yo"){const s=e.getFullYear(),n=s>0?s:1-s;return r.ordinalNumber(n,{unit:"year"})}return St.y(e,t)},Y:function(e,t,r,s){const n=rd(e,s),i=n>0?n:1-n;if(t==="YY"){const o=i%100;return je(o,2)}return t==="Yo"?r.ordinalNumber(i,{unit:"year"}):je(i,t.length)},R:function(e,t){const r=td(e);return je(r,t.length)},u:function(e,t){const r=e.getFullYear();return je(r,t.length)},Q:function(e,t,r){const s=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(s);case"QQ":return je(s,2);case"Qo":return r.ordinalNumber(s,{unit:"quarter"});case"QQQ":return r.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(s,{width:"wide",context:"formatting"})}},q:function(e,t,r){const s=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(s);case"qq":return je(s,2);case"qo":return r.ordinalNumber(s,{unit:"quarter"});case"qqq":return r.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(s,{width:"wide",context:"standalone"})}},M:function(e,t,r){const s=e.getMonth();switch(t){case"M":case"MM":return St.M(e,t);case"Mo":return r.ordinalNumber(s+1,{unit:"month"});case"MMM":return r.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(s,{width:"wide",context:"formatting"})}},L:function(e,t,r){const s=e.getMonth();switch(t){case"L":return String(s+1);case"LL":return je(s+1,2);case"Lo":return r.ordinalNumber(s+1,{unit:"month"});case"LLL":return r.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(s,{width:"wide",context:"standalone"})}},w:function(e,t,r,s){const n=h$(e,s);return t==="wo"?r.ordinalNumber(n,{unit:"week"}):je(n,t.length)},I:function(e,t,r){const s=u$(e);return t==="Io"?r.ordinalNumber(s,{unit:"week"}):je(s,t.length)},d:function(e,t,r){return t==="do"?r.ordinalNumber(e.getDate(),{unit:"date"}):St.d(e,t)},D:function(e,t,r){const s=c$(e);return t==="Do"?r.ordinalNumber(s,{unit:"dayOfYear"}):je(s,t.length)},E:function(e,t,r){const s=e.getDay();switch(t){case"E":case"EE":case"EEE":return r.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(s,{width:"short",context:"formatting"});case"EEEE":default:return r.day(s,{width:"wide",context:"formatting"})}},e:function(e,t,r,s){const n=e.getDay(),i=(n-s.weekStartsOn+8)%7||7;switch(t){case"e":return String(i);case"ee":return je(i,2);case"eo":return r.ordinalNumber(i,{unit:"day"});case"eee":return r.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(n,{width:"short",context:"formatting"});case"eeee":default:return r.day(n,{width:"wide",context:"formatting"})}},c:function(e,t,r,s){const n=e.getDay(),i=(n-s.weekStartsOn+8)%7||7;switch(t){case"c":return String(i);case"cc":return je(i,t.length);case"co":return r.ordinalNumber(i,{unit:"day"});case"ccc":return r.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(n,{width:"narrow",context:"standalone"});case"cccccc":return r.day(n,{width:"short",context:"standalone"});case"cccc":default:return r.day(n,{width:"wide",context:"standalone"})}},i:function(e,t,r){const s=e.getDay(),n=s===0?7:s;switch(t){case"i":return String(n);case"ii":return je(n,t.length);case"io":return r.ordinalNumber(n,{unit:"day"});case"iii":return r.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(s,{width:"short",context:"formatting"});case"iiii":default:return r.day(s,{width:"wide",context:"formatting"})}},a:function(e,t,r){const n=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(e,t,r){const s=e.getHours();let n;switch(s===12?n=tr.noon:s===0?n=tr.midnight:n=s/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(e,t,r){const s=e.getHours();let n;switch(s>=17?n=tr.evening:s>=12?n=tr.afternoon:s>=4?n=tr.morning:n=tr.night,t){case"B":case"BB":case"BBB":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(e,t,r){if(t==="ho"){let s=e.getHours()%12;return s===0&&(s=12),r.ordinalNumber(s,{unit:"hour"})}return St.h(e,t)},H:function(e,t,r){return t==="Ho"?r.ordinalNumber(e.getHours(),{unit:"hour"}):St.H(e,t)},K:function(e,t,r){const s=e.getHours()%12;return t==="Ko"?r.ordinalNumber(s,{unit:"hour"}):je(s,t.length)},k:function(e,t,r){let s=e.getHours();return s===0&&(s=24),t==="ko"?r.ordinalNumber(s,{unit:"hour"}):je(s,t.length)},m:function(e,t,r){return t==="mo"?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):St.m(e,t)},s:function(e,t,r){return t==="so"?r.ordinalNumber(e.getSeconds(),{unit:"second"}):St.s(e,t)},S:function(e,t){return St.S(e,t)},X:function(e,t,r){const s=e.getTimezoneOffset();if(s===0)return"Z";switch(t){case"X":return Vo(s);case"XXXX":case"XX":return It(s);case"XXXXX":case"XXX":default:return It(s,":")}},x:function(e,t,r){const s=e.getTimezoneOffset();switch(t){case"x":return Vo(s);case"xxxx":case"xx":return It(s);case"xxxxx":case"xxx":default:return It(s,":")}},O:function(e,t,r){const s=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Yo(s,":");case"OOOO":default:return"GMT"+It(s,":")}},z:function(e,t,r){const s=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Yo(s,":");case"zzzz":default:return"GMT"+It(s,":")}},t:function(e,t,r){const s=Math.trunc(+e/1e3);return je(s,t.length)},T:function(e,t,r){return je(+e,t.length)}};function Yo(e,t=""){const r=e>0?"-":"+",s=Math.abs(e),n=Math.trunc(s/60),i=s%60;return i===0?r+String(n):r+String(n)+t+je(i,2)}function Vo(e,t){return e%60===0?(e>0?"-":"+")+je(Math.abs(e)/60,2):It(e,t)}function It(e,t=""){const r=e>0?"-":"+",s=Math.abs(e),n=je(Math.trunc(s/60),2),i=je(s%60,2);return r+n+t+i}const Ko=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},ad=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},f$=(e,t)=>{const r=e.match(/(P+)(p+)?/)||[],s=r[1],n=r[2];if(!n)return Ko(e,t);let i;switch(s){case"P":i=t.dateTime({width:"short"});break;case"PP":i=t.dateTime({width:"medium"});break;case"PPP":i=t.dateTime({width:"long"});break;case"PPPP":default:i=t.dateTime({width:"full"});break}return i.replace("{{date}}",Ko(s,t)).replace("{{time}}",ad(n,t))},p$={p:ad,P:f$},g$=/^D+$/,x$=/^Y+$/,v$=["D","DD","YY","YYYY"];function y$(e){return g$.test(e)}function b$(e){return x$.test(e)}function w$(e,t,r){const s=j$(e,t,r);if(console.warn(s),v$.includes(e))throw new RangeError(s)}function j$(e,t,r){const s=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${s} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}function N$(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function S$(e){return!(!N$(e)&&typeof e!="number"||isNaN(+He(e)))}const E$=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,k$=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,C$=/^'([^]*?)'?$/,$$=/''/g,D$=/[a-zA-Z]/;function tt(e,t,r){var u,m,f,p,v,g,y,w;const s=vs(),n=(r==null?void 0:r.locale)??s.locale??Qc,i=(r==null?void 0:r.firstWeekContainsDate)??((m=(u=r==null?void 0:r.locale)==null?void 0:u.options)==null?void 0:m.firstWeekContainsDate)??s.firstWeekContainsDate??((p=(f=s.locale)==null?void 0:f.options)==null?void 0:p.firstWeekContainsDate)??1,o=(r==null?void 0:r.weekStartsOn)??((g=(v=r==null?void 0:r.locale)==null?void 0:v.options)==null?void 0:g.weekStartsOn)??s.weekStartsOn??((w=(y=s.locale)==null?void 0:y.options)==null?void 0:w.weekStartsOn)??0,l=He(e,r==null?void 0:r.in);if(!S$(l))throw new RangeError("Invalid time value");let c=t.match(k$).map(j=>{const k=j[0];if(k==="p"||k==="P"){const S=p$[k];return S(j,n.formatLong)}return j}).join("").match(E$).map(j=>{if(j==="''")return{isToken:!1,value:"'"};const k=j[0];if(k==="'")return{isToken:!1,value:T$(j)};if(qo[k])return{isToken:!0,value:j};if(k.match(D$))throw new RangeError("Format string contains an unescaped latin alphabet character `"+k+"`");return{isToken:!1,value:j}});n.localize.preprocessor&&(c=n.localize.preprocessor(l,c));const d={firstWeekContainsDate:i,weekStartsOn:o,locale:n};return c.map(j=>{if(!j.isToken)return j.value;const k=j.value;(!(r!=null&&r.useAdditionalWeekYearTokens)&&b$(k)||!(r!=null&&r.useAdditionalDayOfYearTokens)&&y$(k))&&w$(k,t,String(e));const S=qo[k[0]];return S(l,k,n.localize,d)}).join("")}function T$(e){const t=e.match(C$);return t?t[1].replace($$,"'"):e}function A$(e,t){return He(e,t==null?void 0:t.in).getDay()}function M$(e,t,r){return gt(e,+He(e)+t)}function P$(e,t,r){return M$(e,t*Jn)}function Xo(e,t){return+He(e)<+He(t)}function O$(e,t){const r=()=>gt(t==null?void 0:t.in,NaN),n=I$(e);let i;if(n.date){const d=F$(n.date,2);i=W$(d.restDateString,d.year)}if(!i||isNaN(+i))return r();const o=+i;let l=0,c;if(n.time&&(l=H$(n.time),isNaN(l)))return r();if(n.timezone){if(c=U$(n.timezone),isNaN(c))return r()}else{const d=new Date(o+l),u=He(0,t==null?void 0:t.in);return u.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),u.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),u}return He(o+l+c,t==null?void 0:t.in)}const Na={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},R$=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,_$=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,L$=/^([+-])(\d{2})(?::?(\d{2}))?$/;function I$(e){const t={},r=e.split(Na.dateTimeDelimiter);let s;if(r.length>2)return t;if(/:/.test(r[0])?s=r[0]:(t.date=r[0],s=r[1],Na.timeZoneDelimiter.test(t.date)&&(t.date=e.split(Na.timeZoneDelimiter)[0],s=e.substr(t.date.length,e.length))),s){const n=Na.timezone.exec(s);n?(t.time=s.replace(n[1],""),t.timezone=n[1]):t.time=s}return t}function F$(e,t){const r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),s=e.match(r);if(!s)return{year:NaN,restDateString:""};const n=s[1]?parseInt(s[1]):null,i=s[2]?parseInt(s[2]):null;return{year:i===null?n:i*100,restDateString:e.slice((s[1]||s[2]).length)}}function W$(e,t){if(t===null)return new Date(NaN);const r=e.match(R$);if(!r)return new Date(NaN);const s=!!r[4],n=Rr(r[1]),i=Rr(r[2])-1,o=Rr(r[3]),l=Rr(r[4]),c=Rr(r[5])-1;if(s)return Y$(t,l,c)?z$(t,l,c):new Date(NaN);{const d=new Date(0);return!G$(t,i,o)||!q$(t,n)?new Date(NaN):(d.setUTCFullYear(t,i,Math.max(n,o)),d)}}function Rr(e){return e?parseInt(e):1}function H$(e){const t=e.match(_$);if(!t)return NaN;const r=_s(t[1]),s=_s(t[2]),n=_s(t[3]);return V$(r,s,n)?r*Jn+s*ed+n*1e3:NaN}function _s(e){return e&&parseFloat(e.replace(",","."))||0}function U$(e){if(e==="Z")return 0;const t=e.match(L$);if(!t)return 0;const r=t[1]==="+"?-1:1,s=parseInt(t[2]),n=t[3]&&parseInt(t[3])||0;return K$(s,n)?r*(s*Jn+n*ed):NaN}function z$(e,t,r){const s=new Date(0);s.setUTCFullYear(e,0,4);const n=s.getUTCDay()||7,i=(t-1)*7+r+1-n;return s.setUTCDate(s.getUTCDate()+i),s}const B$=[31,null,31,30,31,30,31,31,30,31,30,31];function sd(e){return e%400===0||e%4===0&&e%100!==0}function G$(e,t,r){return t>=0&&t<=11&&r>=1&&r<=(B$[t]||(sd(e)?29:28))}function q$(e,t){return t>=1&&t<=(sd(e)?366:365)}function Y$(e,t,r){return t>=1&&t<=53&&r>=0&&r<=6}function V$(e,t,r){return e===24?t===0&&r===0:r>=0&&r<60&&t>=0&&t<60&&e>=0&&e<25}function K$(e,t){return t>=0&&t<=59}const X$=(e,t="PPP")=>{if(!e)return"";try{const r=typeof e=="string"?O$(e):e;return tt(r,t)}catch(r){return console.error("Error formatting date:",r),""}},J$=e=>{if(!Array.isArray(e)||e.length===0)return"";let t=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//SchoolFlow//Calendar//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH"];return e.forEach(r=>{if(!r.start||!r.end)return;const s=tt(r.start,"yyyyMMdd'T'HHmmss'Z'"),n=tt(r.end,"yyyyMMdd'T'HHmmss'Z'"),i=tt(new Date,"yyyyMMdd'T'HHmmss'Z'"),o=`${r.id||Date.now()}@schoolflow.app`;let l="";r.resource&&(l+=`Class: ${r.resource.class||"N/A"}
`,l+=`Subject: ${r.resource.subject||"N/A"}
`,r.resource.isSubstitution&&(l+=`This is a substitution class
`)),r.objectives&&(l+=`
Objectives:
${r.objectives}
`),r.activities&&(l+=`
Activities:
${r.activities}
`),r.notes&&(l+=`
Notes:
${r.notes}
`),l=l.replace(/\n/g,"\\n"),t=t.concat(["BEGIN:VEVENT",`UID:${o}`,`DTSTAMP:${i}`,`DTSTART:${s}`,`DTEND:${n}`,`SUMMARY:${r.title}`,`DESCRIPTION:${l}`,"END:VEVENT"])}),t.push("END:VCALENDAR"),t.join(`\r
`)},Q$=(e,t="school-calendar.ics")=>{const r=J$(e);if(!r)return;const s=new Blob([r],{type:"text/calendar;charset=utf-8"}),n=URL.createObjectURL(s),i=document.createElement("a");i.href=n,i.download=t,document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i),URL.revokeObjectURL(n)},100)},Z$=(e,t)=>Array.isArray(e)?t?e.filter(r=>{var s,n;return!(t.types&&t.types.length>0&&!t.types.includes(r.type)||t.class&&((s=r.resource)==null?void 0:s.class)!==t.class||t.subject&&((n=r.resource)==null?void 0:n.subject)!==t.subject||t.startDate&&Xo(r.start,new Date(t.startDate))||t.endDate&&Xo(new Date(t.endDate),r.start))}):e:[],eD=({event:e})=>{const t=()=>{switch(e.type){case"timetable":return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"event-title",children:e.title}),e.resource&&a.jsx("div",{className:"event-meta",children:a.jsxs("span",{children:["Period: ",e.resource.period]})}),e.lessonPlan&&a.jsx("div",{className:"event-status",children:a.jsx("span",{children:e.status||"No Status"})})]});case"substitution":return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"event-title",children:e.title}),e.resource&&a.jsxs("div",{className:"event-meta",children:[a.jsxs("span",{children:["Period: ",e.resource.period]}),a.jsx("span",{className:"substitution-label",children:"Substitution"})]})]});case"personal":return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"event-title",children:e.title}),e.notes&&a.jsx("div",{className:"event-meta",children:a.jsx("span",{className:"notes-preview",children:e.notes.length>30?`${e.notes.substring(0,30)}...`:e.notes})})]});default:return a.jsx("div",{className:"event-title",children:e.title})}},r={backgroundColor:e.color||"#3174ad",borderLeft:e.type==="substitution"?"4px solid #ef4444":"none"};return a.jsx("div",{className:`custom-calendar-event event-type-${e.type}`,style:r,children:t()})},tD=({events:e,daysThreshold:t=3})=>{const r=new Date,s=new Date;s.setDate(r.getDate()+t);const n=e.filter(i=>{const o=new Date(i.start);return o>r&&o<=s});return n.sort((i,o)=>new Date(i.start)-new Date(o.start)),n.length===0?null:a.jsxs("div",{className:"calendar-reminders",children:[a.jsx("h3",{className:"reminders-title",children:"Upcoming Events"}),a.jsx("div",{className:"reminders-list",children:n.map(i=>a.jsxs("div",{className:"reminder-item",style:{borderLeft:`4px solid ${i.color||"#3174ad"}`},children:[a.jsx("div",{className:"reminder-title",children:i.title}),a.jsx("div",{className:"reminder-date",children:X$(i.start,"PPpp")}),i.type==="timetable"&&i.lessonPlan&&a.jsx("div",{className:"reminder-badge lesson-plan-badge",children:i.status||"Lesson Plan"}),i.type==="substitution"&&a.jsx("div",{className:"reminder-badge substitution-badge",children:"Substitution"})]},i.id))})]})},rD=({filters:e,onFilterChange:t,classes:r=[],subjects:s=[]})=>{const n=d=>{const u=[...e.types||[]],m=u.indexOf(d);m===-1?u.push(d):u.splice(m,1),t({...e,types:u})},i=d=>{const{name:u,value:m}=d.target;t({...e,[u]:m})},o=d=>{const{name:u,value:m}=d.target;t({...e,[u]:m})},l=()=>{t({types:["timetable","personal","substitution"],class:"",subject:"",startDate:"",endDate:""})},c=d=>{var u;return((u=e==null?void 0:e.types)==null?void 0:u.includes(d))||!1};return a.jsxs("div",{className:"calendar-filter",children:[a.jsxs("div",{className:"filter-section type-filters",children:[a.jsx("div",{className:"filter-label",children:"Event Types:"}),a.jsxs("div",{className:"filter-buttons",children:[a.jsxs("button",{className:`filter-btn ${c("timetable")?"active":""}`,onClick:()=>n("timetable"),children:[a.jsx("div",{className:"color-dot timetable-color"}),"Timetable"]}),a.jsxs("button",{className:`filter-btn ${c("substitution")?"active":""}`,onClick:()=>n("substitution"),children:[a.jsx("div",{className:"color-dot substitution-color"}),"Substitutions"]}),a.jsxs("button",{className:`filter-btn ${c("personal")?"active":""}`,onClick:()=>n("personal"),children:[a.jsx("div",{className:"color-dot personal-color"}),"Personal"]})]})]}),a.jsxs("div",{className:"filter-section advanced-filters",children:[a.jsxs("div",{className:"filter-row",children:[a.jsxs("div",{className:"filter-field",children:[a.jsx("label",{htmlFor:"class-filter",children:"Class:"}),a.jsxs("select",{id:"class-filter",name:"class",value:e.class||"",onChange:i,children:[a.jsx("option",{value:"",children:"All Classes"}),r.map(d=>a.jsx("option",{value:d,children:d},d))]})]}),a.jsxs("div",{className:"filter-field",children:[a.jsx("label",{htmlFor:"subject-filter",children:"Subject:"}),a.jsxs("select",{id:"subject-filter",name:"subject",value:e.subject||"",onChange:i,children:[a.jsx("option",{value:"",children:"All Subjects"}),s.map(d=>a.jsx("option",{value:d,children:d},d))]})]})]}),a.jsxs("div",{className:"filter-row",children:[a.jsxs("div",{className:"filter-field",children:[a.jsx("label",{htmlFor:"start-date-filter",children:"From:"}),a.jsx("input",{type:"date",id:"start-date-filter",name:"startDate",value:e.startDate||"",onChange:o})]}),a.jsxs("div",{className:"filter-field",children:[a.jsx("label",{htmlFor:"end-date-filter",children:"To:"}),a.jsx("input",{type:"date",id:"end-date-filter",name:"endDate",value:e.endDate||"",onChange:o})]}),a.jsx("button",{className:"reset-filters-btn",onClick:l,children:"Reset Filters"})]})]})]})},aD={"en-US":Qc},sD=EC({format:tt,startOfWeek:hr,getDay:A$,locales:aD}),nD=({user:e})=>{const[t,r]=x.useState([]),[s,n]=x.useState(null),[i,o]=x.useState(!1),[l,c]=x.useState(!1),[d,u]=x.useState("week"),[m,f]=x.useState(null),[p,v]=x.useState(!1),[g,y]=x.useState(""),[w,j]=x.useState({title:"",class:"",subject:"",notes:""}),[k,S]=x.useState(!1),[T,b]=x.useState([]),[$,A]=x.useState([]),R=Array.isArray(e==null?void 0:e.roles)?e.roles.some(D=>(D||"").toString().toLowerCase().replace(/\s+/g,"")==="hm"):!1;x.useEffect(()=>{e&&I()},[e]),x.useEffect(()=>{const D=new Set,U=new Set;e!=null&&e.classes&&Array.isArray(e.classes)&&e.classes.forEach(Q=>D.add(Q)),e!=null&&e.subjects&&Array.isArray(e.subjects)&&e.subjects.forEach(Q=>U.add(Q)),t.forEach(Q=>{var de,Se;(de=Q.resource)!=null&&de.class&&D.add(Q.resource.class),(Se=Q.resource)!=null&&Se.subject&&U.add(Q.resource.subject)});const Z=Array.from(D).sort(),ae=Array.from(U).sort();b(Z),A(ae);async function V(){try{if(!R)return;const Q=Z.length===0,de=ae.length===0;if(!Q&&!de)return;const[Se,Ae]=await Promise.all([Q?Va().catch(()=>[]):Promise.resolve([]),de?rl().catch(()=>[]):Promise.resolve([])]);Q&&Array.isArray(Se)&&Se.length&&b(Se),de&&Array.isArray(Ae)&&Ae.length&&A(Ae)}catch{}}V()},[t,e]);const I=async()=>{if(e!=null&&e.email){v(!0),y("");try{const D=await Yd(e.email);if(D&&D.error){console.error("Calendar API error:",D.error),y(`Failed to load calendar: ${D.error}`),v(!1);return}if(!D||!Array.isArray(D)){console.error("Invalid calendar data format:",D),y("Failed to load calendar: Invalid data format"),r(V=>V.filter(Q=>Q.isPersonalEvent)),v(!1);return}const U=D.map(V=>{const Q=(Ie,xe=1)=>{if(!Ie)return new Date;try{const we=new Date(Ie);if(isNaN(we.getTime()))return console.warn("Invalid date string:",Ie),{start:new Date,end:new Date};const Fe=7+Number(xe||1),qe=Fe+1,P=new Date(we);P.setHours(Fe,0,0);const h=new Date(we);return h.setHours(qe,0,0),{start:P,end:h}}catch(we){return console.warn("Error parsing date:",we),{start:new Date,end:new Date}}},{start:de,end:Se}=Q(V.date,V.period);let Ae="#3174ad";return V.type==="substitution"?Ae="#f87171":V.lessonPlan&&(V.status==="Ready"?Ae="#4ade80":V.status==="Pending Review"?Ae="#facc15":Ae="#93c5fd"),{id:V.id||`${V.date}-${V.period}-${V.class}-${V.subject}`,title:V.title||`${V.class||""} - ${V.subject||""}`,start:de,end:Se,type:V.type||"timetable",resource:{class:V.class||"",subject:V.subject||"",period:V.period},color:Ae,lessonPlan:V.lessonPlan,lpId:V.lpId,status:V.status,objectives:V.objectives,activities:V.activities,notes:V.notes}}),Z=U.filter(V=>V.start&&V.end&&!isNaN(V.start.getTime())&&!isNaN(V.end.getTime()));Z.length<U.length&&console.warn(`Filtered out ${U.length-Z.length} events with invalid dates`);const ae=t.filter(V=>V.isPersonalEvent);r([...Z,...ae]),v(!1),console.log("Calendar data loaded:",{user:e,timetableEvents:Z.filter(V=>V.type==="timetable").length,personalEvents:ae.length,userClasses:e==null?void 0:e.classes,userSubjects:e==null?void 0:e.subjects})}catch(D){console.error("Failed to load calendar events:",D),y("Failed to load calendar events. Please try again later."),r(U=>U.filter(Z=>Z.isPersonalEvent)),v(!1)}}},z=D=>{n(D),o(!0)},Y=()=>{o(!1),n(null)},B=x.useCallback(D=>{var ae;f(D);const U=(e==null?void 0:e.classTeacherFor)||T[0]||"",Z=((ae=e==null?void 0:e.subjects)==null?void 0:ae[0])||$[0]||"";j({title:"",class:U,subject:Z,notes:""}),S(!1),c(!0)},[e,T,$]),N=()=>{c(!1),f(null),j({title:"",class:"",subject:"",notes:""})},G=D=>{var U,Z;n(null),o(!1),D.isPersonalEvent&&(f({start:D.start,end:D.end}),j({id:D.id,title:D.title,class:((U=D.resource)==null?void 0:U.class)||"",subject:((Z=D.resource)==null?void 0:Z.subject)||"",notes:D.notes||""}),S(!0),c(!0))},te=async()=>{if(m)try{const D=m.start.toISOString(),U=m.end.toISOString(),ae={eventId:k?w.id:null,userEmail:e.email,title:w.title||"Untitled Event",startTime:D,endTime:U,class:w.class||"",subject:w.subject||"",notes:w.notes||"",type:"personal",color:"#8b5cf6",allDay:!1},V=await Vd(ae);if(V.error)throw new Error(V.error);const Q={id:V.eventId,title:w.title||"Untitled Event",start:m.start,end:m.end,resource:{class:w.class||"",subject:w.subject||"",isPersonalEvent:!0},notes:w.notes,color:"#8b5cf6",type:"personal",isPersonalEvent:!0};r(k?de=>de.filter(Se=>Se.id!==Q.id).concat(Q):de=>[...de,Q]),N(),alert(`Event "${Q.title}" has been ${k?"updated":"created"} successfully!`)}catch(D){console.error("Failed to save event:",D),alert("Failed to save event. Please try again.")}},X=async()=>{if(k&&w.id)try{const D=await Kd(w.id);if(D.error)throw new Error(D.error);r(U=>U.filter(Z=>Z.id!==w.id)),N(),alert("Event deleted successfully!")}catch(D){console.error("Failed to delete event:",D),alert("Failed to delete event. Please try again.")}},W=D=>({style:{backgroundColor:D.color||"#3174ad",borderRadius:"5px",opacity:.8,color:"white",border:"0px",display:"block"}}),oe=[...new Set(t.filter(D=>{var U;return(U=D.resource)==null?void 0:U.class}).map(D=>D.resource.class))].sort(),ce=[...new Set(t.filter(D=>{var U;return(U=D.resource)==null?void 0:U.subject}).map(D=>D.resource.subject))].sort(),[se,ge]=x.useState({types:["timetable","personal","substitution"],class:"",subject:"",startDate:"",endDate:""}),ve=Z$(t,se),re=()=>{const D=`schoolflow-calendar-${tt(new Date,"yyyy-MM-dd")}.ics`;Q$(ve,D)};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"School Calendar"}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("button",{onClick:()=>u("day"),className:`px-3 py-1 rounded-md ${d==="day"?"bg-blue-600 text-white":"bg-gray-100 text-gray-800"}`,children:"Day"}),a.jsx("button",{onClick:()=>u("week"),className:`px-3 py-1 rounded-md ${d==="week"?"bg-blue-600 text-white":"bg-gray-100 text-gray-800"}`,children:"Week"}),a.jsx("button",{onClick:()=>u("month"),className:`px-3 py-1 rounded-md ${d==="month"?"bg-blue-600 text-white":"bg-gray-100 text-gray-800"}`,children:"Month"}),a.jsxs("button",{onClick:()=>{var V;const D=new Date,U=P$(D,1);f({start:D,end:U});const Z=(e==null?void 0:e.classTeacherFor)||T[0]||"",ae=((V=e==null?void 0:e.subjects)==null?void 0:V[0])||$[0]||"";j({title:"",class:Z,subject:ae,notes:""}),S(!1),c(!0)},className:"px-3 py-1 rounded-md bg-blue-600 text-white hover:bg-blue-700 flex items-center",children:[a.jsx(Wr,{className:"h-4 w-4 mr-1"}),"Create"]}),a.jsx("button",{onClick:I,className:"px-3 py-1 rounded-md bg-gray-100 text-gray-800 hover:bg-gray-200",children:"Refresh"}),a.jsx("button",{onClick:re,className:"px-3 py-1 rounded-md bg-green-600 text-white hover:bg-green-700",children:"Export"})]})]}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm p-4",children:a.jsx(rD,{filters:se,onFilterChange:ge,classes:oe,subjects:ce})}),a.jsx(tD,{events:t,daysThreshold:3}),g&&a.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 p-4 rounded-md mb-4",children:[a.jsx("p",{className:"font-medium",children:"Error loading calendar"}),a.jsx("p",{className:"text-sm",children:g}),a.jsx("button",{onClick:I,className:"mt-2 px-3 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded text-sm",children:"Try Again"})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 h-[600px] relative",children:[p&&a.jsx("div",{className:"absolute inset-0 bg-white/70 flex items-center justify-center z-10",children:a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),a.jsx("p",{className:"mt-2 text-gray-700",children:"Loading calendar events..."})]})}),a.jsx(yC,{localizer:sD,events:ve,startAccessor:"start",endAccessor:"end",view:d,onView:u,onSelectEvent:z,onSelectSlot:B,selectable:!0,eventPropGetter:W,defaultDate:new Date,components:{event:eD}})]}),i&&s&&a.jsx("div",{className:"fixed inset-0 z-[1250] flex items-center justify-center bg-black/40",children:a.jsxs("div",{className:"bg-white w-full max-w-md rounded-xl shadow-lg p-6 mx-4",children:[a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title}),a.jsx("button",{onClick:Y,className:"text-gray-500 hover:text-gray-700",children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:a.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),a.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-xs text-gray-500",children:"Time"}),a.jsxs("div",{className:"text-gray-900",children:[tt(s.start,"h:mm a")," - ",tt(s.end,"h:mm a")]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-xs text-gray-500",children:"Date"}),a.jsx("div",{className:"text-gray-900",children:tt(s.start,"EEEE, MMMM d, yyyy")})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-xs text-gray-500",children:"Class"}),a.jsx("div",{className:"text-gray-900",children:s.resource.class})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-xs text-gray-500",children:"Subject"}),a.jsx("div",{className:"text-gray-900",children:s.resource.subject})]}),s.resource.isSubstitution&&a.jsx("div",{className:"bg-red-50 p-2 rounded-md text-red-700 text-sm",children:"This is a substitution class"}),s.lessonPlan&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"bg-blue-50 p-2 rounded-md text-blue-700 text-sm",children:["Lesson Plan Status: ",s.status]}),s.objectives&&a.jsxs("div",{className:"mt-2",children:[a.jsx("div",{className:"text-xs text-gray-500",children:"Objectives"}),a.jsx("div",{className:"text-gray-900 text-sm whitespace-pre-wrap",children:s.objectives})]}),s.activities&&a.jsxs("div",{className:"mt-2",children:[a.jsx("div",{className:"text-xs text-gray-500",children:"Activities"}),a.jsx("div",{className:"text-gray-900 text-sm whitespace-pre-wrap",children:s.activities})]})]}),s.isPersonalEvent&&s.notes&&a.jsxs("div",{className:"mt-2",children:[a.jsx("div",{className:"text-xs text-gray-500",children:"Notes"}),a.jsx("div",{className:"text-gray-900 text-sm whitespace-pre-wrap",children:s.notes})]}),a.jsxs("div",{className:"mt-2 flex justify-end space-x-2",children:[(s==null?void 0:s.isPersonalEvent)&&a.jsxs("button",{onClick:()=>G(s),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:[a.jsx(ol,{className:"h-4 w-4 inline-block mr-1"}),"Edit"]}),a.jsx("button",{onClick:Y,className:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300",children:"Close"})]})]})]})}),l&&m&&a.jsx("div",{className:"fixed inset-0 z-[1250] flex items-center justify-center bg-black/40",children:a.jsxs("div",{className:"bg-white w-full max-w-md rounded-xl shadow-lg p-6 mx-4",children:[a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:k?"Edit Event":"Create Event"}),a.jsx("button",{onClick:N,className:"text-gray-500 hover:text-gray-700",children:a.jsx(nn,{className:"h-5 w-5"})})]}),a.jsxs("div",{className:"mt-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),a.jsx("input",{type:"text",value:w.title,onChange:D=>j({...w,title:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Event title"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Time"}),a.jsxs("div",{className:"text-gray-900",children:[tt(m.start,"EEEE, MMMM d, yyyy"),a.jsx("br",{}),tt(m.start,"h:mm a")," - ",tt(m.end,"h:mm a")]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Class (Optional)"}),a.jsxs("select",{value:w.class,onChange:D=>j({...w,class:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[a.jsx("option",{value:"",children:"Select Class"}),T.map(D=>a.jsx("option",{value:D,children:D},D))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject (Optional)"}),a.jsxs("select",{value:w.subject,onChange:D=>j({...w,subject:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[a.jsx("option",{value:"",children:"Select Subject"}),$.map(D=>a.jsx("option",{value:D,children:D},D))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),a.jsx("textarea",{value:w.notes,onChange:D=>j({...w,notes:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",rows:3,placeholder:"Additional notes..."})]}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[k&&a.jsxs("button",{type:"button",onClick:X,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:[a.jsx(ll,{className:"h-4 w-4 inline-block mr-1"}),"Delete"]}),a.jsx("button",{type:"button",onClick:N,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),a.jsxs("button",{type:"button",onClick:te,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[a.jsx(hu,{className:"h-4 w-4 inline-block mr-1"}),"Save"]})]})]})]})}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4 flex flex-wrap gap-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-4 h-4 bg-[#3174ad] rounded-sm mr-2"}),a.jsx("span",{className:"text-sm",children:"Regular Class"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-4 h-4 bg-[#4ade80] rounded-sm mr-2"}),a.jsx("span",{className:"text-sm",children:"Ready Lesson Plan"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-4 h-4 bg-[#facc15] rounded-sm mr-2"}),a.jsx("span",{className:"text-sm",children:"Pending Review"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-4 h-4 bg-[#93c5fd] rounded-sm mr-2"}),a.jsx("span",{className:"text-sm",children:"In Progress"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-4 h-4 bg-[#f87171] rounded-sm mr-2"}),a.jsx("span",{className:"text-sm",children:"Substitution"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-4 h-4 bg-[#8b5cf6] rounded-sm mr-2"}),a.jsx("span",{className:"text-sm",children:"Personal Event"})]})]})]})},iD=({user:e})=>a.jsx("div",{children:a.jsx(nD,{user:e})}),oD=({user:e,hasRole:t,withSubmit:r,setToast:s,userRolesNorm:n})=>{const i=x.useMemo(()=>Array.isArray(n)?n:!e||!e.roles?[]:Array.isArray(e.roles)?e.roles.map(h=>String(h).toLowerCase().trim()):[String(e.roles).toLowerCase().trim()],[e,n]),[o,l]=x.useState([]),[c,d]=x.useState(!1),[u,m]=x.useState({examType:"",class:"",subject:"",hasInternalMarks:!0,internalMax:20,externalMax:80,date:Ve()}),[f,p]=x.useState([]),[v,g]=x.useState([]),[y,w]=x.useState([]),[j,k]=x.useState(!0);x.useEffect(()=>{w(["Mathematics","English","Science","Social Studies","Hindi","Computer Science","Physics","Chemistry","Biology"]),k(!1)},[]);const[S,T]=x.useState({class:"",subject:"",examType:""}),[b,$]=x.useState(!1),[A,R]=x.useState(""),[I,z]=x.useState(!1),[Y,B]=x.useState([]),[N,G]=x.useState(null),[te,X]=x.useState([]),[W,oe]=x.useState(null),[ce,se]=x.useState([]),[ge,ve]=x.useState(!1),[re,D]=x.useState(null);x.useEffect(()=>{async function h(){try{const C=await Bd();g(Array.isArray(C)?C:[])}catch(C){console.error(C)}}h()},[]),x.useEffect(()=>{async function h(){try{$(!0),R("");const C=await Sa();if(l(Array.isArray(C)?C:[]),e)if(typeof t=="function"?t("h m"):i.some(_=>_.includes("h m")||_==="hm"||_.includes("headmaster"))){const _=await Va();p(Array.isArray(_)?_:[])}else p(e.classes||[])}catch(C){console.error(C),R("Failed to load data: "+(C.message||C))}finally{$(!1)}}h()},[e,t,i]),x.useEffect(()=>{async function h(){try{k(!0),console.log("🔍 Fetching subjects...");const O=await zd();console.log("📝 All subjects from API:",O);const _=typeof t=="function"?t("h m"):i.some(L=>L.includes("h m")||L==="hm"||L.includes("headmaster")),M=i.some(L=>L.includes("class teacher")||L==="classteacher");if(console.log("👤 User roles:",{isHeadmaster:_,isClassTeacher:M,normalizedRoles:i}),e&&!_)if(M){const L=new Set;if(Array.isArray(e.subjects)&&e.subjects.forEach(H=>L.add(H)),e.classTeacherFor){const H=e.classTeacherFor;try{const q=await Is(e.email);Array.isArray(q)&&q.forEach(ee=>{ee.periods&&Array.isArray(ee.periods)&&ee.periods.forEach(me=>{me.class===H&&me.subject&&L.add(me.subject)})})}catch(q){console.warn("Could not fetch timetable data for subjects:",q)}Array.isArray(o)&&o.forEach(q=>{if(q&&String(q.class||"").trim()===H){const ee=String(q.subject||"").trim();ee&&L.add(ee)}})}const F=Array.from(L).filter(Boolean).sort();console.log("🎓 Class teacher subjects:",F),w(F)}else{const L=Array.isArray(e.subjects)?e.subjects:[];console.log("👨‍🏫 Regular teacher subjects:",L),w(L)}else{const L=(u.class||"").toString().trim();if(console.log("🏫 Headmaster - selected class:",L),L){const F=new Set;if(Array.isArray(o)&&o.forEach(H=>{if(H&&String(H.class||"").trim()===L){const q=String(H.subject||"").trim();q&&F.add(q)}}),F.size===0)console.log("⚠️  No subjects found for class, showing all subjects"),w(O);else{const H=Array.from(F).sort();console.log("📚 Class-specific subjects:",H),w(H)}}else console.log("🌟 Headmaster - showing all subjects:",O),w(O)}}catch(O){console.error("❌ Error fetching subjects:",O),C()}finally{k(!1)}}function C(){console.log("🔄 Using fallback method for subjects");const O=(u.class||"").toString().trim(),_=typeof t=="function"?t("h m"):i.some(H=>H.includes("h m")||H==="hm"||H.includes("headmaster")),M=i.some(H=>H.includes("class teacher")||H==="classteacher");if(e&&M&&!_){const H=new Set;if(Array.isArray(e.subjects)&&e.subjects.forEach(ee=>H.add(ee)),e.classTeacherFor){const ee=e.classTeacherFor;Array.isArray(o)&&o.forEach(me=>{if(me&&String(me.class||"").trim()===ee){const Oe=String(me.subject||"").trim();Oe&&H.add(Oe)}})}const q=Array.from(H).filter(Boolean).sort();console.log("🔄 Fallback class teacher subjects:",q),w(q);return}if(e&&!_){const H=Array.isArray(e.subjects)?e.subjects:[];console.log("🔄 Fallback regular teacher subjects:",H),w(H);return}const L=new Set;Array.isArray(o)&&o.forEach(H=>{if(H)if(O){if(String(H.class||"").trim()===O){const q=String(H.subject||"").trim();q&&L.add(q)}}else{const q=String(H.subject||"").trim();q&&L.add(q)}}),L.size===0&&(console.warn("⚠️  No subjects found anywhere, adding default subjects"),["Mathematics","English","Science","Social Studies","Hindi"].forEach(H=>L.add(H)));const F=Array.from(L).filter(Boolean).sort();console.log("🔄 Fallback headmaster subjects:",F),w(F),k(!1)}h()},[e,t,i,o,u.class]);const U=(h,C)=>{if(h==="examType"){const O=v.find(_=>_.examType===C);m(O?{...u,examType:C,internalMax:O.internalMax,externalMax:O.externalMax}:{...u,examType:C})}else if(h==="hasInternalMarks"){const O={...u,hasInternalMarks:C};if(!C)O.internalMax=0;else{const _=v.find(M=>M.examType===u.examType);O.internalMax=_?_.internalMax:20}m(O)}else m({...u,[h]:C})},Z=async h=>{if(h.preventDefault(),!e){R("You must be logged in to create an exam");return}console.log("Creating exam with user:",{email:e.email,name:e.name,roles:e.roles,normalizedRoles:i});try{const C=Number(u.internalMax||0)+Number(u.externalMax||0);if(R(""),!u.examType){R("Please select an exam type");return}if(!u.class){R("Please select a class");return}if(!u.subject){R("Please select a subject");return}await r("Creating exam...",async()=>{const _=await _d(e.email,{creatorName:e.name||"",class:u.class,subject:u.subject,examType:u.examType,hasInternalMarks:u.hasInternalMarks,internalMax:u.hasInternalMarks?Number(u.internalMax):0,externalMax:Number(u.externalMax),totalMax:C,date:u.date});if(_&&_.error)throw new Error(_.error);return _}),s({type:"success",text:"Exam created successfully"}),setTimeout(()=>s(null),3e3);const O=await Sa();l(Array.isArray(O)?O:[]),d(!1),m({examType:"",class:"",subject:"",hasInternalMarks:!0,internalMax:20,externalMax:80,date:Ve()})}catch(C){console.error("Error creating exam:",C),R(`Failed to create exam: ${C.message||"Unknown error"}`)}},ae=async()=>{try{$(!0),R("");const C=i.some(_=>_.includes("class teacher")||_==="classteacher")?"classteacher":i.some(_=>_.includes("h m")||_==="hm"||_.includes("headmaster"))?"headmaster":"teacher",O=await Sa({teacherEmail:(e==null?void 0:e.email)||void 0,role:C,classTeacherFor:(e==null?void 0:e.classTeacherFor)||void 0,teacherSubjects:(e==null?void 0:e.subjects)||void 0,class:S.class||void 0,subject:S.subject||void 0,examType:S.examType||void 0,_ts:Date.now()});l(Array.isArray(O)?O:[])}catch(h){console.error("Failed to reload exams",h),R("Failed to load exams: "+(h.message||h))}finally{$(!1)}},V=h=>(h||"").toString().toLowerCase().replace(/\s+/g,"").replace(/[^a-z0-9]/g,""),Q=o.filter(h=>{if(!e)return!1;if(i.some(F=>F.includes("h m")||F==="hm"||F.includes("headmaster")))return!0;const C=V(h.class),O=V(h.subject),_=e.classes&&new Set(e.classes.map(F=>V(F))).has(C),M=e.subjects&&new Set(e.subjects.map(F=>V(F))).has(O);return i.some(F=>F.includes("class teacher")||F==="classteacher")?e.classTeacherFor&&V(e.classTeacherFor)===C||M:_&&M}),de=async h=>{G(h),$(!0),R("");try{const C=await Fs(h.class),O=await ti(h.examId),_={};Array.isArray(O)&&O.forEach(L=>{L&&L.admNo&&(_[L.admNo]=L)});const M=Array.isArray(C)?C.map(L=>{const F=_[L.admNo]||{};return{admNo:L.admNo,studentName:L.name,internal:F.internal||"",external:F.external||"",total:F.total||"",percentage:F.percentage||"",grade:F.grade||""}}):[];B(M),z(!0)}catch(C){console.error("Failed to load students or marks data",C),R(`Error loading marks form: ${C.message||"Unknown error"}`)}finally{$(!1)}},Se=h=>{D({examId:h.examId,class:h.class,subject:h.subject,examType:h.examType,hasInternalMarks:h.hasInternalMarks===!0||String(h.hasInternalMarks).toLowerCase()==="true",internalMax:Number(h.internalMax||0),externalMax:Number(h.externalMax||0),date:pi(h.date)}),ve(!0)},Ae=async h=>{if(h.preventDefault(),!re||!e){R("Missing exam data or user not logged in");return}try{R("");const C=Number(re.internalMax||0)+Number(re.externalMax||0);await r("Updating exam...",async()=>{const O=await Ld({examId:re.examId,userEmail:e.email,class:re.class,subject:re.subject,examType:re.examType,hasInternalMarks:re.hasInternalMarks,internalMax:re.hasInternalMarks?Number(re.internalMax):0,externalMax:Number(re.externalMax),totalMax:C,date:re.date});if(O&&O.error)throw new Error(O.error);return O}),s({type:"success",text:"Exam updated successfully"}),setTimeout(()=>s(null),3e3),ae(),ve(!1),D(null)}catch(C){console.error("Error updating exam:",C),R(`Failed to update exam: ${C.message||"Unknown error"}`)}},Ie=async h=>{G(h),$(!0),R("");try{const C=await Fs(h.class),O=await ti(h.examId),_={};Array.isArray(O)&&O.forEach(L=>{L&&L.admNo&&(_[L.admNo]=L)});const M=Array.isArray(C)?C.map(L=>{const F=_[L.admNo]||{};return{admNo:L.admNo,studentName:L.name,internal:F.internal||"",external:F.external||"",total:F.total||"",percentage:F.percentage||"",grade:F.grade||""}}):[];se(M),oe(h)}catch(C){console.error("Failed to load marks data",C),R(`Error loading marks: ${C.message||"Unknown error"}`)}finally{$(!1)}};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Exam Management"}),a.jsxs("div",{className:"flex space-x-3",children:[e&&i.some(h=>h.includes("h m")||h==="hm"||h.includes("headmaster"))&&a.jsxs("button",{onClick:()=>d(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center hover:bg-blue-700",children:[a.jsx(Wr,{className:"h-4 w-4 mr-2"}),"Create Exam"]}),e&&i.some(h=>h.includes("teacher"))&&a.jsxs("button",{onClick:()=>{if(!Q||Q.length===0){R("No exams available for your classes or subjects to enter marks.");return}Q.length>=1&&de(Q[0])},disabled:!Q||Q.length===0,className:`bg-green-600 text-white px-4 py-2 rounded-lg flex items-center ${!Q||Q.length===0?"opacity-50 cursor-not-allowed hover:bg-green-600":"hover:bg-green-700"}`,children:[a.jsx(Wr,{className:"h-4 w-4 mr-2"}),"Edit Marks"]})]})]}),c&&a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[a.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Create New Exam"}),a.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Exam Type"}),a.jsxs("select",{value:u.examType,onChange:h=>U("examType",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:[a.jsx("option",{value:"",children:"Select Exam Type"}),v.map(h=>a.jsx("option",{value:h.examType,children:h.examType},h.examType))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Class"}),a.jsxs("select",{value:u.class,onChange:h=>U("class",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:[a.jsx("option",{value:"",children:"Select Class"}),f.map(h=>a.jsx("option",{value:h,children:h},h))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject"}),a.jsxs("select",{value:u.subject,onChange:h=>U("subject",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:[a.jsx("option",{value:"",children:"Select Subject"}),y.map(h=>a.jsx("option",{value:h,children:h},h))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),a.jsx("input",{type:"date",value:u.date,onChange:h=>U("date",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center mb-2",children:[a.jsx("input",{type:"checkbox",id:"hasInternalMarks",checked:u.hasInternalMarks,onChange:h=>U("hasInternalMarks",h.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded"}),a.jsx("label",{htmlFor:"hasInternalMarks",className:"ml-2 text-sm font-medium text-gray-700",children:"Internal Marks?"})]}),u.hasInternalMarks&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Internal Max Marks"}),a.jsx("input",{type:"number",value:u.internalMax,onChange:h=>U("internalMax",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",min:"0",required:!0})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"External Max Marks"}),a.jsx("input",{type:"number",value:u.externalMax,onChange:h=>U("externalMax",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",min:"0",required:!0})]})]}),A&&a.jsx("div",{className:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg border border-red-200",children:A}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>{d(!1),R(""),m({examType:"",class:"",subject:"",hasInternalMarks:!0,internalMax:20,externalMax:80,date:Ve()})},className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),a.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium flex items-center",children:[a.jsx("span",{className:"mr-1",children:"✓"})," Create Exam"]})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"text-lg font-semibold",children:"Available Exams"}),b&&a.jsxs("div",{className:"flex items-center text-blue-600",children:[a.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading..."]})]}),a.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[a.jsxs("div",{className:"flex-1 min-w-[180px]",children:[a.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Filter by Class"}),a.jsx("div",{className:"relative",children:a.jsxs("select",{value:S.class,onChange:h=>T({...S,class:h.target.value}),className:"w-full pl-3 pr-10 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500",disabled:b,children:[a.jsx("option",{value:"",children:"All Classes"}),e&&e.classTeacherFor&&i.some(h=>h.includes("class teacher")||h==="classteacher")&&a.jsxs("option",{value:e.classTeacherFor,style:{fontWeight:"bold",backgroundColor:"#e6f2ff"},children:[e.classTeacherFor," (My Class)"]}),f.filter(h=>h!==(e==null?void 0:e.classTeacherFor)).map(h=>a.jsx("option",{value:h,children:h},h))]})})]}),a.jsxs("div",{className:"flex-1 min-w-[180px]",children:[a.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Filter by Subject"}),a.jsx("div",{className:"relative",children:a.jsxs("select",{value:S.subject,onChange:h=>T({...S,subject:h.target.value}),className:"w-full pl-3 pr-10 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500",disabled:b,children:[a.jsx("option",{value:"",children:"All Subjects"}),y.map(h=>a.jsx("option",{value:h,children:h},h))]})})]}),a.jsxs("div",{className:"flex-1 min-w-[180px]",children:[a.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Filter by Exam Type"}),a.jsx("div",{className:"relative",children:a.jsxs("select",{value:S.examType,onChange:h=>T({...S,examType:h.target.value}),className:"w-full pl-3 pr-10 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500",disabled:b,children:[a.jsx("option",{value:"",children:"All Types"}),v.map(h=>a.jsx("option",{value:h.examType,children:h.examType},h.examType))]})})]}),a.jsx("div",{className:"flex items-end",children:a.jsxs("button",{onClick:()=>ae(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",disabled:b,children:[a.jsx(Aa,{className:"w-4 h-4"})," Apply Filters"]})}),a.jsx("div",{className:"flex items-end",children:a.jsxs("button",{onClick:()=>{T({class:"",subject:"",examType:""}),ae()},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 flex items-center gap-2",disabled:b,children:[a.jsx(Ma,{className:"w-4 h-4"})," Reset"]})})]}),A&&a.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-600 rounded-lg border border-red-200",children:A}),b?a.jsxs("div",{className:"text-gray-500 text-center py-12",children:[a.jsx("div",{className:"flex justify-center mb-3",children:a.jsxs("svg",{className:"animate-spin h-10 w-10 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),"Loading exams..."]}):Q&&Q.length>0?a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Exam Name"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Class"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subject"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Max Marks"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Q.map(h=>{const C=i.some(F=>F.includes("class teacher")||F==="classteacher"),O=e.classTeacherFor&&V(e.classTeacherFor)===V(h.class),_=e.subjects&&new Set(e.subjects.map(F=>V(F))).has(V(h.subject));let M="",L=null;return C&&O?(M="border-l-4 border-blue-300",L=a.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 mr-2",children:"Class Teacher"})):_&&(M="border-l-4 border-green-300",L=a.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800 mr-2",children:"Subject Teacher"})),a.jsxs("tr",{className:M,children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap font-medium",children:h.examName||`${h.examType} - ${h.class} - ${h.subject}`}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:h.class}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:h.subject}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:vl(pi(h.date))}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:h.totalMax}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[L,a.jsx("button",{onClick:()=>Ie(h),className:"text-blue-600 hover:text-blue-900 mr-2",children:"View Marks"}),a.jsx("button",{onClick:()=>de(h),className:"text-green-600 hover:text-green-900 mr-2",children:"Edit Marks"}),i.some(F=>F.includes("h m")||F==="hm"||F.includes("headmaster"))&&a.jsx("button",{onClick:()=>Se(h),className:"text-purple-600 hover:text-purple-900",children:"Edit Exam"})]})})]},h.examId)})})]})}):a.jsxs("div",{className:"text-gray-500 text-center py-8 bg-gray-50 rounded-lg",children:[a.jsx("div",{className:"flex justify-center mb-2",children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"w-12 h-12 text-gray-400",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),a.jsx("p",{className:"text-lg font-medium",children:"No exams available for you to manage."}),a.jsx("p",{className:"mt-1 text-sm",children:"Try adjusting your filters or check back later."})]})]}),I&&N&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 max-w-5xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("h2",{className:"text-xl font-semibold mb-4 flex justify-between items-center",children:[a.jsxs("span",{children:["Enter Marks: ",N.examName||`${N.examType} - ${N.class} - ${N.subject}`]}),a.jsx("button",{onClick:()=>z(!1),className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),a.jsxs("div",{className:"mb-4 flex justify-between items-center",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:[a.jsx("span",{className:"font-medium",children:"Max Marks:"})," ",N.totalMax,N.hasInternalMarks!==!1&&a.jsxs("span",{children:["(Internal: ",N.internalMax||0,", External: ",N.externalMax||0,")"]}),N.hasInternalMarks===!1&&a.jsxs("span",{children:["(External only: ",N.externalMax||0,")"]})]}),a.jsx("div",{className:"flex space-x-2",children:a.jsx("button",{onClick:P,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",disabled:b,children:"Save Marks"})})]}),A&&a.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-600 rounded-lg border border-red-200",children:A}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Adm. No"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student Name"}),(N.hasInternalMarks===!0||String(N.hasInternalMarks).toLowerCase()==="true")&&Number(N.internalMax)>0&&a.jsxs("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:["Internal (",N.internalMax,")"]}),a.jsxs("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:["External (",N.externalMax||0,")"]}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"%"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Grade"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Y.map((h,C)=>a.jsxs("tr",{className:C%2===0?"bg-white":"bg-gray-50",children:[a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:h.admNo}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:h.studentName}),(N.hasInternalMarks===!0||String(N.hasInternalMarks).toLowerCase()==="true")&&Number(N.internalMax)>0&&a.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:a.jsx("input",{type:"number",min:"0",max:N.internalMax,value:h.internal,onChange:O=>xe(C,"internal",O.target.value),className:"w-16 px-2 py-1 border border-gray-300 rounded-md"})}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:a.jsx("input",{type:"number",min:"0",max:N.externalMax||0,value:h.external,onChange:O=>xe(C,"external",O.target.value),className:"w-16 px-2 py-1 border border-gray-300 rounded-md"})}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:we(h,N)}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:Fe(h,N.totalMax,N)}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:qe(Fe(h,N.totalMax,N))})]},h.admNo))})]})})]})}),ge&&re&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-2xl",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Edit Exam Details"}),a.jsx("button",{onClick:()=>ve(!1),className:"text-gray-500 hover:text-gray-800",children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsxs("form",{onSubmit:Ae,children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Class"}),a.jsxs("select",{value:re.class,onChange:h=>D({...re,class:h.target.value}),className:"w-full p-2 border rounded-md",required:!0,children:[a.jsx("option",{value:"",children:"Select Class"}),f.map(h=>a.jsx("option",{value:h,children:h},h))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject"}),a.jsxs("select",{value:re.subject,onChange:h=>D({...re,subject:h.target.value}),className:"w-full p-2 border rounded-md",required:!0,children:[a.jsx("option",{value:"",children:"Select Subject"}),y.map(h=>a.jsx("option",{value:h,children:h},h))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Exam Type"}),a.jsxs("select",{value:re.examType,onChange:h=>D({...re,examType:h.target.value}),className:"w-full p-2 border rounded-md",required:!0,children:[a.jsx("option",{value:"",children:"Select Exam Type"}),v.map(h=>a.jsx("option",{value:h.examType,children:h.examType},h.examType))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Exam Date"}),a.jsx("input",{type:"date",value:re.date?new Date(re.date).toISOString().split("T")[0]:"",onChange:h=>D({...re,date:h.target.value}),className:"w-full p-2 border rounded-md",required:!0})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center mb-2",children:[a.jsx("input",{type:"checkbox",id:"editHasInternalMarks",checked:re.hasInternalMarks,onChange:h=>D({...re,hasInternalMarks:h.target.checked}),className:"mr-2"}),a.jsx("label",{htmlFor:"editHasInternalMarks",className:"text-sm font-medium text-gray-700",children:"Has Internal Marks?"})]}),a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:re.hasInternalMarks?"External Maximum Marks":"Maximum Marks"}),a.jsx("input",{type:"number",min:"0",value:re.externalMax,onChange:h=>D({...re,externalMax:h.target.value}),className:"w-full p-2 border rounded-md",required:!0})]}),re.hasInternalMarks&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Internal Maximum Marks"}),a.jsx("input",{type:"number",min:"0",value:re.internalMax,onChange:h=>D({...re,internalMax:h.target.value}),className:"w-full p-2 border rounded-md",required:!0})]})]}),a.jsxs("div",{className:"flex justify-end mt-6 gap-2",children:[a.jsx("button",{type:"button",onClick:()=>ve(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Cancel"}),a.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Update Exam"})]})]}),A&&a.jsx("div",{className:"mt-4 p-3 bg-red-100 text-red-700 rounded-lg",children:A})]})}),W&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 max-w-5xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("h2",{className:"text-xl font-semibold mb-4 flex justify-between items-center",children:[a.jsxs("span",{children:["View Marks: ",W.examName||`${W.examType} - ${W.class} - ${W.subject}`]}),a.jsx("button",{onClick:()=>oe(null),className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),a.jsx("div",{className:"mb-4",children:a.jsxs("div",{className:"text-sm text-gray-600",children:[a.jsx("span",{className:"font-medium",children:"Max Marks:"})," ",W.totalMax,W.hasInternalMarks!==!1&&a.jsxs("span",{children:["(Internal: ",W.internalMax||0,", External: ",W.externalMax||0,")"]}),W.hasInternalMarks===!1&&a.jsxs("span",{children:["(External only: ",W.externalMax||0,")"]})]})}),A&&a.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-600 rounded-lg border border-red-200",children:A}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Adm No"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student Name"}),(W.hasInternalMarks===!0||String(W.hasInternalMarks).toLowerCase()==="true")&&Number(W.internalMax)>0&&a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Internal"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"External"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Percentage"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Grade"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:ce.map((h,C)=>a.jsxs("tr",{className:C%2===0?"bg-white":"bg-gray-50",children:[a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:h.admNo}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:h.studentName}),(W.hasInternalMarks===!0||String(W.hasInternalMarks).toLowerCase()==="true")&&Number(W.internalMax)>0&&a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:h.internal||"-"}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:h.external||"-"}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:h.total||"-"}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:h.percentage?h.percentage+"%":"-"}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:h.grade||"-"})]},h.admNo))})]})})]})})]});function xe(h,C,O){const _=[...Y];_[h][C]=O,B(_)}function we(h,C=N){const O=C&&C.hasInternalMarks!==!1&&Number(h.internal)||0,_=Number(h.external)||0;return O+_}function Fe(h,C,O=N){if(!C)return"";const _=we(h,O);return Math.round(_/C*100)}function qe(h){return!h&&h!==0?"":h>=90?"A+":h>=80?"A":h>=70?"B+":h>=60?"B":h>=50?"C+":h>=40?"C":h>=33?"D":"F"}async function P(){if(!(!N||!e))try{$(!0),R("");const h=Y.map(O=>({admNo:O.admNo,studentName:O.studentName,internal:Number(O.internal)||0,external:Number(O.external)||0})),C=await Id({examId:N.examId,class:N.class,subject:N.subject,teacherEmail:e.email,teacherName:e.name||e.email,marks:h});if(C&&(C.ok||C.submitted))s({type:"success",text:"Marks saved successfully"}),setTimeout(()=>s(null),3e3),z(!1);else throw new Error((C==null?void 0:C.error)||"Failed to save marks")}catch(h){console.error("Error submitting marks:",h),R(`Failed to save marks: ${h.message||"Unknown error"}`)}finally{$(!1)}}},lD=({user:e})=>{var b;const[t,r]=x.useState(""),[s,n]=x.useState({students:[],subjects:[]}),[i,o]=x.useState([]),[l,c]=x.useState(!1),[d,u]=x.useState(!0),[m,f]=x.useState(""),[p,v]=x.useState("class"),[g,y]=x.useState(""),w=()=>((e==null?void 0:e.roles)||[]).some(A=>A.toLowerCase().includes("class teacher")||A.toLowerCase().includes("teacher")),j=()=>((e==null?void 0:e.roles)||[]).some(A=>A.toLowerCase().includes("student")),k=()=>{const $=(e==null?void 0:e.roles)||[];return console.log("ReportCard - User roles:",$),console.log("ReportCard - Role checks:",{isStudent:j(),isClassTeacher:w(),isHM:$.some(A=>{const R=A.toLowerCase().trim();return R.includes("hm")||R.includes("h m")||R==="h m"||R.includes("head master")||R.includes("headmaster")||R.includes("admin")})}),$.some(A=>{const R=A.toLowerCase().trim();return R.includes("hm")||R.includes("h m")||R==="h m"||R.includes("head master")||R.includes("headmaster")||R.includes("admin")})};x.useEffect(()=>{(async()=>{try{u(!0),console.log("Loading exams...");const A=await Fd();console.log("Exam data received:",A),Array.isArray(A)?(o(A),console.log(`Loaded ${A.length} exams`)):A&&A.error?(console.error("Backend error:",A.error),f(`Failed to load exams: ${A.error}`),o([])):(console.warn("Invalid exam data format:",A),o([]))}catch(A){console.error("Failed to load exams:",A),f(`Failed to load exams: ${A.message||"Unknown error"}`),o([])}finally{u(!1)}})()},[]),x.useEffect(()=>{console.log("ReportData changed:",s)},[s]);const S=async()=>{try{const $=await kd();console.log("Debug Exam Marks Data:",$),alert("Debug data logged to console. Check browser console for details.")}catch($){console.error("Debug failed:",$),alert("Debug failed: "+$.message)}},T=async()=>{var $;if(!t){f("Please select an exam");return}try{c(!0),f("");let A;if(j())A=await Dr(t,e.admNo||e.email);else if(w())if(p==="class"){const I=(($=e.classes)==null?void 0:$[0])||e.classTeacherFor||"";if(!I){f("No class assigned to you");return}A=await Dr(t,"",I)}else{if(!g){f("Please select a student");return}A=await Dr(t,g)}else if(k())if(p==="class")A=await Dr(t,"");else{if(!g){f("Please select a student");return}A=await Dr(t,g)}else{f("Access denied. Only students, class teachers, and HM can view report cards.");return}const R=A||{students:[],subjects:[]};n({students:Array.isArray(R.students)?R.students:[],subjects:Array.isArray(R.subjects)?R.subjects:[]})}catch(A){console.error("Error loading report card:",A),f(A.message||"Failed to load report card"),n({students:[],subjects:[]})}finally{c(!1)}};return a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex justify-between items-center",children:a.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Report Card"})}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Exam"}),a.jsxs("select",{value:t,onChange:$=>r($.target.value),disabled:d,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[a.jsx("option",{value:"",children:d?"Loading exams...":i.length===0?"No exams available":"Choose exam..."}),i.map($=>a.jsxs("option",{value:$.examId,children:[$.examName," - ",$.class," (",vl($.examDate),")"]},$.examId))]})]}),(w()||k())&&!j()&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"View Mode"}),a.jsxs("select",{value:p,onChange:$=>v($.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"class",children:"Entire Class"}),a.jsx("option",{value:"student",children:"Individual Student"})]})]}),w()&&!j()&&p==="student"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Student Admission No."}),a.jsx("input",{type:"text",value:g,onChange:$=>y($.target.value),placeholder:"Enter admission number...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),a.jsxs("div",{className:"flex gap-4",children:[a.jsx("button",{onClick:T,disabled:l||d||i.length===0,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Loading...":"Generate Report Card"}),a.jsx("button",{onClick:S,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Debug Data"})]}),!d&&i.length===0&&!m&&a.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:a.jsxs("p",{className:"text-yellow-800",children:[a.jsx("strong",{children:"No exams found."})," Please contact your administrator to create exams before generating report cards."]})})]}),m&&a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:a.jsx("p",{className:"text-red-600",children:m})}),s&&s.students&&s.subjects&&s.students.length>0&&s.subjects.length>0&&a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:[a.jsxs("div",{className:"px-6 py-4 border-b",children:[a.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Report Card - ",((b=i.find($=>$.examId===t))==null?void 0:b.examName)||"Selected Exam"]}),a.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[s.students.length," student(s) across ",s.subjects.length," subject(s)"]})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Adm No."}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student Name"}),s.subjects.map($=>a.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:$},$)),a.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Overall"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.students.map(($,A)=>{const I=s.subjects.reduce((Y,B)=>{var N;return Y+(((N=$.subjects[B])==null?void 0:N.total)||0)},0)/s.subjects.length,z=I>=90?"A+":I>=80?"A":I>=70?"B+":I>=60?"B":I>=50?"C+":I>=40?"C":I>=35?"D":"F";return a.jsxs("tr",{className:A%2===0?"bg-white":"bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:$.admNo}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:$.studentName}),s.subjects.map(Y=>{var B,N,G,te,X,W,oe,ce,se;return a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-center",children:a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:"font-medium text-gray-900",children:((B=$.subjects[Y])==null?void 0:B.total)||0}),a.jsx("div",{className:`text-xs px-2 py-1 rounded-full inline-block ${((N=$.subjects[Y])==null?void 0:N.grade)==="A+"?"bg-green-100 text-green-800":((G=$.subjects[Y])==null?void 0:G.grade)==="A"?"bg-green-100 text-green-700":((te=$.subjects[Y])==null?void 0:te.grade)==="B+"||((X=$.subjects[Y])==null?void 0:X.grade)==="B"?"bg-blue-100 text-blue-700":((W=$.subjects[Y])==null?void 0:W.grade)==="C+"||((oe=$.subjects[Y])==null?void 0:oe.grade)==="C"?"bg-yellow-100 text-yellow-700":((ce=$.subjects[Y])==null?void 0:ce.grade)==="D"?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700"}`,children:((se=$.subjects[Y])==null?void 0:se.grade)||"N/A"})]})},Y)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-center",children:a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:"font-medium text-gray-900",children:I.toFixed(1)}),a.jsx("div",{className:`text-xs px-2 py-1 rounded-full inline-block ${z==="A+"?"bg-green-100 text-green-800":z==="A"?"bg-green-100 text-green-700":z==="B+"||z==="B"?"bg-blue-100 text-blue-700":z==="C+"||z==="C"?"bg-yellow-100 text-yellow-700":z==="D"?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700"}`,children:z})]})})]},$.admNo)})})]})}),a.jsx("div",{className:"px-6 py-4 border-t bg-gray-50",children:a.jsx("button",{onClick:()=>window.print(),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Print Report Card"})})]}),!l&&s&&s.students&&s.students.length===0&&t&&!m&&a.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-8 text-center",children:a.jsx("p",{className:"text-gray-600",children:"No report card data found for the selected exam."})})]})},cD=({user:e})=>{const[t,r]=x.useState(null),[s,n]=x.useState([]),[i,o]=x.useState(!0),[l,c]=x.useState(""),[d,u]=x.useState(""),[m,f]=x.useState(""),[p,v]=x.useState(""),[g,y]=x.useState([]),[w,j]=x.useState([]),[k,S]=x.useState([]),[T,b]=x.useState(!1),$=(e==null?void 0:e.email)||"",A=()=>((e==null?void 0:e.roles)||[]).some(G=>{const te=G.toLowerCase().replace(/[^a-z]/g,"");return te==="hm"||te==="headmaster"});x.useEffect(()=>{$&&(I(),A()&&R())},[$,d,m,p]);const R=async()=>{try{const[N,G,te]=await Promise.all([Qd().catch(X=>(console.warn("Failed to load teachers:",X),[])),Va().catch(X=>(console.warn("Failed to load classes:",X),[])),rl().catch(X=>(console.warn("Failed to load subjects:",X),[]))]);y(Array.isArray(N)?N:[]),j(Array.isArray(G)?G:[]),S(Array.isArray(te)?te:[]),b(!0)}catch(N){console.warn("Error loading filter options:",N),y([]),j([]),S([]),b(!0)}},I=async()=>{try{o(!0),c("");let N,G;if(A())try{[N,G]=await Promise.all([Xd(p,d,m).catch(X=>(console.warn("Failed to load HM progress summary:",X),{summary:{},teacherStats:[],details:[]})),Jd(p,d,m).catch(X=>(console.warn("Failed to load HM delays:",X),{delays:[]}))])}catch(X){console.warn("HM API calls failed, falling back to regular teacher view:",X),[N,G]=await Promise.all([ri($,d,m).catch(()=>({summary:{},details:[]})),Ws($,d,m).catch(()=>({delays:[]}))])}else[N,G]=await Promise.all([ri($,d,m).catch(X=>(console.warn("Failed to load progress summary:",X),{summary:{},details:[]})),Ws($,d,m).catch(X=>(console.warn("Failed to load delays:",X),{delays:[]}))]);N!=null&&N.error&&(console.warn("API returned error for summary:",N.error),N={summary:{},details:[]}),G!=null&&G.error&&(console.warn("API returned error for delays:",G.error),G={delays:[]}),r(N||{summary:{},details:[]});let te=[];try{G!=null&&G.delays&&Array.isArray(G.delays)?te=G.delays.filter(X=>X&&typeof X=="object"):Array.isArray(G)?te=G.filter(X=>X&&typeof X=="object"):(console.warn("Unexpected delays data format:",G),te=[])}catch(X){console.warn("Error processing delays data:",X,G),te=[]}n(te)}catch(N){console.error("Error loading progress data:",N),c("Failed to load lesson progress data. Please try again.")}finally{o(!1)}},z=N=>{switch(N){case"Completed":return a.jsx(li,{className:"w-5 h-5 text-green-600"});case"InProgress":return a.jsx(nu,{className:"w-5 h-5 text-blue-600"});case"Delayed":return a.jsx(ui,{className:"w-5 h-5 text-red-600"});default:return a.jsx(ci,{className:"w-5 h-5 text-gray-400"})}},Y=N=>{switch(N){case"Completed":return"bg-green-50 text-green-800 border-green-200";case"InProgress":return"bg-blue-50 text-blue-800 border-blue-200";case"Delayed":return"bg-red-50 text-red-800 border-red-200";default:return"bg-gray-50 text-gray-800 border-gray-200"}},B=N=>{if(!N)return"Not set";try{return new Date(N).toLocaleDateString()}catch{return N}};return i?a.jsxs("div",{className:"flex items-center justify-center py-12",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),a.jsx("div",{className:"ml-3 text-gray-600",children:"Loading lesson progress..."})]}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Lesson Progress Tracker ",A()&&a.jsx("span",{className:"text-sm text-gray-500",children:"(HM View)"})]}),a.jsxs("div",{className:"flex space-x-3",children:[A()&&a.jsxs("div",{className:"flex flex-col",children:[a.jsxs("select",{value:p,onChange:N=>v(N.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm",disabled:!T||g.length===0,children:[a.jsx("option",{value:"",children:T?g.length===0?"Teacher filter unavailable":"All Teachers":"Loading teachers..."}),(g||[]).map(N=>a.jsx("option",{value:(N==null?void 0:N.email)||N,children:(N==null?void 0:N.name)||(N==null?void 0:N.email)||N},(N==null?void 0:N.email)||N))]}),T&&g.length===0&&a.jsx("span",{className:"text-xs text-amber-600 mt-1",children:"Backend update required for teacher filtering"})]}),a.jsxs("select",{value:d,onChange:N=>u(N.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm",children:[a.jsx("option",{value:"",children:"All Classes"}),A()?(w||[]).map(N=>a.jsx("option",{value:N,children:N},N)):((e==null?void 0:e.classes)||[]).map(N=>a.jsx("option",{value:N,children:N},N))]}),a.jsxs("select",{value:m,onChange:N=>f(N.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm",children:[a.jsx("option",{value:"",children:"All Subjects"}),A()?(k||[]).map(N=>a.jsx("option",{value:N,children:N},N)):((e==null?void 0:e.subjects)||[]).map(N=>a.jsx("option",{value:N,children:N},N))]}),a.jsx("button",{onClick:I,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm",children:"Refresh"})]})]}),l&&a.jsx("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg",children:l}),(t==null?void 0:t.summary)&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(Hs,{className:"w-8 h-8 text-green-600"}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Completion Rate"}),a.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[t.summary.completionRate,"%"]})]})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(li,{className:"w-8 h-8 text-green-600"}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Completed"}),a.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[t.summary.completed,"/",t.summary.total]})]})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(ui,{className:"w-8 h-8 text-red-600"}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Delayed"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.summary.delayed})]})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(ci,{className:"w-8 h-8 text-orange-600"}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Delay"}),a.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[t.summary.avgDelayDays," days"]})]})]})})]}),A()&&(t==null?void 0:t.teacherStats)&&Array.isArray(t.teacherStats)&&t.teacherStats.length>0&&a.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[a.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Teacher Performance Overview"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Progress summary by teacher"})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Teacher"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Lessons"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Completion Rate"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Completed"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Delayed"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Avg Delay (Days)"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.teacherStats.map((N,G)=>a.jsxs("tr",{className:G%2===0?"bg-white":"bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:N.teacherName}),a.jsx("div",{className:"text-sm text-gray-500",children:N.teacherEmail})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:N.total}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${Math.min(100,N.completionRate)}%`}})}),a.jsxs("span",{className:"ml-2 text-sm text-gray-900",children:[N.completionRate,"%"]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:a.jsx("span",{className:"text-green-600 font-medium",children:N.completed})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:a.jsx("span",{className:`font-medium ${N.delayed>0?"text-red-600":"text-gray-500"}`,children:N.delayed})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:a.jsx("span",{className:`${Number(N.avgDelayDays)>0?"text-red-600":"text-gray-500"}`,children:N.avgDelayDays})})]},N.teacherEmail))})]})})]}),Array.isArray(s)&&s.length>0&&a.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[a.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Delayed Lessons"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Lessons that are behind schedule and need attention"})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[A()&&a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Teacher"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Class & Subject"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Chapter & Session"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Planned Date"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Days Delayed"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progress"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(s||[]).filter(N=>N&&typeof N=="object").map((N,G)=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[A()&&a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:(N==null?void 0:N.teacherName)||(N==null?void 0:N.teacherEmail)||"Unknown"}),a.jsx("div",{className:"text-sm text-gray-500",children:(N==null?void 0:N.teacherEmail)||""})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:(N==null?void 0:N.class)||"Unknown"}),a.jsx("div",{className:"text-sm text-gray-500",children:(N==null?void 0:N.subject)||"Unknown"})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:N.chapter}),a.jsxs("div",{className:"text-sm text-gray-500",children:["Session ",N.session]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:B(N.plannedDate)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[N.delayDays," days"]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[z(N.status),a.jsx("span",{className:`ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded border ${Y(N.status)}`,children:N.status})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${N.completionPercentage}%`}})}),a.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:[N.completionPercentage,"%"]})]})})]},(N==null?void 0:N.progressId)||`delay-${G}`))})]})})]}),(t==null?void 0:t.details)&&t.details.length>0&&a.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[a.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"All Lesson Progress"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Complete overview of all your lesson plan progress"})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Class & Subject"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Chapter & Session"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Planned Date"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actual Date"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progress"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.details.map((N,G)=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:N.class}),a.jsx("div",{className:"text-sm text-gray-500",children:N.subject})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:N.chapter}),a.jsxs("div",{className:"text-sm text-gray-500",children:["Session ",N.session]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:B(N.plannedDate)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:B(N.actualDate)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[z(N.status),a.jsx("span",{className:`ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded border ${Y(N.status)}`,children:N.status}),N.delayDays>0&&a.jsxs("span",{className:"ml-2 text-xs text-red-600",children:["(+",N.delayDays,"d)"]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${N.completionPercentage}%`}})}),a.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:[N.completionPercentage,"%"]})]})})]},N.progressId||G))})]})})]}),!i&&(!(t!=null&&t.details)||t.details.length===0)&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx(kt,{className:"mx-auto h-12 w-12 text-gray-400"}),a.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No lesson progress data"}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Start submitting daily reports with lesson plans to track your progress."})]})]})},dD=()=>{const[e,t]=x.useState(null),[r,s]=x.useState({lessonPlanningDay:"",allowNextWeekOnly:!1,periodTimes:null}),n=x.useMemo(()=>r||{lessonPlanningDay:"",allowNextWeekOnly:!1,periodTimes:null},[r]);x.useEffect(()=>{const h=C=>{t(C.detail&&C.detail.message?`${C.detail.message}`:String(C.detail||"API error"))};return window.addEventListener("api-error",h),()=>window.removeEventListener("api-error",h)},[]),x.useEffect(()=>{async function h(){try{const C=await Rd();C&&s({lessonPlanningDay:C.lessonPlanningDay||"",allowNextWeekOnly:!1,periodTimes:C.periodTimes||null})}catch(C){console.warn("Error loading app settings:",C)}}h()},[]);const[i,o]=x.useState({active:!1,message:""}),[l,c]=x.useState(null),[d,u]=x.useState(null),[m,f]=x.useState(null),[p,v]=x.useState(!1),g=h=>{f(h),v(!0)},y=()=>{v(!1),f(null)},w=({label:h,value:C})=>a.jsxs("div",{children:[a.jsx("div",{className:"text-xs text-gray-500",children:h}),a.jsx("div",{className:"text-gray-900",children:C??"-"})]}),j=async(h,C)=>{o({active:!0,message:h});try{await C(),c({type:"success",text:h||"Success"}),setTimeout(()=>c(null),1800)}catch(O){throw console.error("submit error",O),window.dispatchEvent(new CustomEvent("api-error",{detail:{message:(O==null?void 0:O.message)||String(O)}})),c({type:"error",text:(O==null?void 0:O.message)||"Error occurred"}),setTimeout(()=>c(null),3e3),O}finally{o({active:!1,message:""})}},k=()=>l?a.jsx("div",{className:"fixed top-4 right-4 z-[1100]",children:a.jsx("div",{className:`px-4 py-2 rounded shadow text-sm ${l.type==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:l.text})}):null,S=()=>i&&i.active?a.jsx("div",{className:"fixed inset-0 z-[1150] flex items-center justify-center bg-black/40",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 flex items-center space-x-4",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),a.jsx("div",{className:"text-sm text-gray-700",children:i.message||"Submitting..."})]})}):null,T=()=>p&&m?a.jsx("div",{className:"fixed inset-0 z-[1250] flex items-center justify-center bg-black/40",children:a.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-xl shadow-lg p-6 mx-4",children:[a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:m.title||m.chapter||m.lpId||m.schemeId||m.class||"Details"}),a.jsx("button",{onClick:y,className:"text-gray-500 hover:text-gray-700",children:a.jsx(nn,{className:"h-5 w-5"})})]}),a.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(w,{label:"Class",value:m.class}),a.jsx(w,{label:"Subject",value:m.subject}),a.jsx(w,{label:"Chapter/Session",value:m.chapter||m.session||""}),a.jsx(w,{label:"Teacher",value:m.teacherName||m.teacher||""}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Objectives"}),a.jsx("div",{className:"mt-1 text-sm text-gray-800 whitespace-pre-wrap",children:m.objectives||"-"}),a.jsx("h4",{className:"text-sm font-medium text-gray-700 mt-3",children:"Activities"}),a.jsx("div",{className:"mt-1 text-sm text-gray-800 whitespace-pre-wrap",children:m.activities||"-"})]})]}),a.jsx("div",{className:"mt-6 flex justify-end",children:a.jsx("button",{onClick:y,className:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300",children:"Close"})})]})}):null,[b,$]=x.useState(null),[A,R]=x.useState(!0),[I,z]=x.useState("dashboard"),[Y,B]=x.useState(!1),[N,G]=x.useState([]),te=h=>(h||"").toString().toLowerCase().trim(),X=h=>{if(!b||!Array.isArray(b.roles))return!1;const C=(h||"").toString().toLowerCase();return b.roles.some(O=>{const _=te(O);return!!(_===C||_.includes(C)||C.replace(/\s+/g,"")===_.replace(/\s+/g,""))})},W=h=>Array.isArray(h)&&h.some(C=>X(C));x.useEffect(()=>{const h=localStorage.getItem("user");h&&$(JSON.parse(h)),R(!1)},[]);const oe=()=>{if(!b)return[];const h=[{id:"dashboard",label:"Dashboard",icon:cu}];return W(["teacher","class teacher"])&&(h.push({id:"schemes",label:"Schemes of Work",icon:ws},{id:"lesson-plans",label:"Lesson Plans",icon:si},{id:"timetable",label:"Timetable",icon:kt},{id:"calendar",label:"Calendar",icon:ni},{id:"reports",label:"Daily Reports",icon:Et},{id:"lesson-progress",label:"Lesson Progress",icon:Hs}),h.push({id:"exam-marks",label:"Exam Marks",icon:ai}),h.push({id:"report-card",label:"Report Card",icon:Et})),W(["daily reporting teachers"])&&h.push({id:"timetable",label:"Timetable",icon:kt},{id:"reports",label:"Daily Reports",icon:Et}),X("class teacher")&&h.push({id:"class-data",label:"Class Data",icon:gu},{id:"class-students",label:"Students",icon:mi}),X("h m")&&(h.push({id:"scheme-approvals",label:"Scheme Approvals",icon:ou},{id:"lesson-approvals",label:"Lesson Approvals",icon:au},{id:"substitutions",label:"Substitutions",icon:cl},{id:"class-period-timetable",label:"Class-Period View",icon:du},{id:"full-timetable",label:"Full Timetable",icon:ni},{id:"calendar",label:"School Calendar",icon:kt},{id:"analytics",label:"Analytics",icon:ii},{id:"exam-marks",label:"Exam Marks",icon:ai},{id:"report-card",label:"Report Card",icon:Et}),h.push({id:"all-plans",label:"All Plans",icon:iu},{id:"daily-reports-management",label:"All Reports",icon:Et},{id:"lesson-progress",label:"Lesson Progress",icon:Hs})),W(["student"])&&h.push({id:"report-card",label:"My Report Card",icon:Et}),h},ce=()=>{const[h,C]=x.useState({planCount:0,lessonCount:0,teacherCount:0,classCount:0,subjectCount:0,pendingReports:0});return x.useEffect(()=>{async function O(){try{if(!b)return;if(X("h m")){const _=await Md(),M=await Va();C(L=>({...L,planCount:(_==null?void 0:_.planCount)||0,lessonCount:(_==null?void 0:_.lessonCount)||0,teacherCount:(_==null?void 0:_.teacherCount)||0,classCount:Array.isArray(M)?M.length:0}))}else if(W(["teacher","class teacher","daily reporting teachers"])){const _=Array.isArray(b.classes)?b.classes.length:0,M=Array.isArray(b.subjects)?b.subjects.length:0;let L=0;try{const F=Ve(),H=await tl(b.email,F);Array.isArray(H)&&(L=H.filter(q=>String(q.status||"").toLowerCase()!=="submitted").length)}catch(F){console.warn("Unable to fetch teacher daily reports:",F)}C(F=>({...F,classCount:_,subjectCount:M,pendingReports:L}))}}catch(_){console.error("Error loading dashboard data:",_)}}O()},[b]),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),a.jsx("div",{className:"flex items-center space-x-4",children:a.jsx("button",{className:"p-2 bg-blue-100 rounded-lg",children:a.jsx(ru,{className:"w-5 h-5 text-blue-600"})})})]}),b&&X("h m")?a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 md:gap-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm p-4 md:p-6 border border-gray-100 mobile-p-2",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:a.jsx(ws,{className:"w-6 h-6 text-blue-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Schemes"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.planCount})]})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:a.jsx(si,{className:"w-6 h-6 text-green-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Lessons"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.lessonCount})]})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:a.jsx(mi,{className:"w-6 h-6 text-purple-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Teachers"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.teacherCount})]})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-3 bg-orange-100 rounded-lg",children:a.jsx(kt,{className:"w-6 h-6 text-orange-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Classes"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.classCount})]})]})})]}):b&&W(["teacher","class teacher","daily reporting teachers"])?a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:a.jsx(fu,{className:"w-6 h-6 text-blue-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Classes Teaching"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.classCount})]})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:a.jsx(ws,{className:"w-6 h-6 text-green-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Subjects"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.subjectCount})]})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:a.jsx(Et,{className:"w-6 h-6 text-purple-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Reports"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.pendingReports})]})]})})]}):a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[a.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Welcome, ",b==null?void 0:b.name]}),a.jsx("p",{className:"text-gray-600",children:"Use the navigation menu to access your school workflow tools."})]}),b&&X("h m")&&a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[a.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Submission Trends"}),a.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 rounded-lg",children:a.jsx("p",{className:"text-gray-500",children:"Submission trends chart would appear here"})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[a.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Approval Rates"}),a.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 rounded-lg",children:a.jsx("p",{className:"text-gray-500",children:"Approval rates chart would appear here"})})]})]})]})},se=Ka(),[ge,ve]=x.useState(null),re=(se==null?void 0:se.user)||ge||b,D=h=>{const C=Array.isArray(h.roles)?h.roles:h.roles?String(h.roles).split(",").map(_=>_.trim()).filter(Boolean):[],O={...h,roles:C};ve(O),$(O)};x.useEffect(()=>{if(se!=null&&se.user){const h=se.user,C=Array.isArray(h.roles)?h.roles:h.roles?String(h.roles).split(",").map(O=>O.trim()).filter(Boolean):[];$(O=>!O||O.email!==h.email?{...h,roles:C}:O)}},[se==null?void 0:se.user]);const U=()=>a.jsx(Pu,{transitionKey:I,children:(()=>{switch(I){case"dashboard":return a.jsx(ce,{});case"schemes":return a.jsx(Z,{});case"lesson-plans":return a.jsx(ae,{});case"timetable":return a.jsx(V,{});case"calendar":return a.jsx(iD,{user:b});case"reports":return a.jsx(de,{});case"lesson-progress":return a.jsx(cD,{user:b});case"hm-dashboard":return a.jsx(ce,{});case"day-timetable":return a.jsx(Q,{periodTimes:n.periodTimes});case"scheme-approvals":return a.jsx(Se,{});case"lesson-approvals":return a.jsx(Ae,{});case"substitutions":return a.jsx(Ou,{user:b,periodTimes:n.periodTimes});case"full-timetable":return a.jsx(Ie,{});case"analytics":return a.jsx(xe,{});case"exam-marks":return a.jsx(oD,{user:b,withSubmit:j,setToast:c});case"report-card":return a.jsx(lD,{user:b});case"class-data":return a.jsx(we,{});case"class-students":return a.jsx(Fe,{});case"all-plans":return a.jsx(qe,{});case"daily-reports-management":return a.jsx(P,{});case"class-period-timetable":return a.jsx(Iu,{user:b,periodTimes:n.periodTimes});default:return a.jsx(ce,{})}})()}),Z=()=>{var H,q;const[h,C]=x.useState([]),[O,_]=x.useState(!1),[M,L]=x.useState({class:"",subject:"",term:"",unit:"",chapter:"",month:"",noOfSessions:""}),F=async ee=>{if(ee.preventDefault(),!!b)try{await j("Submitting scheme...",()=>bd(b.email,{teacherName:b.name||"",class:M.class,subject:M.subject,term:M.term,unit:M.unit,chapter:M.chapter,month:M.month,noOfSessions:M.noOfSessions}));const me=await bs(b.email);C(Array.isArray(me)?me:[])}catch(me){console.error("Failed to submit scheme:",me)}finally{_(!1),L({class:"",subject:"",term:"",unit:"",chapter:"",month:"",noOfSessions:""})}};return x.useEffect(()=>{async function ee(){try{if(!b)return;const me=await bs(b.email);C(Array.isArray(me)?me:[])}catch(me){console.error(me)}}ee()},[b]),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Schemes of Work"}),a.jsxs("button",{onClick:()=>_(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center hover:bg-blue-700",children:[a.jsx(Wr,{className:"h-4 w-4 mr-2"}),"New Scheme"]})]}),O&&a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[a.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Submit New Scheme of Work"}),a.jsxs("form",{onSubmit:F,className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mobile-stack",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Class"}),a.jsxs("select",{value:M.class,onChange:ee=>L({...M,class:ee.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:[a.jsx("option",{value:"",children:"Select Class"}),(H=b==null?void 0:b.classes)==null?void 0:H.map(ee=>a.jsx("option",{value:ee,children:ee},ee))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject"}),a.jsxs("select",{value:M.subject,onChange:ee=>L({...M,subject:ee.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:[a.jsx("option",{value:"",children:"Select Subject"}),(q=b==null?void 0:b.subjects)==null?void 0:q.map(ee=>a.jsx("option",{value:ee,children:ee},ee))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Term"}),a.jsxs("select",{value:M.term,onChange:ee=>L({...M,term:ee.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:[a.jsx("option",{value:"",children:"Select Term"}),a.jsx("option",{value:"1",children:"Term 1"}),a.jsx("option",{value:"2",children:"Term 2"}),a.jsx("option",{value:"3",children:"Term 3"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unit"}),a.jsx("input",{type:"number",value:M.unit,onChange:ee=>L({...M,unit:ee.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Chapter"}),a.jsx("input",{type:"text",value:M.chapter,onChange:ee=>L({...M,chapter:ee.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Month"}),a.jsxs("select",{value:M.month,onChange:ee=>L({...M,month:ee.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:[a.jsx("option",{value:"",children:"Select Month"}),a.jsx("option",{value:"January",children:"January"}),a.jsx("option",{value:"February",children:"February"}),a.jsx("option",{value:"March",children:"March"}),a.jsx("option",{value:"April",children:"April"}),a.jsx("option",{value:"May",children:"May"}),a.jsx("option",{value:"June",children:"June"}),a.jsx("option",{value:"July",children:"July"}),a.jsx("option",{value:"August",children:"August"}),a.jsx("option",{value:"September",children:"September"}),a.jsx("option",{value:"October",children:"October"}),a.jsx("option",{value:"November",children:"November"}),a.jsx("option",{value:"December",children:"December"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"No. of Sessions"}),a.jsx("input",{type:"number",value:M.noOfSessions,onChange:ee=>L({...M,noOfSessions:ee.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0})]}),a.jsxs("div",{className:"md:col-span-2 flex justify-end space-x-3 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>_(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),a.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Submit Scheme"})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:a.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Submitted Schemes"})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Class"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subject"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Chapter"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Month"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),a.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[h.map(ee=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ee.class}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ee.subject}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ee.chapter}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ee.month}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${ee.status==="Pending"?"bg-yellow-100 text-yellow-800":ee.status==="Approved"?"bg-green-100 text-green-800":ee.status==="Rejected"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:ee.status})}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[a.jsx("button",{type:"button",className:"text-blue-600 hover:text-blue-900 mr-3",onClick:()=>g(ee),title:"View scheme",children:a.jsx(Ft,{className:"h-4 w-4"})}),a.jsx("button",{className:"text-red-600 hover:text-red-900",children:a.jsx(ll,{className:"h-4 w-4"})})]})]},ee.schemeId||ee.id)),h.length===0&&a.jsx("tr",{children:a.jsx("td",{colSpan:6,className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center",children:"No schemes submitted yet."})})]})]})})]})]})},ae=()=>{const[h,C]=x.useState([]),[O,_]=x.useState([]),[M,L]=x.useState([]),[F,H]=x.useState(null),[q,ee]=x.useState(!1),[me,Oe]=x.useState({schemeId:"",session:"1",objectives:"",activities:"",notes:""}),Mt=J=>{if(!J&&J!==0)return"";const he=String(J),be=he.toLowerCase().replace(/[^a-z]/g,""),ne=[{k:"mon",v:"Monday"},{k:"tue",v:"Tuesday"},{k:"wed",v:"Wednesday"},{k:"thu",v:"Thursday"},{k:"fri",v:"Friday"},{k:"sat",v:"Saturday"},{k:"sun",v:"Sunday"}];for(const{k:Ce,v:Pe}of ne)if(be.includes(Ce))return Pe;return he.charAt(0).toUpperCase()+he.slice(1)},[Pt,kr]=x.useState({lessonPlanningDay:"",allowNextWeekOnly:!1,periodTimes:null}),Qt=x.useMemo(()=>Pt||{lessonPlanningDay:"",allowNextWeekOnly:!1,periodTimes:null},[Pt]),[Cr,ye]=x.useState(!1),[le,Ee]=x.useState(!1),ue=J=>(J||"").toString().toLowerCase().replace(/\s+/g,"").replace(/[^a-z0-9]/g,"");x.useEffect(()=>{async function J(){try{if(!b)return;const he=await Is(b.email);C(Array.isArray(he)?he:[]);const be=await ys(b.email);_(Array.isArray(be)?be:[]);try{const ne=await Hd();let Ce=[];Array.isArray(ne)&&(Array.isArray(b.classes)&&Array.isArray(b.subjects)?Ce=ne.filter(Pe=>{const vt=b.classes.some(Ue=>ue(Ue)===ue(Pe.class)),Re=b.subjects.some(Ue=>ue(Ue)===ue(Pe.subject));return vt&&Re&&String(Pe.status||"").toLowerCase()==="approved"}):Ce=ne.filter(Pe=>String(Pe.status||"").toLowerCase()==="approved")),L(Ce)}catch(ne){console.warn("Error loading approved schemes:",ne);try{const Ce=await bs(b.email),Pe=Array.isArray(Ce)?Ce.filter(vt=>String(vt.status||"").toLowerCase()==="approved"):[];L(Pe)}catch(Ce){console.warn("Error loading teacher schemes:",Ce),L([])}}kr({lessonPlanningDay:n.lessonPlanningDay||"",allowNextWeekOnly:!1,periodTimes:n.periodTimes||null}),ye(!0)}catch(he){console.error(he)}}J()},[b]);const lt=J=>{const be=new Date().toLocaleDateString("en-US",{weekday:"long"}),ne=Mt(Qt.lessonPlanningDay||""),Ce=ne?Mt(be)===ne:!0,Pe=O.find(Re=>ue(Re.class)===ue(J.class)&&ue(Re.subject)===ue(J.subject)&&Number(Re.session)===Number(J.period)&&String(Re.date||"")===String(J.date||""));if(Cr){if(!Pe&&!Ce){Ee(!0),c({type:"error",text:`Lesson planning is only allowed on ${ne||"the configured day"}.`}),setTimeout(()=>c(null),3e3);return}}Ee(!1),H(J),ee(!0);const vt=M.filter(Re=>ue(Re.class)===ue(J.class)&&ue(Re.subject)===ue(J.subject));if(Pe)Oe({schemeId:Pe.schemeId||"",session:String(Pe.session||"1"),objectives:Pe.objectives||"",activities:Pe.activities||"",notes:Pe.notes||""});else{const Re=vt.length>0?vt[0].schemeId:"";Oe({schemeId:Re,session:String(J.period),objectives:"",activities:"",notes:""})}},Ot=J=>{const he=M.find(be=>be.schemeId===J);Oe(he?be=>({...be,schemeId:J,session:String((F==null?void 0:F.period)||1)}):be=>({...be,schemeId:J}))},Zt=J=>{if(!F)return;const he=O.find(be=>ue(be.class)===ue(F.class)&&ue(be.subject)===ue(F.subject)&&Number(be.session)===Number(J)&&String(be.date||"")===String(F.date||""));Oe(he?be=>({...be,session:String(J),objectives:he.objectives||"",activities:he.activities||""}):be=>({...be,session:String(J),objectives:"",activities:""}))},ct=async J=>{if(J.preventDefault(),!F)return;const he=M.find(ne=>ne.schemeId===me.schemeId),be=(he==null?void 0:he.chapter)||"";if(!F.lpId){const ne=ue(F.class),Ce=ue(F.subject),Pe=Number(me.session||F.period);if(O.find(Re=>{const Ue=M.find(id=>id.schemeId===Re.schemeId),Rt=(Ue==null?void 0:Ue.chapter)||"";return ue(Re.class)===ne&&ue(Re.subject)===Ce&&Number(Re.session)===Pe&&String(Re.date||"")===String(F.date||"")&&Rt===be})){c({type:"error",text:"A lesson plan already exists for this class/subject/session/date/chapter combination. Duplicate not allowed."}),setTimeout(()=>c(null),3e3);return}}try{if(await j("Submitting lesson plan...",async()=>{const ne=await Nd(F.lpId,{class:F.class,subject:F.subject,session:Number(me.session||F.period),date:F.date,schemeId:me.schemeId,objectives:me.objectives,activities:me.activities,notes:me.notes,teacherEmail:(b==null?void 0:b.email)||"",teacherName:(b==null?void 0:b.name)||""});if(ne&&ne.error)throw new Error(ne.error);return ne}),b){const ne=await ys(b.email);_(Array.isArray(ne)?ne:[])}ee(!1),H(null),Oe({schemeId:"",session:"1",objectives:"",activities:"",notes:""})}catch(ne){if(console.error("Error submitting lesson plan details:",ne),String(ne.message||"").toLowerCase().indexOf("duplicate")!==-1)try{if(b){const Ce=await ys(b.email);_(Array.isArray(Ce)?Ce:[]);const Pe=(F.class||"").toString().toLowerCase().replace(/\s+/g,"").replace(/[^a-z0-9]/g,""),vt=(F.subject||"").toString().toLowerCase().replace(/\s+/g,"").replace(/[^a-z0-9]/g,""),Re=Number(me.session||F.period),Ue=(Ce||[]).find(Rt=>(Rt.class||"").toString().toLowerCase().replace(/\s+/g,"").replace(/[^a-z0-9]/g,"")===Pe&&(Rt.subject||"").toString().toLowerCase().replace(/\s+/g,"").replace(/[^a-z0-9]/g,"")===vt&&Number(Rt.session)===Re);if(Ue){H({class:Ue.class,subject:Ue.subject,period:Ue.session,date:Ve(),day:new Date().toLocaleDateString("en-US",{weekday:"long"}),lpId:Ue.lpId}),Oe(Rt=>({...Rt,schemeId:me.schemeId||"",session:String(Ue.session||"1"),objectives:Ue.objectives||"",activities:Ue.activities||"",notes:""})),ee(!0),c({type:"error",text:"Duplicate detected: opened existing lesson plan for editing."}),setTimeout(()=>c(null),3e3);return}}}catch(Ce){console.warn("Failed to recover from duplicate error:",Ce)}ee(!1),H(null),Oe({schemeId:"",session:"1",objectives:"",activities:"",notes:""})}};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Lesson Plans"}),a.jsx("div",{className:"flex space-x-3",children:a.jsxs("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center hover:bg-blue-700",children:[a.jsx(pa,{className:"h-4 w-4 mr-2"}),"Export"]})})]}),q&&F&&a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[a.jsxs("h2",{className:"text-lg font-semibold mb-4",children:["Prepare Lesson Plan for ",F.class," - ",F.subject]}),a.jsxs("div",{className:"flex justify-between items-center mb-4 p-3 bg-blue-50 rounded-lg",children:[a.jsx("div",{children:a.jsxs("p",{className:"text-sm text-blue-800",children:[a.jsx("strong",{children:"Date:"})," ",F.date," (",F.day,")"]})}),a.jsx("div",{children:a.jsxs("p",{className:"text-sm text-blue-800",children:[a.jsxs("strong",{children:["Period ",F.period,":"]})," ",Ur(F.period,n.periodTimes)]})})]}),a.jsx("div",{className:"mb-4 p-3 bg-yellow-50 rounded-lg",children:a.jsxs("p",{className:"text-sm text-yellow-800",children:[a.jsx("strong",{children:"Note:"})," This lesson plan applies only to this specific period. You'll need to create separate lesson plans for other periods of the same class."]})}),a.jsxs("form",{onSubmit:ct,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Approved Scheme of Work"}),a.jsxs("select",{value:me.schemeId,onChange:J=>Ot(J.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:[a.jsx("option",{value:"",children:"Select Approved Scheme"}),M.filter(J=>ue(J.class)===ue(F.class)&&ue(J.subject)===ue(F.subject)).map(J=>a.jsxs("option",{value:J.schemeId,children:[J.chapter," - ",J.month," (",J.noOfSessions," sessions)"]},J.schemeId))]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select from approved schemes for this class and subject"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Session"}),a.jsx("select",{value:me.session,onChange:J=>Zt(J.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:(()=>{const J=M.find(ne=>ne.schemeId===me.schemeId),he=J?Number(J.noOfSessions||1):1,be=[];for(let ne=1;ne<=he;ne++)be.push(a.jsxs("option",{value:String(ne),children:["Session ",ne," - ",J?J.chapter:""]},ne));return be})()})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Learning Objectives"}),a.jsx("textarea",{value:me.objectives,onChange:J=>Oe(he=>({...he,objectives:J.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",rows:"3",placeholder:"What students should learn...",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Activities/Methods"}),a.jsx("textarea",{value:me.activities,onChange:J=>Oe(he=>({...he,activities:J.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",rows:"4",placeholder:"Teaching methods, activities, resources...",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Additional Notes"}),a.jsx("textarea",{value:me.notes,onChange:J=>Oe(he=>({...he,notes:J.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",rows:"2",placeholder:"Any additional information..."})]}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>{ee(!1),H(null)},className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),a.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Submit for Review"})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[a.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[a.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Upcoming Timetable Slots"}),a.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Prepare lesson plans for your scheduled classes"})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Day"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Period"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Class"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subject"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.flatMap(J=>J.periods.map((he,be)=>{const ne=O.find(Ce=>ue(Ce.class)===ue(he.class)&&ue(Ce.subject)===ue(he.subject)&&Number(Ce.session)===Number(he.period)&&String(Ce.date||"")===String(J.date||""));return a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:J.date}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:J.day}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:he.period}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:he.class}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:he.subject}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:ne?a.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${ne.status==="Pending Preparation"?"bg-yellow-100 text-yellow-800":ne.status==="Pending Review"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:ne.status}):a.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800",children:"Not Prepared"})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.jsx("button",{onClick:()=>lt({...he,date:J.date,day:J.day,lpId:(ne==null?void 0:ne.lpId)||`lp-${Date.now()}`}),className:`${ne&&ne.status!=="Pending Preparation"&&ne.status!=="Needs Rework"?"bg-gray-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"} text-white px-3 py-1 rounded text-sm`,disabled:ne&&ne.status!=="Pending Preparation"&&ne.status!=="Needs Rework",children:ne?"Edit":"Prepare"})})]},`${J.date}-${be}`)}))})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden mt-6",children:[a.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[a.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Your Submitted Lesson Plans"}),a.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"View and manage all your submitted lesson plans"})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Class"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subject"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Chapter"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Session"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),a.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[O.map(J=>{const he=M.find(be=>be.schemeId===J.schemeId);return a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:J.class}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:J.subject}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:he?he.chapter:"N/A"}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:J.session}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${J.status==="Pending Preparation"?"bg-yellow-100 text-yellow-800":J.status==="Pending Review"?"bg-blue-100 text-blue-800":J.status==="Ready"?"bg-green-100 text-green-800":J.status==="Needs Rework"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:J.status})}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[a.jsx("button",{onClick:()=>lt({class:J.class,subject:J.subject,period:J.session,date:Ve(),day:new Date().toLocaleDateString("en-US",{weekday:"long"}),lpId:J.lpId}),className:`${J.status!=="Pending Preparation"&&J.status!=="Needs Rework"?"bg-gray-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"} text-white px-3 py-1 rounded text-sm mr-2`,disabled:J.status!=="Pending Preparation"&&J.status!=="Needs Rework",children:"Edit"}),a.jsx("button",{type:"button",className:"text-blue-600 hover:text-blue-900",onClick:()=>g(J),title:"View lesson plan",children:a.jsx(Ft,{className:"h-4 w-4 inline"})})]})]},J.lpId)}),O.length===0&&a.jsx("tr",{children:a.jsx("td",{colSpan:6,className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center",children:"No lesson plans submitted yet."})})]})]})})]})]})},V=()=>{const[h,C]=x.useState([]);x.useEffect(()=>{async function M(){try{if(!b)return;const L=await Is(b.email);C(Array.isArray(L)?L:[])}catch(L){console.error(L)}}M()},[b]);const O=Math.max(0,...h.map(M=>Array.isArray(M.periods)?Math.max(0,...M.periods.map(L=>L.period)):0)),_=Array.from({length:O},(M,L)=>L+1);return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Weekly Timetable"}),a.jsx("div",{className:"flex space-x-3",children:a.jsxs("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center hover:bg-blue-700",children:[a.jsx(pa,{className:"h-4 w-4 mr-2"}),"Export"]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:a.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"This Week"})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Day"}),_.map(M=>a.jsxs("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:["Period ",M]},M))]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map((M,L)=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:M.day}),_.map(F=>{const H=Array.isArray(M.periods)?M.periods.find(q=>q.period===F):void 0;return a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:H?`${H.class} - ${H.subject}`:""},F)})]},L))})]})})]})]})},Q=({periodTimes:h})=>{const[C,O]=x.useState([]),[_,M]=x.useState(dn(Ve())),[L,F]=x.useState(!1),H=h;return x.useEffect(()=>{async function q(){try{F(!0);const ee=await al(_);let me=[];Array.isArray(ee)?me=ee:ee&&Array.isArray(ee.timetable)&&(me=ee.timetable),O(me)}catch(ee){console.error("Failed to load day timetable",ee),O([])}finally{F(!1)}}q()},[_]),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Day Timetable"}),a.jsx("div",{className:"flex items-center space-x-2",children:a.jsx("input",{type:"date",value:_,onChange:q=>M(q.target.value),className:"px-3 py-2 border rounded"})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:a.jsxs("h2",{className:"text-lg font-medium text-gray-900",children:["Timetable for ",formatLocalDate(_,{year:"numeric",month:"short",day:"numeric",weekday:"long"})]})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Period"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Class"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Teacher"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subject"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:L?a.jsx("tr",{children:a.jsx("td",{colSpan:6,className:"px-6 py-4 text-center",children:"Loading..."})}):C.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:6,className:"px-6 py-4 text-center",children:"No timetable entries for this date."})}):C.map((q,ee)=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:q.period}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:Ur(q.period,H)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:q.class}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:q.teacher||q.teacherName||""}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:q.subject||q.regularSubject||q.substituteSubject||""}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:q.isSubstitution?"Substitution":"Regular"})]},ee))})]})})]})]})},de=()=>a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Daily Reports"}),a.jsx("div",{className:"text-sm text-gray-600",children:"Complete your daily reports based on your timetable"})]}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:a.jsx(Lu,{user:b})})]}),Se=()=>{const[h,C]=x.useState([]);x.useEffect(()=>{async function M(){try{const L=await wd(1,50,"","","","");C(Array.isArray(L==null?void 0:L.plans)?L.plans:[])}catch(L){console.error(L)}}M()},[]);const O=async M=>{try{await j("Approving scheme...",()=>ei(M,"Approved")),C(h.filter(L=>L.schemeId!==M))}catch(L){console.error(L)}},_=async M=>{try{await j("Rejecting scheme...",()=>ei(M,"Rejected")),C(h.filter(L=>L.schemeId!==M))}catch(L){console.error(L)}};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Scheme Approvals"}),a.jsx("div",{className:"flex space-x-3",children:a.jsxs("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center hover:bg-blue-700",children:[a.jsx(Aa,{className:"h-4 w-4 mr-2"}),"Filter"]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:a.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Pending Schemes of Work"})}),a.jsx("div",{className:"overflow-x-auto responsive-table",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Teacher"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Class"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subject"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Chapter"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sessions"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map(M=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:M.teacherName}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:M.class}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:M.subject}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:M.chapter}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:M.noOfSessions}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[a.jsx("button",{onClick:()=>O(M.schemeId),className:"text-green-600 hover:text-green-900 mr-3 px-3 py-1 bg-green-100 rounded",children:"Approve"}),a.jsx("button",{onClick:()=>_(M.schemeId),className:"text-red-600 hover:text-red-900 px-3 py-1 bg-red-100 rounded",children:"Reject"}),a.jsx("button",{type:"button",onClick:()=>g(M),className:"text-blue-600 hover:text-blue-900 ml-3",title:"View lesson",children:a.jsx(Ft,{className:"h-4 w-4"})})]})]},M.schemeId))})]})})]})]})},Ae=()=>{const[h,C]=x.useState([]);x.useEffect(()=>{async function _(){try{const M=await jd("","","","Pending Review");C(Array.isArray(M)?M:[])}catch(M){console.error(M)}}_()},[]);const O=async(_,M)=>{try{await j("Updating lesson status...",()=>Sd(_,M)),C(h.filter(L=>L.lpId!==_))}catch(L){console.error(L)}};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Lesson Plan Approvals"}),a.jsx("div",{className:"flex space-x-3",children:a.jsxs("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center hover:bg-blue-700",children:[a.jsx(Aa,{className:"h-4 w-4 mr-2"}),"Filter"]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:a.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Pending Lesson Plans"})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Teacher"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Class"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subject"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Chapter"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Session"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map(_=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:_.teacherName}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:_.class}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:_.subject}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:_.chapter}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:_.session}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[a.jsx("button",{onClick:()=>O(_.lpId,"Ready"),className:"text-green-600 hover:text-green-900 mr-3 px-3 py-1 bg-green-100 rounded",children:"Ready"}),a.jsx("button",{onClick:()=>O(_.lpId,"Needs Rework"),className:"text-yellow-600 hover:text-yellow-900 mr-3 px-3 py-1 bg-yellow-100 rounded",children:"Rework"}),a.jsx("button",{onClick:()=>O(_.lpId,"Rejected"),className:"text-red-600 hover:text-red-900 mr-3 px-3 py-1 bg-red-100 rounded",children:"Reject"}),a.jsx("button",{type:"button",className:"text-blue-600 hover:text-blue-900",onClick:()=>g(_),title:"View lesson",children:a.jsx(Ft,{className:"h-4 w-4"})})]})]},_.lpId))})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[a.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Lesson Plan Details"}),h.length===0?a.jsx("p",{className:"text-gray-700",children:"No pending lesson plans."}):a.jsx("p",{className:"text-gray-700",children:"Click the eye icon in the table to open the lesson plan details for any row."})]})]})},Ie=()=>{const[h,C]=x.useState([]),[O,_]=x.useState(""),[M,L]=x.useState(""),[F,H]=x.useState(""),[q,ee]=x.useState(""),[me,Oe]=x.useState([]),[Mt,Pt]=x.useState([]),[kr,Qt]=x.useState([]);x.useEffect(()=>{let le=!1;async function Ee(){try{let ue;if(!!(M||F||q)?ue=await Od(M||"","",F||"",q||""):ue=await Pd(),le)return;const Ot=Array.isArray(ue)?ue:[];C(Ot);const Zt=new Set,ct=new Set,J=new Set;Ot.forEach(he=>{he&&he.day&&J.add(String(he.day)),(he.periods||[]).forEach(be=>{(be.entries||[]).forEach(ne=>{ne.class&&Zt.add(ne.class),ne.teacher&&ct.add(ne.teacher)})})}),Pt(Array.from(Zt).sort()),Qt(Array.from(ct).sort()),Oe(Array.from(J))}catch(ue){if(le)return;console.error(ue),C([]),Pt([]),Qt([]),Oe([])}}return Ee(),()=>{le=!0}},[M,F,q]);const Cr=Math.max(0,...h.map(le=>Array.isArray(le.periods)?Math.max(0,...le.periods.map(Ee=>Ee.period)):0)),ye=Array.from({length:Cr},(le,Ee)=>Ee+1);return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Full School Timetable"}),a.jsx("div",{className:"flex space-x-3",children:a.jsxs("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center hover:bg-blue-700",children:[a.jsx(pa,{className:"h-4 w-4 mr-2"}),"Export"]})})]}),a.jsx("div",{className:"mb-4",children:b&&b.roles&&X("h m")&&a.jsxs("div",{className:"bg-white rounded-lg p-4 flex flex-wrap items-center gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-gray-500",children:"Day"}),a.jsxs("select",{className:"ml-2 px-2 py-1 border rounded",value:O,onChange:le=>_(le.target.value),children:[a.jsx("option",{value:"",children:"All"}),me.map(le=>a.jsx("option",{value:le,children:le},le))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-gray-500",children:"Class"}),a.jsxs("select",{className:"ml-2 px-2 py-1 border rounded",value:M,onChange:le=>L(le.target.value),children:[a.jsx("option",{value:"",children:"All"}),Mt.map(le=>a.jsx("option",{value:le,children:le},le))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-gray-500",children:"Teacher"}),a.jsxs("select",{className:"ml-2 px-2 py-1 border rounded",value:F,onChange:le=>H(le.target.value),children:[a.jsx("option",{value:"",children:"All"}),kr.map(le=>a.jsx("option",{value:le,children:le},le))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-gray-500",children:"Date"}),a.jsx("input",{type:"date",className:"ml-2 px-2 py-1 border rounded",value:q,onChange:le=>ee(le.target.value)})]}),a.jsx("div",{className:"ml-auto",children:a.jsx("button",{type:"button",className:"px-3 py-1 bg-gray-100 rounded",onClick:()=>{_(""),L(""),H(""),ee("")},children:"Clear"})})]})}),(()=>{const le=h.filter(Ee=>!O||String(Ee.day)===String(O)).map(Ee=>({...Ee,periods:(Ee.periods||[]).map(ue=>({...ue,entries:(ue.entries||[]).filter(lt=>!(M&&lt.class!==M||F&&lt.teacher!==F))}))})).filter(Ee=>(Ee.periods||[]).some(ue=>(ue.entries||[]).length>0)||!O&&!M&&!F&&!q);return le.length===0?a.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6",children:a.jsx("p",{className:"text-gray-700",children:"No timetable entries match the selected filters."})}):a.jsx("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Day"}),ye.map(Ee=>a.jsxs("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:["Period ",Ee]},Ee))]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:le.map((Ee,ue)=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:Ee.day}),ye.map(lt=>{const Ot=Array.isArray(Ee.periods)?Ee.periods.find(ct=>ct.period===lt):void 0,Zt=Ot?(Ot.entries||[]).map(ct=>`${ct.class} - ${ct.subject}${ct.teacher?" ("+ct.teacher+")":""}`).join(`
`):"";return a.jsx("td",{className:"px-6 py-4 whitespace-pre-wrap text-sm text-gray-500",children:Zt},lt)})]},ue))})]})})})})()]})},xe=()=>a.jsxs("div",{className:"space-y-6",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Analytics Dashboard"}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[a.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Submission Trends"}),a.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 rounded-lg",children:a.jsx("p",{className:"text-gray-500",children:"Submission trends chart would appear here"})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[a.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Approval Rates"}),a.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 rounded-lg",children:a.jsx("p",{className:"text-gray-500",children:"Approval rates chart would appear here"})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[a.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Lesson Plan Status"}),a.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 rounded-lg",children:a.jsx("p",{className:"text-gray-500",children:"Lesson plan status chart would appear here"})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[a.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Plan Status Distribution"}),a.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 rounded-lg",children:a.jsx("p",{className:"text-gray-500",children:"Plan status distribution chart would appear here"})})]})]})]}),we=()=>{const h=(b==null?void 0:b.classTeacherFor)||"";return a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Class Data",h?` – ${h}`:""]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6",children:a.jsx("p",{className:"text-gray-600",children:"Detailed class data, performance summaries, lesson plan progress and daily report summaries will appear here once the relevant data is available."})})]})},Fe=()=>{const[h,C]=x.useState([]),O=(b==null?void 0:b.classTeacherFor)||"",[_,M]=x.useState(!1),[L,F]=x.useState(Ve()),[H,q]=x.useState([]),[ee,me]=x.useState([]),[Oe,Mt]=x.useState(!1);x.useEffect(()=>{async function ye(){try{if(b&&b.classTeacherFor){const le=await Fs(b.classTeacherFor);C(Array.isArray(le)?le:[])}}catch(le){console.error(le)}}ye()},[b==null?void 0:b.classTeacherFor]);const Pt=async()=>{try{if(b&&b.classTeacherFor){const ye=await qd(b.classTeacherFor);me(Array.isArray(ye)?ye:[]),Mt(!0)}}catch(ye){console.error(ye)}},kr=()=>{const ye=h.map(le=>({admNo:le.admNo,studentName:le.name,status:"Present"}));q(ye),M(!0)},Qt=(ye,le)=>{const Ee=H.map((ue,lt)=>lt===ye?{...ue,status:le}:ue);q(Ee)},Cr=async ye=>{if(ye.preventDefault(),!(!b||!b.classTeacherFor))try{await j("Submitting attendance...",()=>Gd({date:L,class:b.classTeacherFor,teacherEmail:b.email,teacherName:b.name||"",records:H})),M(!1)}catch(le){console.error("Error submitting attendance:",le)}};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Students",O?` – ${O}`:""]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsxs("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center hover:bg-blue-700",children:[a.jsx(pa,{className:"h-4 w-4 mr-2"}),"Export"]}),b&&b.classTeacherFor&&a.jsxs("button",{onClick:kr,className:"bg-green-600 text-white px-4 py-2 rounded-lg flex items-center hover:bg-green-700",children:[a.jsx(Wr,{className:"h-4 w-4 mr-2"}),"Record Attendance"]}),b&&b.classTeacherFor&&a.jsxs("button",{onClick:Pt,className:"bg-purple-600 text-white px-4 py-2 rounded-lg flex items-center hover:bg-purple-700",children:[a.jsx(ii,{className:"h-4 w-4 mr-2"}),"View Performance"]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:a.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Student List"})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Adm No"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:3,className:"px-6 py-4 text-center text-sm text-gray-500",children:"No students to display."})}):h.map((ye,le)=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ye.admNo}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ye.name}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[a.jsx("button",{type:"button",className:"text-blue-600 hover:text-blue-900 mr-3",onClick:()=>g(ye),title:"View student",children:a.jsx(Ft,{className:"h-4 w-4"})}),a.jsx("button",{className:"text-green-600 hover:text-green-900",children:a.jsx(ol,{className:"h-4 w-4"})})]})]},le))})]})})]}),_&&a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[a.jsxs("h2",{className:"text-lg font-medium mb-4",children:["Record Attendance – ",O]}),a.jsxs("form",{onSubmit:Cr,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),a.jsx("input",{type:"date",value:L,onChange:ye=>F(ye.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0})]}),a.jsx("div",{className:"overflow-x-auto max-h-64",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Adm No"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Name"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:H.map((ye,le)=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:ye.admNo}),a.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:ye.studentName}),a.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:a.jsxs("select",{value:ye.status,onChange:Ee=>Qt(le,Ee.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded",children:[a.jsx("option",{value:"Present",children:"Present"}),a.jsx("option",{value:"Absent",children:"Absent"})]})})]},le))})]})}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>{M(!1)},className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),a.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Submit Attendance"})]})]})]}),Oe&&a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[a.jsxs("h2",{className:"text-lg font-medium mb-4",children:["Performance Overview – ",O]}),ee.length===0?a.jsx("p",{className:"text-sm text-gray-500",children:"No performance data available."}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Adm No"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Student Name"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Average Marks"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Exams"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:ee.map((ye,le)=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:ye.admNo}),a.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:ye.name}),a.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:ye.average.toFixed(2)}),a.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:ye.examCount})]},le))})]})}),a.jsx("div",{className:"flex justify-end mt-4",children:a.jsx("button",{onClick:()=>Mt(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Close"})})]})]})},qe=()=>{const[h,C]=x.useState([]),[O,_]=x.useState({teacher:"",class:"",subject:"",status:""}),[M,L]=x.useState(!1);x.useEffect(()=>{b&&F()},[b]);const F=async()=>{try{L(!0);const H=await Wd(O.teacher,O.class,O.subject,O.status);C(Array.isArray(H)?H:[])}catch(H){console.error("Error loading all plans:",H)}finally{L(!1)}};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"All Plans"}),a.jsx("div",{className:"flex space-x-3",children:a.jsxs("button",{onClick:F,className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center hover:bg-blue-700",children:[a.jsx(di,{className:"h-4 w-4 mr-2"}),"Apply Filters"]})})]}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6 space-y-4",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Teacher (email or name)"}),a.jsx("input",{type:"text",value:O.teacher,onChange:H=>handleReportFilterChange("teacher",H.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Search teacher"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Class"}),a.jsx("input",{type:"text",value:O.class,onChange:H=>handleReportFilterChange("class",H.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"e.g. 10A"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject"}),a.jsx("input",{type:"text",value:O.subject,onChange:H=>handleReportFilterChange("subject",H.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"e.g. Mathematics"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),a.jsxs("select",{value:O.status,onChange:H=>handleReportFilterChange("status",H.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"Pending",children:"Pending"}),a.jsx("option",{value:"Approved",children:"Approved"}),a.jsx("option",{value:"Rejected",children:"Rejected"}),a.jsx("option",{value:"Pending Review",children:"Pending Review"}),a.jsx("option",{value:"Ready",children:"Ready"}),a.jsx("option",{value:"Needs Rework",children:"Needs Rework"})]})]})]})}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:a.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Plan Records"})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Teacher"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Class"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subject"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Chapter"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Term/Unit/Month"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sessions"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Session"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),a.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[h.map((H,q)=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.type}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.teacherName}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.class}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.subject}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.chapter}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.term||H.unit||H.month||""}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.noOfSessions||""}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.session||""}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.status})]},q)),h.length===0&&!M&&a.jsx("tr",{children:a.jsx("td",{colSpan:9,className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center",children:"No plans found."})}),M&&a.jsx("tr",{children:a.jsx("td",{colSpan:9,className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center",children:"Loading plans..."})})]})]})})]})]})},P=()=>{const[h,C]=x.useState([]),[O,_]=x.useState(!1),[M,L]=x.useState({teacher:"",class:"",subject:"",date:"",fromDate:"",toDate:"",status:""});x.useEffect(()=>{b&&F()},[b]);const F=async()=>{try{_(!0);const q=await Ud({teacher:M.teacher,cls:M.class,subject:M.subject,date:M.date,fromDate:M.fromDate,toDate:M.toDate,status:M.status});C(Array.isArray(q)?q:[])}catch(q){console.error("Error loading reports:",q)}finally{_(!1)}},H=(q,ee)=>{L(me=>({...me,[q]:ee}))};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"All Daily Reports"}),a.jsx("div",{className:"flex space-x-3",children:a.jsxs("button",{onClick:F,className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center hover:bg-blue-700",children:[a.jsx(di,{className:"h-4 w-4 mr-2"}),"Apply Filters"]})})]}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6 space-y-4",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Teacher (email or name)"}),a.jsx("input",{type:"text",value:M.teacher,onChange:q=>H("teacher",q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Search teacher"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Class"}),a.jsx("input",{type:"text",value:M.class,onChange:q=>H("class",q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"e.g. 10A"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject"}),a.jsx("input",{type:"text",value:M.subject,onChange:q=>H("subject",q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"e.g. Mathematics"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),a.jsx("input",{type:"date",value:M.date,onChange:q=>H("date",q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From"}),a.jsx("input",{type:"date",value:M.fromDate,onChange:q=>H("fromDate",q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To"}),a.jsx("input",{type:"date",value:M.toDate,onChange:q=>H("toDate",q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),a.jsxs("select",{value:M.status,onChange:q=>H("status",q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"Fully Completed",children:"Fully Completed"}),a.jsx("option",{value:"Partially Completed",children:"Partially Completed"}),a.jsx("option",{value:"Not Started",children:"Not Started"})]})]})]})}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:a.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Daily Report Records"})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Teacher"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Class"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subject"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Period"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Plan Type"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Objectives"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Activities"})]})}),a.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[h.map((q,ee)=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:q.date}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:q.teacherName}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:q.class}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:q.subject}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:q.period}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:q.planType}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:q.completed}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:q.objectives}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:q.activities})]},ee)),h.length===0&&!O&&a.jsx("tr",{children:a.jsx("td",{colSpan:9,className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center",children:"No reports found."})}),O&&a.jsx("tr",{children:a.jsx("td",{colSpan:9,className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center",children:"Loading reports..."})})]})]})})]})]})};try{return A?a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):re?a.jsxs(a.Fragment,{children:[a.jsx(S,{}),a.jsx(T,{}),a.jsx(k,{}),e&&a.jsx("div",{className:"fixed top-4 right-4 z-50",children:a.jsxs("div",{className:"bg-red-100 text-red-800 px-4 py-2 rounded shadow flex items-center space-x-3",children:[a.jsx("div",{children:e}),a.jsx("button",{onClick:()=>t(null),className:"text-sm text-red-600",children:"Dismiss"})]})}),a.jsx(Wu,{user:re,activeView:I,navigationItems:oe().map(h=>({...h,onClick:C=>z(C)})),children:U()})]}):a.jsxs(a.Fragment,{children:[e&&a.jsx("div",{className:"fixed top-4 right-4 z-50",children:a.jsx("div",{className:"bg-red-100 text-red-800 px-4 py-2 rounded shadow",children:e})}),se!=null&&se.loading&&!re?a.jsx(yu,{message:"Restoring session..."}):a.jsx(vu,{onSuccess:D})]})}catch(h){return console.error("App render error:",h),a.jsx("div",{className:"min-h-screen flex items-center justify-center p-6 bg-gray-50",children:a.jsxs("div",{className:"max-w-3xl w-full bg-white p-6 rounded-lg shadow",children:[a.jsx("h2",{className:"text-xl font-semibold text-red-600 mb-3",children:"Application render error"}),a.jsx("p",{className:"text-sm text-gray-700 mb-4",children:"An error occurred while rendering the application. The error stack is shown below — please paste it into the chat."}),a.jsx("pre",{className:"text-xs text-gray-900 whitespace-pre-wrap bg-gray-100 rounded p-3 overflow-auto",style:{maxHeight:"50vh"},children:h&&(h.stack||h.message||String(h))})]})})}};function uD(e={}){const{nonce:t,onScriptLoadSuccess:r,onScriptLoadError:s}=e,[n,i]=x.useState(!1),o=x.useRef(r);o.current=r;const l=x.useRef(s);return l.current=s,x.useEffect(()=>{const c=document.createElement("script");return c.src="https://accounts.google.com/gsi/client",c.async=!0,c.defer=!0,c.nonce=t,c.onload=()=>{var d;i(!0),(d=o.current)===null||d===void 0||d.call(o)},c.onerror=()=>{var d;i(!1),(d=l.current)===null||d===void 0||d.call(l)},document.body.appendChild(c),()=>{document.body.removeChild(c)}},[t]),n}const nd=x.createContext(null);function mD({clientId:e,nonce:t,onScriptLoadSuccess:r,onScriptLoadError:s,children:n}){const i=uD({nonce:t,onScriptLoadSuccess:r,onScriptLoadError:s}),o=x.useMemo(()=>({clientId:e,scriptLoadedSuccessfully:i}),[e,i]);return E.createElement(nd.Provider,{value:o},n)}function hD(){const e=x.useContext(nd);if(!e)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return e}function fD(){var e,t,r;(r=(t=(e=window==null?void 0:window.google)===null||e===void 0?void 0:e.accounts)===null||t===void 0?void 0:t.id)===null||r===void 0||r.disableAutoSelect()}function pD({flow:e="implicit",scope:t="",onSuccess:r,onError:s,onNonOAuthError:n,overrideScope:i,state:o,...l}){const{clientId:c,scriptLoadedSuccessfully:d}=hD(),u=x.useRef(),m=x.useRef(r);m.current=r;const f=x.useRef(s);f.current=s;const p=x.useRef(n);p.current=n,x.useEffect(()=>{var y,w;if(!d)return;const j=e==="implicit"?"initTokenClient":"initCodeClient",k=(w=(y=window==null?void 0:window.google)===null||y===void 0?void 0:y.accounts)===null||w===void 0?void 0:w.oauth2[j]({client_id:c,scope:t,callback:S=>{var T,b;if(S.error)return(T=f.current)===null||T===void 0?void 0:T.call(f,S);(b=m.current)===null||b===void 0||b.call(m,S)},error_callback:S=>{var T;(T=p.current)===null||T===void 0||T.call(p,S)},state:o,...l});u.current=k},[c,d,e,t,o]);const v=x.useCallback(y=>{var w;return(w=u.current)===null||w===void 0?void 0:w.requestAccessToken(y)},[]),g=x.useCallback(()=>{var y;return(y=u.current)===null||y===void 0?void 0:y.requestCode()},[]);return e==="implicit"?v:g}function gD({children:e}){const[t,r]=x.useState(null),[s,n]=x.useState([]),[i,o]=x.useState(null),[l,c]=x.useState(!1),[d,u]=x.useState(null),m="/",f=x.useMemo(()=>`${window.location.origin}${m}`,[m]);x.useEffect(()=>{try{const j=localStorage.getItem("sf_google_session");if(j){const k=JSON.parse(j);r(k.user||null),n(k.roles||[]),o(k.idToken||null)}}catch{}},[]);const p=j=>{localStorage.setItem("sf_google_session",JSON.stringify({user:j.user,roles:j.roles,idToken:j.idToken}))},v=async j=>{console.log("Sending Google auth info to backend...");try{const k=await yd(j);if(k&&k.error)throw console.error("Backend login error:",k.error),new Error(k.error);return k}catch(k){throw console.error("Backend login failed:",k),k}},g=pD({flow:"implicit",scope:"email profile openid",onSuccess:async j=>{try{c(!0),u(null),console.log("Google login response:",j);const k=j.access_token;if(!k)throw console.error("No access token received from Google OAuth:",j),new Error("Failed to authenticate with Google. Please try again.");console.log("Received Google access token, fetching user info...");const S=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${k}`}});if(!S.ok)throw new Error("Failed to get user info from Google");const T=await S.json();console.log("Google user info:",T);const b=T.sub;o(k);const $={google_id:T.sub,email:T.email,name:T.name,picture:T.picture,access_token:k},A=await v($);console.log("Backend login success:",A);const R=Array.isArray(A.roles)?A.roles:A.role?[A.role]:[];r(A),n(R),p({user:A,roles:R,idToken:k})}catch(k){console.error("Google login failed",k),u(k.message||String(k))}finally{c(!1)}},onError:j=>{console.error("Google OAuth error:",j),u("Google authentication failed: "+((j==null?void 0:j.error_description)||"Unknown error"))},useOneTap:!1,overrideScope:!0,select_account:!0,prompt:"select_account",redirect_uri:f,auto_select:!1,popup_url_options:{height:800,width:500,popup:!1,target:"google_oauth"+Date.now()}}),y=x.useCallback(()=>{try{fD()}catch{}r(null),n([]),o(null),u(null),localStorage.removeItem("sf_google_session")},[]),w=x.useMemo(()=>({user:t,roles:s,idToken:i,loading:l,error:d,loginWithGoogle:g,logout:y}),[t,s,i,l,d,g,y]);return a.jsx(dl.Provider,{value:w,children:e})}function xD({children:e}){return a.jsx(mD,{clientId:"507141639783-i7nbimunjms0u1cca16i04deup3sbt3o.apps.googleusercontent.com",children:a.jsx(gD,{children:e})})}Ls.createRoot(document.getElementById("root")).render(a.jsx(E.StrictMode,{children:a.jsx(bu,{children:a.jsx(xD,{children:a.jsx(dD,{})})})}));
